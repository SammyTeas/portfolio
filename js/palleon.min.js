!function(e){"use strict";e.fn.palleon=function(t){var a,n,i,l,o,r,s,d=e(this),c=document.body.clientWidth,p=e.extend({baseURL:"./",PexelsApiKey:"",PexelsPagination:20,PexelsLanguage:"en-US",PexelsImgSize:"large2x",PixabayApiKey:"",PixabayPagination:16,PixabayLanguage:"en",PixabaySafeSearch:"false",PixabayEditorsChice:"false",apiCaching:!0,fontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",fontSize:60,fontWeight:"normal",fontStyle:"normal",canvasColor:"transparent",fill:"#000",stroke:"#fff",strokeWidth:0,textBackgroundColor:"rgba(255,255,255,0)",textAlign:"left",lineHeight:1.2,borderColor:"#000",borderDashArray:[4,4],borderOpacityWhenMoving:.5,borderScaleFactor:2,editingBorderColor:"rgba(0,0,0,0.5)",cornerSize:12,cornerStrokeColor:"#000",cornerStyle:"circle",transparentCorners:!1,cursorColor:"#000",cursorWidth:2,enableGLFiltering:!0,textureSize:4096,watermark:!1,watermarkText:"palleon.website",watermarkFontFamily:"Georgia, serif",watermarkFontStyle:"normal",watermarkFontColor:"#000",watermarkFontSize:40,watermarkFontWeight:"bold",watermarkBackgroundColor:"#FFF",watermarkLocation:"bottom-right",templatePreview:!0,defaultFonts:[["Helvetica Neue","'Helvetica Neue', 'Helvetica', 'Arial', sans-serif"],["Impact","Impact, Charcoal, sans-serif"],["Georgia","Georgia, serif"],["Palatino Linotype","'Palatino Linotype', 'Book Antiqua', Palatino, serif"],["Times New Roman","'Times New Roman', Times, serif"],["Arial","Arial, Helvetica, sans-serif"],["Arial Black","'Arial Black', Gadget, sans-serif"],["Comic Sans","'Comic Sans MS', cursive, sans-serif"],["Lucida Sans","'Lucida Sans Unicode', 'Lucida Grande', sans-serif"],["Tahoma","Tahoma, Geneva, sans-serif"],["Trebuchet","'Trebuchet MS', Helvetica, sans-serif"],["Verdana","Verdana, Geneva, sans-serif"],["Courier New","'Courier New', Courier, monospace"],["Lucida Console","'Lucida Console', Monaco, monospace"]],customFunctions:function(){}},t),f="",g=new Localbase("palleon"),h=0,m=!1,u="none",v="",b="",y="",$="",w=0,k=1,_=1,x="left",C="top",j="",A=[],S="",I="",O="",T="",R=0,q=[],F="add-to-canvas",Y=["circle","square","rectangle","triangle","ellipse","trapezoid","octagon","pentagon","emerald","star","diamond","parallelogram","customShape"],X=["square","rectangle","triangle"],z=p.defaultFonts,P=["objectType","gradientFill","roundedCorders","mode","selectable","lockMovementX","lockMovementY","lockRotation","lockScalingX","lockScalingY","crossOrigin","layerName","maskType","ogWidth","ogHeight"];function E(){g.collection("assets").get().then(e=>{if(void 0===e)E();else if(e.length>0){var t=0,a=0,n=0,i=[];e.forEach(function(e){i.push({src:e.src,key:e.key,type:e.type,name:e.name})}),d.find("#palleon-library-my").html(""),d.find("#palleon-svg-library-my").html(""),d.find("#palleon-my-templates").html(""),i.slice().reverse().forEach(function(e){if("svg"==e.type){let i=new Blob([e.src],{type:"image/svg+xml;charset=utf-8"}),l=URL.createObjectURL(i);d.find("#palleon-svg-library-my").append('<div class="palleon-masonry-item" data-keyword="'+e.name+'"> <div class="palleon-library-delete" data-target="'+e.key+'"><span class="material-icons">remove</span></div> <div class="palleon-masonry-item-inner"> <div class="palleon-img-wrap"> <img src="'+l+'" data-full="'+l+'" data-filename="'+e.name+'" title="'+e.name+'" data-format="'+e.type+'" /> </div> <div class="palleon-masonry-item-desc">'+e.name+"</div> </div> </div>"),t++}else if("json"==e.type){let o=new Blob([e.src],{type:"text/plain"}),r=URL.createObjectURL(o);d.find("#palleon-my-templates").append('<li data-keyword="'+e.name+'"> <div>'+e.name+'</div> <div> <button type="button" class="palleon-btn primary palleon-select-template" data-json="'+r+'"><span class="material-icons">check</span>'+palleonParams.select+'</button> <button type="button" class="palleon-btn danger palleon-template-delete" data-target="'+e.key+'"><span class="material-icons">clear</span>'+palleonParams.delete+"</button> </div> </li>"),n++}else{let s=H(e.src),c=URL.createObjectURL(s);d.find("#palleon-library-my").append('<div class="palleon-masonry-item" data-keyword="'+e.name+'"> <div class="palleon-library-delete" data-target="'+e.key+'"><span class="material-icons">remove</span></div> <div class="palleon-masonry-item-inner"> <div class="palleon-img-wrap"> <img src="'+c+'" data-full="'+c+'" data-filename="'+e.name+'" title="'+e.name+'" data-format="'+e.type+'" /> </div> <div class="palleon-masonry-item-desc">'+e.name+"</div> </div> </div>"),a++}}),d.find("#palleon-svg-library-my-pagination").remove(),0!==t?W(d.find("#palleon-svg-library-my")):d.find("#palleon-svg-library-my").html('<div class="notice notice-info">'+palleonParams.easyAccess+"</div>"),d.find("#palleon-library-my-pagination").remove(),0!==a?W(d.find("#palleon-library-my")):d.find("#palleon-library-my").html('<div class="notice notice-info">'+palleonParams.easyAccess+"</div>"),d.find("#palleon-my-templates-pagination").remove(),0!==n?W(d.find("#palleon-my-templates")):d.find("#palleon-my-templates").html('<div class="notice notice-info">'+palleonParams.easyAccessTemplate+"</div>")}else d.find("#palleon-svg-library-my-pagination").remove(),d.find("#palleon-library-my-pagination").remove(),d.find("#palleon-my-templates-pagination").remove(),d.find("#palleon-svg-library-my").html('<div class="notice notice-info">'+palleonParams.easyAccess+"</div>"),d.find("#palleon-library-my").html('<div class="notice notice-info">'+palleonParams.easyAccess+"</div>"),d.find("#palleon-my-templates").html('<div class="notice notice-info">'+palleonParams.easyAccessTemplate+"</div>")})}g.config.debug=!1,E(),d.on("click",".palleon-library-delete",function(){var t=e(this).parent().parent(),a=e(this).parent(),n=e(this).attr("data-target");g.collection("assets").doc({key:n}).get().then(e=>{g.collection("assets").doc({key:n}).delete(),a.remove(),d.find("#"+t.attr("id")+"-pagination").remove(),W(t)})}),d.find(".palleon-template-list").on("click",".palleon-template-delete",function(){var t=e(this).parent().parent(),a=e(this).attr("data-target");g.collection("assets").doc({key:a}).get().then(e=>{g.collection("assets").doc({key:a}).delete(),t.remove(),d.find("#palleon-my-templates-pagination").remove(),W(d.find("#palleon-my-templates"))})}),d.find(".crop-custom").css("display","none"),new FontFaceObserver("Material Icons").load(null,1e4).then(function(){e("#palleon").find("#palleon-main-loader").fadeOut(200)}).catch(function(t){console.log(t),e("#palleon").find("#palleon-main-loader").hide()});var L=new LazyLoad({callback_error(t){t.setAttribute("src",p.baseURL+"assets/placeholder.png"),e(t).parent().css("min-height","auto"),e(t).parent().find(".palleon-img-loader").remove()},callback_loaded(t){e(t).parent().css("min-height","auto"),e(t).parent().find(".palleon-img-loader").remove()}});e.getJSON(p.baseURL+"json/templates.json",function(e){for(var t=0;t<e.templates.length;t++)d.find("#palleon-templates-grid").prepend('<div class="grid-item" data-keyword="'+e.templates[t].title+'" data-category="'+e.templates[t].tags+'"><div class="template-favorite"><button type="button" class="palleon-btn-simple star" data-templateid="'+e.templates[t].id+'"><span class="material-icons">star_border</span></button></div><div class="palleon-masonry-item-inner palleon-select-template" data-json="'+p.baseURL+e.templates[t].template+'"><div class="palleon-img-wrap"><div class="palleon-img-loader"></div><img class="lazy" data-src="'+p.baseURL+e.templates[t].thumbnail+'" data-title="'+e.templates[t].title+'" data-preview="'+p.baseURL+e.templates[t].image+'" /></div><div class="palleon-masonry-item-desc">'+e.templates[t].title+"</div></div></div>");L.update(),W(d.find("#palleon-templates-grid"))}),d.find(".auto-load-elements").each(function(t,a){for(var n=e(this).attr("data-folder"),i=e(this).attr("data-theme"),l=e(this).attr("data-loader"),o=parseInt(e(this).attr("data-total")),r="",s=0;s<o;s++){var d=s+1;r+='<div class="palleon-element '+i+'" data-elsource="'+p.baseURL+"files/elements/"+n+"/"+d+'.svg" data-loader="'+l+'"><img class="lazy" data-src="'+p.baseURL+"files/elements/"+n+"/"+d+'.svg" /><div class="element-favorite"><button type="button" class="palleon-btn-simple star " data-elementid="files/elements/'+n+"/"+d+'"><span class="material-icons">star_border</span></button></div></div>'}e(this).append(r)}),d.find(".auto-load-frames").each(function(t,a){for(var n=e(this).attr("data-folder"),i=parseInt(e(this).attr("data-total")),l="",o=0;o<i;o++){var r=o+1;l+='<div class="palleon-frame" data-elsource="'+p.baseURL+"files/frames/"+n+"/"+r+'.svg"><div class="palleon-img-wrap"><div class="palleon-img-loader"></div><img class="lazy" data-src="'+p.baseURL+"files/frames/"+n+"/"+r+'.jpg" /></div><div class="frame-favorite"><button type="button" class="palleon-btn-simple star " data-frameid="files/frames/'+n+"/"+r+'"><span class="material-icons">star_border</span></button></div></div>'}e(this).append(l)});for(var U=0;U<z.length;U++)d.find("#websafe-fonts").append(e('<option class="websafe-font"></option>').attr("value",z[U][1]).text(z[U][0]).attr("data-font",z[U][1]).text(z[U][0]));function W(e){var t=e.find(">*"),a=t.length,n=parseInt(e.data("perpage"));if(a>n){t.slice(n).hide();var i='<div id="'+e.attr("id")+'-pagination" class="palleon-pagination"></div>';e.after(i),d.find("#"+e.attr("id")+"-pagination").pagination({items:a,itemsOnPage:n,prevText:'<span class="material-icons">navigate_before</span>',nextText:'<span class="material-icons">navigate_next</span>',displayedPages:4,onPageClick:function(e,a){void 0!==a&&a.preventDefault();var i=n*(e-1);t.hide().slice(i,i+n).show()}}),d.find("#"+e.attr("id")+"-pagination").pagination("selectPage",1)}}function B(){h++;var e=j.toJSON(P);d.find("#palleon-history-list li").remove(),d.find("#palleon-history").prop("disabled",!0),d.find("#palleon-undo").prop("disabled",!0),d.find("#palleon-redo").prop("disabled",!0),d.find("#palleon-pages > div").removeClass("active"),d.find("#palleon-page-"+h+"-json").length>0?(d.find("#palleon-page-"+h+"-json").html(JSON.stringify(e)),d.find("#palleon-pages").find("#"+h).attr("data-origin",e.backgroundImage.src),d.find("#palleon-pages").find("#"+h).trigger("click")):(d.append('<script id="palleon-page-'+h+'-json" type="text/json">'+JSON.stringify(e)+"</script>"),d.find("#palleon-pages").prepend('<div id="'+h+'" class="active" data-origin="'+e.backgroundImage.src+'"><div class="palleon-open-page">'+d.find("#palleon-download-name").val()+'</div><span class="material-icons palleon-delete-page">clear</span></div>')),d.find("#palleon-apps-content > div").addClass("d-none"),d.find("#palleon-apps-menu").show()}function H(e){for(var t=e.split(","),a=t[0].match(/:(.*?);/)[1],n=atob(t[1]),i=n.length,l=new Uint8Array(i);i--;)l[i]=n.charCodeAt(i);return new Blob([l],{type:a})}function G(e,t){var a=new XMLHttpRequest;a.onload=function(){var e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(a.response)},a.open("GET",e),a.responseType="blob",a.send()}function D(){d.removeClass("panel-closed"),d.find(".palleon-icon-menu-btn").removeClass("active"),d.find("#palleon-icon-menu").removeClass("closed"),d.find("#palleon-toggle-left").removeClass("closed"),d.find("#palleon-toggle-left").find(".material-icons").html("chevron_left"),d.find("#palleon-icon-panel").show()}function M(){d.addClass("panel-closed"),d.find(".palleon-icon-menu-btn").removeClass("active"),d.find("#palleon-icon-menu").addClass("closed"),d.find("#palleon-toggle-left").addClass("closed"),d.find("#palleon-toggle-left").find(".material-icons").html("chevron_right"),d.find("#palleon-icon-panel").hide()}e.getJSON(p.baseURL+"json/google-fonts.json",function(t){for(var a=0;a<t.items.length;a++)d.find("#google-fonts").append(e('<option class="google-font"></option>').attr("value",t.items[a].family).text(t.items[a].family).attr("data-font",t.items[a].family).text(t.items[a].family))}),e.getJSON(p.baseURL+"json/material-icons.json",function(e){for(var t=0;t<e.categories.length;t++)for(var a=e.categories[t],n=0;n<a.icons.length;n++){var i=p.baseURL+"files/icons/"+a.icons[n].group_id+"/"+a.icons[n].ligature;d.find("#palleon-icons .palleon-grid").append('<div class="palleon-element add-element" data-elsource="'+i+'" data-loader="no" title="'+a.icons[n].name+'"><span class="material-icons">'+a.icons[n].ligature+"</div>")}}),d.find(".palleon-select.palleon-select2").select2({theme:"dark",width:"100%",templateSelection:eR,templateResult:eR,allowHtml:!0}),d.find(".palleon-colorpicker.disallow-empty").spectrum({allowEmpty:!1,showInitial:!0,hideAfterPaletteSelect:!0,showSelectionPalette:!0,localStorageKey:"spectrum.palleon"}),d.find(".palleon-colorpicker.allow-empty").spectrum({allowEmpty:!0,showInitial:!1,hideAfterPaletteSelect:!0,showSelectionPalette:!0,localStorageKey:"spectrum.palleon"}),toastr.options.closeButton=!0,toastr.options.positionClass="toast-bottom-right",toastr.options.progressBar=!0,toastr.options.newestOnTop=!1,toastr.options.showEasing="swing",toastr.options.hideEasing="linear",toastr.options.closeEasing="linear",d.find("#palleon-canvas-wrap").draggable({disabled:!0}),d.find(".paginated").each(function(){W(e(this))}),d.find("#palleon-pages").on("click",".palleon-open-page",function(){var t=e(this).parent();if(!t.hasClass("active")){d.find("#palleon-draw-btn").hasClass("active")&&d.find("#palleon-draw-btn").trigger("click"),d.find("#palleon-history-list li").remove(),d.find("#palleon-history").prop("disabled",!0),d.find("#palleon-undo").prop("disabled",!0),d.find("#palleon-redo").prop("disabled",!0),d.find("#palleon-canvas-loader").show();var a=d.find("#palleon-pages > div.active").attr("id"),n=e(this).parent().attr("id"),i=j.toJSON(P);d.find("#palleon-page-"+a+"-json").html(JSON.stringify(i));var l=d.find("#palleon-page-"+n+"-json").html();e(document).trigger("loadTemplate",[l,"",""]),d.find("#palleon-pages > div").removeClass("active"),t.addClass("active"),ew(),d.find("#palleon-apps-content > div").addClass("d-none"),d.find("#palleon-apps-menu").show()}}),d.find("#palleon-pages").on("click",".palleon-delete-page",function(){var t=e(this).parent();t.hasClass("active")?(t.remove(),d.find("#palleon-pages > div").length>0?d.find("#palleon-pages > div:first-child > .palleon-open-page").trigger("click"):(u="none",el())):t.remove()}),d.on("change",".palleon-file-name",function(){var t=e(this).val();d.find(".palleon-file-name").not(this).each(function(){e(this).val(t),d.find("#palleon-pages > div.active > .palleon-open-page").html(t)})}),d.on("click","#palleon-new",function(){if(d.find("#palleon-pages > div.active").length>0){var e=d.find("#palleon-pages > div.active").attr("id"),t=j.toJSON(P);d.find("#palleon-page-"+e+"-json").html(JSON.stringify(t))}}),d.on("click","#palleon-save",function(){if(d.find("#palleon-pages > div.active").length>0){var e=d.find("#palleon-pages > div.active").attr("id"),t=j.toJSON(P);d.find("#palleon-page-"+e+"-json").html(JSON.stringify(t))}}),d.find("#palleon-pages").sortable({items:"[data-origin]",placeholder:"page-placeholder",axis:"x"}).disableSelection(),d.find("#palleon-toggle-left").on("click",function(){e(this).hasClass("closed")?D():M()}),d.find("#palleon-toggle-right").on("click",function(){e(this).hasClass("closed")?(d.removeClass("layers-closed"),e(this).removeClass("closed"),e(this).find(".material-icons").html("chevron_right"),d.find("#palleon-right-col").show()):(d.addClass("layers-closed"),e(this).addClass("closed"),e(this).find(".material-icons").html("chevron_left"),d.find("#palleon-right-col").hide())}),d.find(".palleon-toggle-right").on("click",function(e){e.preventDefault(),d.find("#palleon-toggle-right").trigger("click")}),c<=1200&&(d.find("#palleon-toggle-right").trigger("click"),d.find("#palleon-toggle-left").trigger("click")),d.find(".palleon-icon-menu-btn").on("click",function(){e(this).data("target")&&(e(this).hasClass("active")?M():(D(),e(this).addClass("active"),d.find(".palleon-icon-panel-content").addClass("panel-hide"),d.find(e(this).data("target")).removeClass("panel-hide"))),"palleon-btn-elements"==e(this).attr("id")&&d.find("#palleon-all-elements-open").trigger("click")}),d.find(".palleon-dropdown-wrap").on("click",function(){e(this).hasClass("opened")?(e(this).removeClass("opened"),e(this).find(".palleon-dropdown").hide()):(e(this).addClass("opened"),e(this).find(".palleon-dropdown").show())}),d.find(".palleon-icon-panel-content ul.palleon-accordion > li > a").on("click",function(t){t.preventDefault();var a=e(this).parent().parent();e(this).parent().hasClass("opened")?a.find("li").removeClass("opened"):(a.find("li").removeClass("opened"),e(this).parent().addClass("opened"))}),d.find(".palleon-lock-unlock").on("click",function(){e(this).hasClass("active")?(e(this).removeClass("active"),e(this).find(".material-icons").html("lock_open")):(e(this).addClass("active"),e(this).find(".material-icons").html("lock"))}),d.find(".palleon-slider").on("input",function(){e(this).parent().parent().find(".slider-label span").html(e(this).val()),d.find("span.tm-count-zoom").html(e(this).val())}),d.find('input[type="checkbox"]').on("change",function(){e(this).data("conditional")&&(e(this).is(":checked")?d.find(e(this).data("conditional")).removeClass("d-none"):d.find(e(this).data("conditional")).addClass("d-none"))}),d.find(".palleon-tabs-menu li").on("click",function(){var t=e(this).data("target"),a=e(this).parent().parent();a.find("> .palleon-tab").removeClass("active"),e(t).addClass("active"),a.find("> .palleon-tabs-menu li").removeClass("active"),e(this).addClass("active")}),d.find('input[type="number"],.numeric-field').bind("input paste keyup keydown",function(){this.value=this.value.replace(/(?!^-)[^0-9.]/g,"").replace(/(\..*)\./g,"$1"),e(this).data("max")&&this.value>e(this).data("max")&&(this.value=e(this).data("max")),e(this).data("min")&&this.value<e(this).data("min")&&(this.value=e(this).data("min"))}),d.find(".palleon-counter .counter-plus").on("click",function(){var t=e(this).parent().find("input.palleon-form-field"),a=parseInt(t.val())+parseInt(t.data("step"));t.data("max")&&a>t.data("max")&&(a=t.data("max")),t.data("min")&&a<t.data("min")&&(a=t.data("min")),a<0&&(a=0),t.val(a),"palleon-img-zoom-in"==e(this).attr("id")&&ew(a)}),d.find(".palleon-counter .counter-minus").on("click",function(){var t=e(this).parent().find("input.palleon-form-field"),a=parseInt(t.val())-parseInt(t.data("step"));t.data("max")&&a>t.data("max")&&(a=t.data("max")),t.data("min")&&a<t.data("min")&&(a=t.data("min")),a<0&&(a=0),t.val(a),"palleon-img-zoom-out"==e(this).attr("id")&&ew(a)}),d.find(".palleon-wrap").on("click",function(e){if(!m){var t=e.target.id;""!=t&&"palleon-content"==t&&(j.discardActiveObject(),j.requestRenderAll())}}),fabric.enableGLFiltering=p.enableGLFiltering,fabric.textureSize=parseInt(p.textureSize),fabric.Object.prototype.borderColor=p.borderColor,fabric.Object.prototype.borderDashArray=p.borderDashArray,fabric.Object.prototype.borderOpacityWhenMoving=p.borderOpacityWhenMoving,fabric.Object.prototype.borderScaleFactor=p.borderScaleFactor,fabric.Object.prototype.editingBorderColor=p.editingBorderColor,fabric.Object.prototype.cornerColor=p.cornerColor,fabric.Object.prototype.cornerSize=p.cornerSize,fabric.Object.prototype.cornerStrokeColor=p.cornerStrokeColor,fabric.Object.prototype.cornerStyle=p.cornerStyle,fabric.Object.prototype.transparentCorners=p.transparentCorners,fabric.Object.prototype.cursorColor=p.cursorColor,fabric.Object.prototype.cursorWidth=p.cursorWidth,fabric.Object.prototype.strokeUniform=!0,fabric.Group.prototype.padding=0,fabric.Object.prototype.erasable=!1,fabric.Canvas.prototype.getItemById=function(e){for(var t=null,a=this.getObjects(),n=0,i=this.size();n<i;n++)if("group"==a[n].get("type")){if(a[n].get("id")&&a[n].get("id")===e){t=a[n];break}for(var l=n,o=0;o<a[n]._objects.length;o++)if(a[l]._objects[o].id&&a[l]._objects[o].id===e){t=a[l]._objects[o];break}}else if(a[n].id&&a[n].id===e){t=a[n];break}return t};var N=document.createElement("img");function V(t,a){var n=a.target;"activeSelection"===n.type?(e.each(n._objects,function(e,t){d.find("#palleon-layers #"+t.id).find("a.delete-layer").trigger("click")}),j.discardActiveObject()):d.find("#palleon-layers #"+n.id).find("a.delete-layer").trigger("click")}function Z(e,t,a,n,i){e.save(),e.translate(t,a),e.rotate(fabric.util.degreesToRadians(i.angle)),e.drawImage(N,-12,-12,24,24),e.restore()}N.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='tm_delete_btn' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='512px' height='512px' viewBox='0 0 512 512' style='enable-background:new 0 0 512 512;' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='256' cy='256' r='256'/%3E%3Cg%3E%3Crect x='120.001' y='239.987' transform='matrix(-0.7071 -0.7071 0.7071 -0.7071 256.0091 618.0168)' style='fill:%23FFFFFF;' width='271.997' height='32'/%3E%3Crect x='240' y='119.989' transform='matrix(-0.7071 -0.7071 0.7071 -0.7071 256.0091 618.0168)' style='fill:%23FFFFFF;' width='32' height='271.997'/%3E%3C/g%3E%3C/svg%3E";var J=document.createElement("img");function K(e,t){var a=t.target;"activeSelection"===a.type?toastr.warning(palleonParams.noDuplicate,palleonParams.warning):d.find("#palleon-layers #"+a.id).find("a.duplicate-layer").trigger("click")}function Q(e,t,a,n,i){e.save(),e.translate(t,a),e.rotate(fabric.util.degreesToRadians(i.angle)),e.drawImage(J,-12,-12,24,24),e.restore()}function ee(e,t){""==e&&(e=new Date().getTime()),""==t?t="jpeg":".jpg"==t?t="jpeg":"jpg"==t?t="jpeg":".png"==t?t="png":".webp"==t?t="webp":".tiff"==t&&(t="tiff"),d.find(".palleon-file-name").val(e),d.find(".palleon-file-name").data("default",e),d.find("#palleon-save-img-format").val(t).change(),d.find("#palleon-download-format").val(t).change()}function et(e){if(w=0,d.find("#palleon-canvas-loader").css("display","flex"),d.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),u=e,j.backgroundImage&&(A=j.backgroundImage.filters),"canvas"==u){d.find("#palleon-canvas-color").trigger("change");var t=document.createElement("canvas"),a=new fabric.Canvas(t),n=parseInt(d.find("#palleon-canvas-width").val()),i=parseInt(d.find("#palleon-canvas-height").val());""==n&&(n=800),""==i&&(i=800),a.setWidth(n),a.setHeight(i),a.backgroundColor="transparent";var l=a.toDataURL({format:"png",enableRetinaScaling:!1});d.find("#palleon-canvas-img").attr("src",l),a.dispose()}d.find("#palleon-canvas-img-wrap").imagesLoaded(function(){v=d.find("#palleon-canvas-img")[0],b=d.find("#palleon-canvas-img").attr("src"),y=v.width,$=v.height,ek(v),j.setDimensions({width:y,height:$}),fabric.Image.fromURL(b,function(e){j.setBackgroundImage(e,j.renderAll.bind(j),{objectType:"BG",mode:u,scaleX:k,scaleY:_,selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0},{crossOrigin:"anonymous"}),setTimeout(function(){B(),d.find("#palleon-canvas-loader").hide()},500)}),ew(),el(),setTimeout(function(){ei(),eu('<span class="material-icons">flag</span>'+palleonParams.started)},100)})}if(J.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='tm_add_btn' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='512px' height='512px' viewBox='0 0 512 512' style='enable-background:new 0 0 512 512;' xml:space='preserve'%3E%3Ccircle style='fill:%23009688;' cx='256' cy='256' r='256'/%3E%3Cg%3E%3Crect x='240' y='120' style='fill:%23FFFFFF;' width='32' height='272'/%3E%3Crect x='120' y='240' style='fill:%23FFFFFF;' width='272' height='32'/%3E%3C/g%3E%3C/svg%3E",fabric.Image.filters.Shift=fabric.util.createClass(fabric.Image.filters.ColorMatrix,{type:"Shift",matrix:[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],mainParameter:!1,colorsOnly:!0}),f=d.find("#palleon-canvas")[0],(j=new fabric.Canvas(f)).backgroundColor=p.canvasColor,e(document).on("loadBase64Img",function(e,t,a,n=!0){w=0,d.find("#palleon-canvas-loader").css("display","flex"),d.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),u="image",j.backgroundImage&&(A=j.backgroundImage.filters),d.find("#palleon-canvas-img").attr("src",t),d.find("#palleon-canvas-img-wrap").imagesLoaded(function(){y=(v=d.find("#palleon-canvas-img")[0]).width,$=v.height,ee(a,"png"),ek(v),j.setDimensions({width:y,height:$}),j.setBackgroundImage(t,j.renderAll.bind(j),{objectType:"BG",mode:u,scaleX:k,scaleY:_,selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0},{crossOrigin:"anonymous"}),ew(),el(),setTimeout(function(){n?(ei(),B(),eu('<span class="material-icons">flag</span>'+palleonParams.started),d.find("#palleon-canvas-loader").hide()):eu('<span class="material-icons">image</span>'+palleonParams.bg+" "+palleonParams.edited),d.find("#palleon-canvas-loader").hide()},500)})}),e(document).on("loadImgURL",function(e,t,a){d.find("#palleon-canvas-loader").css("display","flex"),d.find("#palleon-canvas-wrap").css("visibility","visible");var n=t,i=new Image;if("add-to-canvas"==F)ee(ea,a),G(n,function(e){i.src=e,i.onload=function(){d.find("#palleon-canvas-img").attr("src",e),et("image")}});else if("add-as-object"==F){var l=eT()[1]/2,o=eT()[0]/2,r=j.getObjects().filter(e=>"printarea"==e.objectType)[0];r&&(l=r.top,o=r.left),G(n,function(e){i.src=e,i.onload=function(){var e=new fabric.Image(i,{objectType:"image",objectCaching:!0,roundedCorders:0,stroke:"#fff",strokeWidth:0,top:l,left:o,originX:"center",originY:"center"});e.set({ogWidth:e.get("width"),ogHeight:e.get("height")}),j.add(e),r?(e.scaleToWidth(.8*r.width*j.getZoom()),e.isContainedWithinObject(r)||e.scaleToHeight(.8*r.height*j.getZoom())):(e.scaleToWidth(eT()[0]/4),e.isPartiallyOnScreen()&&e.scaleToHeight(eT()[1]/4)),j.setActiveObject(e),j.requestRenderAll(),d.find("#palleon-canvas-loader").hide(),j.fire("palleon:history",{type:"image",text:palleonParams.added})}})}else"replace-image"==F?G(n,function(e){i.src=e,i.onload=function(){j.getActiveObject().setSrc(e),j.requestRenderAll(),d.find("#palleon-canvas-loader").hide(),j.fire("palleon:history",{type:"image",text:palleonParams.replaced})}}):"overlay-image"==F&&G(n,function(e){i.src=e,i.onload=function(){var e=new fabric.Image(i);e.set({scaleX:eT()[0]/e.width,scaleY:eT()[1]/e.height,objectCaching:!1,originX:"left",originY:"top",selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0}),j.setOverlayImage(e,j.renderAll.bind(j)),d.find("#palleon-overlay-wrap").show(),d.find("#palleon-overlay-preview").attr("src",n),setTimeout(function(){d.find("#palleon-canvas-loader").hide()},500)}});d.find("#modal-media-library").hide()}),""!=d.find("#palleon-canvas-img").attr("src")){u="image";var ea=d.find("#palleon-canvas-img").data("filename");ee(ea,d.find("#palleon-canvas-img").attr("src").match(/\.[0-9a-z]+$/i)[0].replace(/\./g,"")),et(u)}if(el(),""!=d.find("#palleon-canvas-img").data("template")){var ea=d.find("#palleon-canvas-img").data("filename");d.find("#palleon-canvas-loader").css("display","flex"),d.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),d.find(".palleon-modal").hide();var en=j.getObjects();en.filter(e=>"BG"!=e.objectType).forEach(e=>j.remove(e)),d.find("#palleon-layers li").remove(),eb(),e.getJSON(d.find("#palleon-canvas-img").data("template"),function(e){eo(e),setTimeout(function(){ee(ea,""),B(),eu('<span class="material-icons">flag</span>'+palleonParams.started)},100)}).fail(function(e,t,a){toastr.error("Request Failed: "+a,palleonParams.error)}).always(function(){d.find("#palleon-canvas-loader").hide()})}function ei(){(w=0,k=1,_=1,x="left",C="top",void 0!==j.overlayImage&&null!==j.overlayImage&&(j.overlayImage=null),d.find("#keep-data").is(":checked"))?(j.backgroundImage.filters=A,j.backgroundImage.applyFilters()):(j.backgroundImage.filters=[],d.find("#palleon-adjust .conditional-settings").addClass("d-none"),d.find("#palleon-brightness").prop("checked",!1),d.find("#brightness").val(0),d.find("#palleon-contrast").prop("checked",!1),d.find("#contrast").val(0),d.find("#palleon-saturation").prop("checked",!1),d.find("#saturation").val(0),d.find("#palleon-hue").prop("checked",!1),d.find("#hue").val(0),d.find("#palleon-filters input[type=checkbox]").prop("checked",!1),d.find("#palleon-gamma").prop("checked",!1),d.find("#gamma-red").val(1),d.find("#gamma-green").val(1),d.find("#gamma-blue").val(1),d.find("#palleon-blend-color").prop("checked",!1),d.find("#blend-color-mode").val("add"),d.find("#blend-color-color").spectrum("set","#ffffff"),d.find("#blend-color-alpha").val(.5),d.find("#blend-color-alpha").parent().parent().find(".slider-label span").html(.5),d.find("#palleon-duotone-color").prop("checked",!1),d.find("#duotone-light-color").spectrum("set","green"),d.find("#duotone-dark-color").spectrum("set","blue"),d.find("#palleon-swap-colors").prop("checked",!1),d.find("#palleon-blur").prop("checked",!1),d.find("#blur").val(0),d.find("#palleon-noise").prop("checked",!1),d.find("#noise").val(0),d.find("#palleon-pixelate").prop("checked",!1),d.find("#pixelate").val(1),j.getObjects().filter(e=>"BG"!=e.objectType).forEach(e=>j.remove(e)),d.find("#palleon-layers li").remove(),eb()),j.fire("selection:cleared"),j.requestRenderAll()}function el(){"none"==u?(d.find("#palleon-icon-menu, #palleon-icon-panel, #palleon-ruler-icon").css("pointer-events","none"),d.find("#modal-add-new .palleon-modal-close").hide(),d.find("#modal-media-library .palleon-modal-close").hide(),d.find("#modal-add-new").show(),d.find("#palleon-modal-onstart").show(),d.find("#palleon-save").prop("disabled",!0)):(d.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),d.find("#palleon-icon-menu, #palleon-icon-panel, #palleon-ruler-icon").css("pointer-events","auto"),d.find("#modal-add-new .palleon-modal-close").show(),d.find("#modal-media-library .palleon-modal-close").show(),d.find("#modal-add-new").hide(),d.find("#palleon-modal-onstart").hide(),d.find("#palleon-save").prop("disabled",!1)),"canvas"==u?d.find(".hide-on-canvas-mode").hide():d.find(".hide-on-canvas-mode").show()}function eo(t){d.find("#palleon-canvas-loader").css("display","flex"),w=t.backgroundImage.angle,k=t.backgroundImage.scaleX,_=t.backgroundImage.scaleY,x=t.backgroundImage.originX,C=t.backgroundImage.originY,j.clear(),d.find("#palleon-layers li").remove(),u=t.backgroundImage.mode;var a=H(t.backgroundImage.src);b=URL.createObjectURL(a),d.find("#palleon-canvas-img").attr("src",b),y=t.backgroundImage.width;for(var n={width:y,height:$=t.backgroundImage.height},i=0;i<t.objects.length;i++)"textbox"==t.objects[i].objectType&&(t.objects[i].fontFamily=t.objects[i].fontFamily+"-palleon",t.objects[i].realFontSize=t.objects[i].fontSize,t.objects[i].fontSize=1);j.loadFromJSON(t,function(){var t;0!==(t=j.getObjects().filter(e=>"textbox"==e.objectType)).length&&e.each(t,function(e,t){var a=t.fontFamily.replace("-palleon","");t.fontFamily=p.fontFamily;var n="yes";if(""==a||q.includes(a))n="no";else for(var i=0;i<z.length;i++)if(z[i][1]==a){n="no";break}if("yes"==n){WebFont.load({google:{families:[a+":regular,bold",a+":italic,regular,bold"]}});var l=new FontFaceObserver(a,{weight:"normal",style:"normal"}),o=new FontFaceObserver(a,{weight:"bold",style:"normal"}),r=new FontFaceObserver(a,{weight:"normal",style:"italic"}),s=new FontFaceObserver(a,{weight:"bold",style:"italic"});Promise.all([l.load(null,5e3),o.load(null,5e3),r.load(null,5e3),s.load(null,5e3)]).then(function(){q.push(a),t.set("fontFamily",a),t.set("fontSize",t.realFontSize),j.requestRenderAll()}).catch(function(e){t.set("fontFamily",a),t.set("fontSize",t.realFontSize),j.requestRenderAll(),console.log(e)})}else t.set("fontFamily",a),t.set("fontSize",t.realFontSize),j.requestRenderAll()}),eb(),d.find("#palleon-canvas-color").spectrum("set",j.backgroundColor),d.find("#custom-image-background").spectrum("set",j.backgroundColor),v=d.find("#palleon-canvas-img")[0],j.requestRenderAll(),d.find("#palleon-canvas-loader").hide()},function(){},{crossOrigin:"anonymous"}),ee(new Date().getTime(),""),ek(n),ew(),el(),j.fire("selection:cleared"),setTimeout(function(){if(d.find("#palleon-layers > li").removeClass("active"),t.backgroundImage){var a;a=t.backgroundImage.filters,d.find("#palleon-brightness").prop("checked",!1),d.find("#palleon-contrast").prop("checked",!1),d.find("#palleon-saturation").prop("checked",!1),d.find("#palleon-hue").prop("checked",!1),d.find("#grayscale").prop("checked",!1),d.find("#sepia").prop("checked",!1),d.find("#brownie").prop("checked",!1),d.find("#blackwhite").prop("checked",!1),d.find("#vintage").prop("checked",!1),d.find("#kodachrome").prop("checked",!1),d.find("#polaroid").prop("checked",!1),d.find("#technicolor").prop("checked",!1),d.find("#invert").prop("checked",!1),d.find("#sharpen").prop("checked",!1),d.find("#emboss").prop("checked",!1),d.find("#palleon-gamma").prop("checked",!1),d.find("#palleon-blend-color").prop("checked",!1),d.find("#palleon-duotone-color").prop("checked",!1),d.find("#palleon-blur").prop("checked",!1),d.find("#palleon-noise").prop("checked",!1),d.find("#palleon-pixelate").prop("checked",!1),0!==a.length&&e.each(a,function(e,t){"Brightness"==t.type?(d.find("#palleon-brightness").prop("checked",!0),d.find("#brightness").val(t.brightness),d.find("#brightness").parent().parent().find(".slider-label span").html(t.brightness)):"Contrast"==t.type?(d.find("#palleon-contrast").prop("checked",!0),d.find("#contrast").val(t.brightness),d.find("#contrast").parent().parent().find(".slider-label span").html(t.contrast)):"Saturation"==t.type?(d.find("#palleon-saturation").prop("checked",!0),d.find("#saturation").val(t.brightness),d.find("#saturation").parent().parent().find(".slider-label span").html(t.saturation)):"HueRotation"==t.type?(d.find("#palleon-hue").prop("checked",!0),d.find("#hue").val(t.rotation),d.find("#hue").parent().parent().find(".slider-label span").html(t.rotation)):"Grayscale"==t.type?d.find("#grayscale").prop("checked",!0):"Sepia"==t.type?d.find("#sepia").prop("checked",!0):"Brownie"==t.type?d.find("#brownie").prop("checked",!0):"BlackWhite"==t.type?d.find("#blackwhite").prop("checked",!0):"Vintage"==t.type?d.find("#vintage").prop("checked",!0):"Kodachrome"==t.type?d.find("#kodachrome").prop("checked",!0):"Polaroid"==t.type?d.find("#polaroid").prop("checked",!0):"Technicolor"==t.type?d.find("#technicolor").prop("checked",!0):"Invert"==t.type?d.find("#invert").prop("checked",!0):"Convolute"==t.type?"[0,-1,0,-1,5,-1,0,-1,0]"==t.matrix?d.find("#sharpen").prop("checked",!0):"[1,1,1,1,0.7,-1,-1,-1,-1]"==t.matrix?d.find("#emboss").prop("checked",!0):"[-1,0,1,-2,0,2,-1,0,1]"==t.matrix?d.find("#sobelX").prop("checked",!0):"[-1,-2,-1,0,0,0,1,2,1]"==t.matrix&&d.find("#sobelY").prop("checked",!0):"Gamma"==t.type?(d.find("#palleon-gamma").prop("checked",!0),d.find("#gamma-red").val(t.gamma[0]),d.find("#gamma-red").parent().parent().find(".slider-label span").html(t.gamma[0]),d.find("#gamma-green").val(t.gamma[1]),d.find("#gamma-green").parent().parent().find(".slider-label span").html(t.gamma[1]),d.find("#gamma-blue").val(t.gamma[2]),d.find("#gamma-blue").parent().parent().find(".slider-label span").html(t.gamma[2])):"BlendColor"==t.type?(d.find("#palleon-blend-color").prop("checked",!0),d.find("#blend-color-mode").val(t.mode),d.find("#blend-color-color").val(t.color),d.find("#blend-color-alpha").val(t.alpha),d.find("#blend-color-alpha").parent().parent().find(".slider-label span").html(t.alpha)):"Composed"==t.type?(d.find("#palleon-duotone-color").prop("checked",!0),d.find("#duotone-light-color").val(t.subFilters[1].color),d.find("#duotone-dark-color").val(t.subFilters[2].color)):"Blur"==t.type?(d.find("#palleon-blur").prop("checked",!0),d.find("#blur").val(t.blur),d.find("#blur").parent().parent().find(".slider-label span").html(t.blur)):"Noise"==t.type?(d.find("#palleon-noise").prop("checked",!0),d.find("#noise").val(t.noise),d.find("#noise").parent().parent().find(".slider-label span").html(t.noise)):"Pixelate"==t.type&&(d.find("#palleon-pixelate").prop("checked",!0),d.find("#pixelate").val(t.blocksize),d.find("#pixelate").parent().parent().find(".slider-label span").html(t.blocksize))}),d.find("#palleon-brightness").trigger("change"),d.find("#palleon-contrast").trigger("change"),d.find("#palleon-saturation").trigger("change"),d.find("#palleon-hue").trigger("change"),d.find("#palleon-gamma").trigger("change"),d.find("#palleon-blend-color").trigger("change"),d.find("#palleon-blur").trigger("change"),d.find("#palleon-noise").trigger("change"),d.find("#palleon-pixelate").trigger("change")}t.overlayImage?(d.find("#palleon-overlay-wrap").show(),d.find("#palleon-overlay-preview").attr("src",t.overlayImage.src)):(d.find("#palleon-overlay-wrap").hide(),d.find("#palleon-overlay-preview").attr("src",""))},100)}function er(){if(p.watermark){var e=p.watermarkLocation,t=y*p.watermarkFontSize/1400,a=new fabric.Textbox(" "+p.watermarkText+" ",{objectType:"watermark",gradientFill:"none",fontSize:t,fontFamily:p.watermarkFontFamily,fontWeight:p.watermarkFontWeight,fontStyle:p.watermarkFontStyle,lineHeight:1,fill:p.watermarkFontColor,textBackgroundColor:p.watermarkBackgroundColor,width:eT()[0],left:0});j.add(a),"bottom-right"==e?(a.textAlign="right",a.top=eT()[1]-a.height):"bottom-left"==e?(a.textAlign="left",a.top=eT()[1]-a.height):"top-right"==e?(a.textAlign="right",a.top=0):"top-left"==e&&(a.textAlign="left",a.top=0),a.moveTo(999)}}function es(){p.watermark&&(en=j.getObjects()).filter(e=>"watermark"===e.objectType).forEach(e=>j.remove(e))}function ed(e){if(!e._objects)return!0;if("object"!=typeof e._objects[0].get("fill")){var t=(e._objects[0].get("fill")||"").toLowerCase();return e._objects.every(function(e){return(e.get("fill")||"").toLowerCase()===t})}}d.on("click","#palleon-modal-onstart",function(){d.find(".palleon-modal").hide(),d.find("#modal-add-new").show()}),d.find(".palleon-modal-open").on("click",function(t){t.preventDefault();var a=e(this).data("target");d.find(".palleon-modal").hide(),d.find(a).show()}),d.find(".palleon-modal-close").on("click",function(t){t.preventDefault();var a=e(this).data("target");d.find(a).hide()}),d.find("#palleon-image-upload").on("change",function(){d.find(".palleon-modal").hide(),d.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible");var e,t=new FileReader;t.onload=function(e){d.find("#palleon-canvas-img").attr("src",t.result),et("image")},t.readAsDataURL(this.files[0]),ee(this.files[0].name.replace(/\.[^/.]+$/,""),this.files[0].name.match(/\.[0-9a-z]+$/i)[0].replace(/\./g,""))}),d.find("#palleon-drag-drop-upload").on("dragover",function(t){t.preventDefault(),t.stopPropagation(),e(this).addClass("hovered")}),d.find("#palleon-drag-drop-upload").on("dragleave",function(t){t.preventDefault(),t.stopPropagation(),e(this).removeClass("hovered")}),d.find("#palleon-drag-drop-upload").on("click",function(e){d.find("#palleon-image-upload").trigger("click")}),d.find("#palleon-drag-drop-upload").on("drop",function(t){t.preventDefault(),t.stopPropagation(),d.find("#palleon-drag-drop-upload").removeClass("hovered");var a=t.originalEvent.dataTransfer.files,n=t.originalEvent.dataTransfer.getData("text/html"),i=a[0];if(i){var l=i.name.replace(/\.[^/.]+$/,""),o=i.name.split(".").pop();if(o){ee(l,o);var r=new FileReader;if("jpg"==o||"jpeg"==o||"png"==o||"webp"==o)r.onload=function(e){d.find("#palleon-canvas-img").attr("src",r.result),et("image")};else{d.find("#palleon-drag-drop-upload").removeClass("hovered"),toastr.warning(palleonParams.wrongFormat,palleonParams.warning);return}r.readAsDataURL(i)}else{toastr.warning(palleonParams.wrongFormat,palleonParams.warning);return}}else if(n){var s=e(n).attr("src");if(s){var c=s.split(".").pop();e(document).trigger("loadImgURL",[s,c])}else{toastr.warning(palleonParams.wrongFormat,palleonParams.warning);return}}}),d.find("#palleon-canvas-create").on("click",function(){ee(new Date().getTime(),""),et("canvas")}),d.find("#palleon-template-search").on("click",function(){var t=d.find("#palleon-templates-menu").val(),a=e(this).parent().find("input");if(d.find("#palleon-all-templates-noimg").addClass("d-none"),d.find("#palleon-templates-grid .grid-item").each(function(){e(this).attr("data-keyword",e(this).data("keyword").toLowerCase())}),e(this).hasClass("cancel"))d.find("#palleon-templates-menu").val("all").change(),d.find("#palleon-templates-menu").parent().find("span.select2-container").css("opacity",1),e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),a.val(""),d.find("#palleon-templates-grid .grid-item").show(),d.find("#palleon-templates-grid-pagination").length&&(d.find("#palleon-templates-grid-pagination").pagination("redraw"),d.find("#palleon-templates-grid-pagination").pagination("selectPage",1)),a.prop("disabled",!1),d.find("#palleon-templates-menu").prop("disabled",!1);else{d.find("#palleon-templates-menu").parent().find("span.select2-container").css("opacity",.5),e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var n=a.val().toLowerCase().replace(/\s/g," ");(""==n||n.length<1)&&"all"==t?(d.find("#palleon-templates-grid .grid-item").show(),d.find("#palleon-templates-grid-pagination").length&&(d.find("#palleon-templates-grid-pagination").pagination("redraw"),d.find("#palleon-templates-grid-pagination").pagination("selectPage",1))):(d.find("#palleon-templates-grid-pagination").length&&d.find("#palleon-templates-grid-pagination").pagination("destroy"),"all"==t?(""!=n||n.length>1)&&d.find("#palleon-templates-grid .grid-item").hide().filter('[data-keyword*="'+n+'"]').show():""!=n||n.length>1?d.find("#palleon-templates-grid .grid-item").hide().filter('[data-keyword*="'+n+'"]').filter('[data-category*="'+t+'"]').show():d.find("#palleon-templates-grid .grid-item").hide().filter('[data-category*="'+t+'"]').show(),0===d.find("#palleon-templates-grid .grid-item:visible").length&&d.find("#palleon-all-templates-noimg").removeClass("d-none")),a.prop("disabled",!0),d.find("#palleon-templates-menu").prop("disabled",!0)}}),d.find("#palleon-json-save").on("click",function(){var e=j.toJSON(P);G(e.backgroundImage.src,function(t){e.backgroundImage.src=t;var a=JSON.stringify(e),n=Math.random().toString(36).substr(2,9),i=d.find("#palleon-save-img-name").val();try{g.collection("assets").add({key:n,src:a,name:i,type:"json"}).then(e=>{toastr.success(palleonParams.tempsaved,palleonParams.saved),E()})}catch(l){toastr.error(l.message,palleonParams.error)}d.find(".palleon-modal").hide()})}),d.find("#palleon-json-download").on("click",function(){var e=d.find("#palleon-json-download-name").val(),t=j.toJSON(P);G(t.backgroundImage.src,function(a){t.backgroundImage.src=a;var n=JSON.stringify(t),i=document.createElement("a"),l=new Blob([n],{type:"text/plain"});i.href=URL.createObjectURL(l),i.download=e+".json",i.click(),d.find(".palleon-modal").hide()})}),e(document).on("loadTemplate",function(t,a,n,i){if(j.getObjects().filter(e=>"BG"!=e.objectType).forEach(e=>j.remove(e)),d.find("#palleon-layers li").remove(),eb(),a){var l=JSON.parse(a);G(l.backgroundImage.src,function(e){l.backgroundImage.src=e,eo(l),""!=i&&(j.backgroundColor=i),setTimeout(function(){d.find("#palleon-canvas-loader").hide()},500)})}else e.getJSON(n,function(e){eo(e),""!=i&&(j.backgroundColor=i)}).fail(function(e,t,a){toastr.error("Request Failed: "+a,palleonParams.error)}).always(function(){setTimeout(function(){d.find("#palleon-canvas-loader").hide()},500)})}),d.find("#palleon-json-upload").on("change",function(e){d.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),d.find("#palleon-canvas-loader").css("display","flex");var t=new FileReader,a="";t.onload=function(e){eo(a=JSON.parse(t.result)),d.find("#palleon-canvas-loader").hide(),setTimeout(function(){B(),eu('<span class="material-icons">flag</span>'+palleonParams.started)},100)},t.readAsText(e.target.files[0]),d.find(".palleon-modal").hide()}),p.templatePreview&&d.find("#palleon-templates-grid").on("mouseenter",".palleon-select-template",function(){var t=e(this).find("img.lazy").data("title"),a=e(this).find("img.lazy").data("preview");e(this).append('<div id="palleon-template-preview"><div class="palleon-img-wrap"><div class="palleon-img-loader"></div><img class="lazy" data-src="'+a+'" /></div><div id="palleon-template-preview-title">'+t+"</div></div>"),L.update()}).on("mousemove",".palleon-select-template",function(e){jQuery("#palleon-template-preview").position({my:"left+20 top",of:e,collision:"fit flip"})}).on("mouseleave",".palleon-select-template",function(){jQuery("#palleon-template-preview").remove()}),d.find(".template-selection").on("click",".palleon-select-template",function(){d.find("#palleon-canvas-wrap, .palleon-content-bar").css("visibility","visible"),d.find(".palleon-modal").hide(),d.find("#palleon-canvas-loader").css("display","flex"),j.getObjects().filter(e=>"BG"!=e.objectType).forEach(e=>j.remove(e)),d.find("#palleon-layers li").remove(),eb(),e.getJSON(e(this).data("json"),function(e){eo(e),setTimeout(function(){B(),eu('<span class="material-icons">flag</span>'+palleonParams.started)},100)}).fail(function(e,t,a){toastr.error("Request Failed: "+a,palleonParams.error)}).always(function(){d.find("#palleon-canvas-loader").hide()})}),d.find("#palleon-my-templates-search").on("click",function(){var t=e(this).parent().find("input");if(d.find("#palleon-my-templates-noimg").addClass("d-none"),d.find("#palleon-my-templates li").each(function(){e(this).attr("data-keyword",e(this).data("keyword").toLowerCase())}),""!=t.val()){if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),t.val(""),d.find("#palleon-my-templates li").show(),d.find("#palleon-my-templates-pagination").length&&(d.find("#palleon-my-templates-pagination").pagination("redraw"),d.find("#palleon-my-templates-pagination").pagination("selectPage",1)),t.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var a=t.val().toLowerCase().replace(/\s/g," ");console.log(a),""==a||a.length<1?(d.find("#palleon-my-templates li").show(),d.find("#palleon-my-templates-pagination").length&&(d.find("#palleon-my-templates-pagination").pagination("redraw"),d.find("#palleon-my-templates-pagination").pagination("selectPage",1))):(d.find("#palleon-my-templates-pagination").length&&d.find("#palleon-my-templates-pagination").pagination("destroy"),d.find("#palleon-my-templates li").hide().filter('[data-keyword*="'+a+'"]').show(),0===d.find("#palleon-my-templates li:visible").length&&d.find("#palleon-my-templates-noimg").removeClass("d-none")),t.prop("disabled",!0)}}}),d.find("#palleon-download").on("click",function(){var t=d.find("#palleon-download-name").val(),a=parseFloat(d.find("#palleon-download-quality").val()),n=d.find("#palleon-download-format").val(),i=document.createElement("a");er(),j.setZoom(1),d.find("#palleon-img-zoom").val(100);var l=$,o=y;(0==w||180==w||-180==w)&&(l=y,o=$),j.setWidth(l),j.setHeight(o);var r="";if("svg"==n){var s=j.toSVG({suppressPreamble:!1,width:y,height:$}),c=j.getObjects().filter(e=>"textbox"==e.objectType),p='<defs><style type="text/css"><![CDATA[',f=[],g="";e.each(c,function(e,t){for(var a=t.fontFamily,n="yes",i=0;i<z.length;i++)if(z[i][1]==a){n="no";break}"yes"!=n||f.includes(a)||f.push(a)}),f.length>0?e.each(f,function(a,l){var o=a==f.length-1,d=l.replace(/ /g,"+");e.ajax({url:"https://fonts.googleapis.com/css?family="+d+":italic,regular,bold",type:"GET",dataType:"text",crossDomain:!0,success:function(e){p+=e,setTimeout(function(){o&&(s=s.replace("<defs>",p+"]]></style>"),r=new Blob([s],{type:"image/svg+xml;charset=utf-8"}),g=URL.createObjectURL(r),i.download=t+"."+n,i.href=g,i.click())},500)},error:function(e,t,a){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})}):(r=new Blob([s],{type:"image/svg+xml;charset=utf-8"}),g=URL.createObjectURL(r),i.download=t+"."+n,i.href=g,i.click())}else if("tiff"==n){var h=j.toDataURL({format:"png",enableRetinaScaling:!1}),m=document.createElement("canvas");m.width=parseInt(d.find("#palleon-resize-width").val()),m.height=parseInt(d.find("#palleon-resize-height").val());var u=m.getContext("2d"),v=new Image;v.src=h,v.onload=function(){u.drawImage(this,0,0,m.width,m.height),CanvasToTIFF.toBlob(m,function(e){g=URL.createObjectURL(e),i.download=t+"."+n,i.href=g,i.click(),m.remove(),v.remove()},{dpi:parseInt(d.find("#palleon-download-img-dpi").val())})}}else{var h=j.toDataURL({format:n,quality:a,enableRetinaScaling:!1});"webp"!=n&&(h=changeDpiDataUrl(h,d.find("#palleon-download-img-dpi").val())),r=H(h),g=URL.createObjectURL(r),i.download=t+"."+n,i.href=g,i.click()}es(),ew(),j.requestRenderAll(),d.find(".palleon-modal").hide()}),d.find("#palleon-download-format").on("change",function(){"png"==e(this).val()||"svg"==e(this).val()?d.find("#palleon-download-quality").prop("disabled",!0):d.find("#palleon-download-quality").prop("disabled",!1)}),d.find("#palleon-save-img-format").on("change",function(){"png"==e(this).val()||"svg"==e(this).val()?d.find("#palleon-save-img-quality").prop("disabled",!0):d.find("#palleon-save-img-quality").prop("disabled",!1)}),d.find("#palleon-canvas-size-select").on("change",function(){"custom"==e(this).val()?(d.find("#palleon-canvas-width").prop("disabled",!1),d.find("#palleon-canvas-height").prop("disabled",!1)):(d.find("#palleon-canvas-width").prop("disabled",!0),d.find("#palleon-canvas-height").prop("disabled",!0)),d.find("#palleon-canvas-width").val(e(this).find(":selected").data("width")),d.find("#palleon-canvas-height").val(e(this).find(":selected").data("height"))}),d.find("#palleon-canvas-color").on("change",function(){var t=e(this).val();d.find("#custom-image-background").spectrum("set",t),""==t?(j.backgroundColor="transparent",j.requestRenderAll()):(j.backgroundColor=t,j.requestRenderAll())}),d.find("#palleon-media-library").on("click",function(){F="add-to-canvas"}),d.find("#palleon-img-media-library").on("click",function(){F="add-as-object"}),d.find("#palleon-img-replace-media-library").on("click",function(){F="replace-image"}),d.find("#palleon-overlay-img-media-library").on("click",function(){F="overlay-image"}),d.find("#modal-media-library").on("click",".media-library-grid>.palleon-masonry-item>.palleon-masonry-item-inner",function(){d.find("#palleon-canvas-loader").css("display","flex"),d.find("#palleon-canvas-wrap").css("visibility","visible");var t=e(this).find("img").data("full"),a=new Image;if("add-to-canvas"==F){var n="",i=e(this).find("img").data("filename");if(e(this).find("img").data("format"))n=e(this).find("img").data("format");else{var l=t.substring(0,t.indexOf("?"));n=""!=l?l.match(/\.[0-9a-z]+$/i)[0].replace(/\./g,""):t.match(/\.[0-9a-z]+$/i)[0].replace(/\./g,"")}ee(i,n),G(t,function(e){a.src=e,a.onload=function(){d.find("#palleon-canvas-img").attr("src",e),et("image")}})}else"add-as-object"==F?G(t,function(e){a.src=e,a.onload=function(){var e=new fabric.Image(a,{objectType:"image",objectCaching:!0,roundedCorders:0,stroke:"#fff",strokeWidth:0,top:eT()[1]/2,left:eT()[0]/2,originX:"center",originY:"center"});e.set({ogWidth:e.get("width"),ogHeight:e.get("height")}),j.add(e),e.scaleToWidth(eT()[0]/2),e.isPartiallyOnScreen()&&e.scaleToHeight(eT()[1]/2),j.setActiveObject(e),j.requestRenderAll(),d.find("#palleon-canvas-loader").hide(),j.fire("palleon:history",{type:"image",text:palleonParams.added})}}):"replace-image"==F?G(t,function(e){a.src=e,a.onload=function(){j.getActiveObject().setSrc(e),j.requestRenderAll(),d.find("#palleon-canvas-loader").hide(),j.fire("palleon:history",{type:"image",text:palleonParams.replaced})}}):"overlay-image"==F&&fabric.Image.fromURL(t,function(e){e.set({scaleX:eT()[0]/e.width,scaleY:eT()[1]/e.height,objectCaching:!1,originX:"left",originY:"top",selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0}),j.setOverlayImage(e,j.renderAll.bind(j)),d.find("#palleon-overlay-wrap").show(),d.find("#palleon-overlay-preview").attr("src",t),setTimeout(function(){d.find("#palleon-canvas-loader").hide()},500)});d.find("#modal-media-library").hide()}),d.find("#palleon-library-my-search").on("click",function(){var t=e(this).parent().find("input");if(d.find("#palleon-library-my-noimg").addClass("d-none"),""!=t.val()){if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),t.val(""),d.find("#palleon-library-my .palleon-masonry-item").show(),d.find("#palleon-library-my-pagination").length&&(d.find("#palleon-library-my-pagination").pagination("redraw"),d.find("#palleon-library-my-pagination").pagination("selectPage",1)),t.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var a=t.val().toLowerCase().replace(/\s/g," ");""==a||a.length<1?(d.find("#palleon-library-my .palleon-masonry-item").show(),d.find("#palleon-library-my-pagination").length&&(d.find("#palleon-library-my-pagination").pagination("redraw"),d.find("#palleon-library-my-pagination").pagination("selectPage",1))):(d.find("#palleon-library-my-pagination").length&&d.find("#palleon-library-my-pagination").pagination("destroy"),d.find("#palleon-library-my .palleon-masonry-item").hide().filter('[data-keyword*="'+a+'"]').show(),0===d.find("#palleon-library-my .palleon-masonry-item:visible").length&&d.find("#palleon-library-my-noimg").removeClass("d-none")),t.prop("disabled",!0)}}}),d.find("#palleon-library-all-search").on("click",function(){var t=e(this).parent().find("input");if(d.find("#palleon-library-all-noimg").addClass("d-none"),""!=t.val()){if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),t.val(""),d.find("#palleon-library-all .palleon-masonry-item").show(),d.find("#palleon-library-all-pagination").length&&(d.find("#palleon-library-all-pagination").pagination("redraw"),d.find("#palleon-library-all-pagination").pagination("selectPage",1)),t.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var a=t.val().toLowerCase().replace(/\s/g," ");""==a||a.length<1?(d.find("#palleon-library-all .palleon-masonry-item").show(),d.find("#palleon-library-all-pagination").length&&(d.find("#palleon-library-all-pagination").pagination("redraw"),d.find("#palleon-library-all-pagination").pagination("selectPage",1))):(d.find("#palleon-library-all-pagination").length&&d.find("#palleon-library-all-pagination").pagination("destroy"),d.find("#palleon-library-all .palleon-masonry-item").hide().filter('[data-keyword*="'+a+'"]').show(),0===d.find("#palleon-library-all .palleon-masonry-item:visible").length&&d.find("#palleon-library-all-noimg").removeClass("d-none")),t.prop("disabled",!0)}}}),d.find("#palleon-save-img").on("click",function(){var t=parseFloat(d.find("#palleon-save-img-quality").val()),a=d.find("#palleon-save-img-format").val(),n=d.find("#palleon-save-img-name").val(),i="";er(),j.setZoom(1),d.find("#palleon-img-zoom").val(100);var l=$,o=y;if((0==w||180==w||-180==w)&&(l=y,o=$),j.setWidth(l),j.setHeight(o),"svg"==a){i=j.toSVG({suppressPreamble:!1,width:y,height:$});var r=j.getObjects().filter(e=>"textbox"==e.objectType),s='<defs><style type="text/css"><![CDATA[',c=[];e.each(r,function(e,t){for(var a=t.fontFamily,n="yes",i=0;i<z.length;i++)if(z[i][1]==a){n="no";break}"yes"!=n||c.includes(a)||c.push(a)}),c.length>0&&e.each(c,function(t,a){var n=t==c.length-1,l=a.replace(/ /g,"+");e.ajax({url:"https://fonts.googleapis.com/css?family="+l+":italic,regular,bold",type:"GET",dataType:"text",crossDomain:!0,success:function(e){s+=e,setTimeout(function(){n&&(i=i.replace("<defs>",s+"]]></style>"))},500)},error:function(e,t,a){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error)}})})}else i=j.toDataURL({format:a,quality:t,enableRetinaScaling:!1}),"webp"!=a&&(i=changeDpiDataUrl(i,d.find("#palleon-save-img-dpi").val()));var p=Math.random().toString(36).substr(2,9);try{g.collection("assets").add({key:p,src:i,name:n,type:a}).then(e=>{toastr.success(palleonParams.imgsaved,palleonParams.saved),E()})}catch(f){toastr.error(f.message,palleonParams.error)}d.find(".palleon-modal").hide(),es(),ew(),j.requestRenderAll()}),d.find("#palleon-library-upload-img").on("change",function(e){var t=new FileReader;t.fileName=this.files[0].name,t.onload=function(e){var t=new Image;G(e.target.result,function(a){t.src=a,t.onload=function(){var t=Math.random().toString(36).substr(2,9);try{g.collection("assets").add({key:t,src:a,name:e.target.fileName,type:e.target.fileName.match(/\.[0-9a-z]+$/i)}).then(e=>{E()})}catch(n){toastr.error(n.message,palleonParams.error)}}})},t.readAsDataURL(e.target.files[0])}),d.find(".svg-library-grid").on("click",">.palleon-masonry-item>.palleon-masonry-item-inner",function(){var t=e(this).find("img").data("full");fabric.loadSVGFromURL(t,function(e,t){var a=fabric.util.groupSVGElements(e,t);a.set("originX","center"),a.set("originY","center"),a.set("left",eT()[0]/2),a.set("top",eT()[1]/2),ed(a)?(a.set("objectType","element"),j.fire("palleon:history",{type:"element",text:palleonParams.added})):(a.set("objectType","customSVG"),j.fire("palleon:history",{type:"customSVG",text:palleonParams.added})),a.scaleToWidth(eT()[0]/2),a.scaleToHeight(eT()[1]/2),j.add(a),j.setActiveObject(a),j.requestRenderAll()},function(){},{crossOrigin:"anonymous"}),d.find("#modal-svg-library").hide()}),d.find("#palleon-svg-library-my-search").on("click",function(){var t=e(this).parent().find("input");if(d.find("#palleon-svg-library-my-noimg").addClass("d-none"),""!=t.val()){if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),t.val(""),d.find("#palleon-svg-library-my .palleon-masonry-item").show(),d.find("#palleon-svg-library-my-pagination").length&&(d.find("#palleon-svg-library-my-pagination").pagination("redraw"),d.find("#palleon-svg-library-my-pagination").pagination("selectPage",1)),t.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var a=t.val().toLowerCase().replace(/\s/g," ");""==a||a.length<1?(d.find("#palleon-svg-library-my .palleon-masonry-item").show(),d.find("#palleon-svg-library-my-pagination").length&&(d.find("#palleon-svg-library-my-pagination").pagination("redraw"),d.find("#palleon-svg-library-my-pagination").pagination("selectPage",1))):(d.find("#palleon-svg-library-my-pagination").length&&d.find("#palleon-svg-library-my-pagination").pagination("destroy"),d.find("#palleon-svg-library-my .palleon-masonry-item").hide().filter('[data-keyword*="'+a+'"]').show(),0===d.find("#palleon-svg-library-my .palleon-masonry-item:visible").length&&d.find("#palleon-svg-library-my-noimg").removeClass("d-none")),t.prop("disabled",!0)}}}),d.find("#palleon-svg-library-all-search").on("click",function(){var t=e(this).parent().find("input");if(d.find("#palleon-library-all-noimg").addClass("d-none"),""!=t.val()){if(e(this).hasClass("cancel"))e(this).removeClass("cancel"),e(this).find(".material-icons").html("search"),e(this).removeClass("danger"),e(this).addClass("primary"),t.val(""),d.find("#palleon-svg-library-all .palleon-masonry-item").show(),d.find("#palleon-svg-library-all-pagination").length&&(d.find("#palleon-svg-library-all-pagination").pagination("redraw"),d.find("#palleon-svg-library-all-pagination").pagination("selectPage",1)),t.prop("disabled",!1);else{e(this).addClass("cancel"),e(this).find(".material-icons").html("close"),e(this).removeClass("primary"),e(this).addClass("danger");var a=t.val().toLowerCase().replace(/\s/g," ");""==a||a.length<1?(d.find("#palleon-svg-library-all .palleon-masonry-item").show(),d.find("#palleon-svg-library-all-pagination").length&&(d.find("#palleon-svg-library-all-pagination").pagination("redraw"),d.find("#palleon-svg-library-all-pagination").pagination("selectPage",1))):(d.find("#palleon-svg-library-all-pagination").length&&d.find("#palleon-svg-library-all-pagination").pagination("destroy"),d.find("#palleon-svg-library-all .palleon-masonry-item").hide().filter('[data-keyword*="'+a+'"]').show(),0===d.find("#palleon-svg-library-all .palleon-masonry-item:visible").length&&d.find("#palleon-svg-library-all-noimg").removeClass("d-none")),t.prop("disabled",!0)}}}),d.find("#palleon-svg-library-upload-img").on("change",function(e){var t=new FileReader;t.fileName=this.files[0].name,t.onload=function(e){var t=atob(e.target.result.replace(/data:image\/svg\+xml;base64,/,"")),a=Math.random().toString(36).substr(2,9);try{g.collection("assets").add({key:a,src:t,name:e.target.fileName,type:"svg"}).then(e=>{E()})}catch(n){toastr.error(n.message,palleonParams.error)}},t.readAsDataURL(e.target.files[0])});var ec=p.PexelsApiKey,ep=p.PixabayApiKey;function ef(e){if(!e.ok)throw Error(e.status);return e}if(""!=ec){function eg(t,a){var n=d.find("#pexels-orientation").val(),i=d.find("#pexels-color").val(),l=d.find("#palleon-pexels-keyword").val(),o="",r="";""==n&&""==i&&""==l?o="https://api.pexels.com/v1/curated?locale="+p.PexelsLanguage+"&page="+a+"&per_page="+p.PexelsPagination:(o="https://api.pexels.com/v1/search?locale="+p.PexelsLanguage+"&",""!=l?o+="query="+(l=encodeURIComponent(l))+"&":o+="query=&",""!=n&&(o+="orientation="+n+"&"),""!=i&&(o+="color="+i+"&"),o+="page="+a+"&per_page="+p.PexelsPagination);var s='<div class="palleon-grid media-library-grid pexels-grid">',c="</div>",f='<button id="pexels-loadmore" type="button" class="palleon-btn palleon-lg-btn primary" autocomplete="off" data-page="'+parseInt(a)+'">'+palleonParams.loadMore+"</button>";p.apiCaching&&sessionStorage.getItem(o)?("search"==t?d.find("#pexels-output").html(s+sessionStorage.getItem(o)+c+f):(d.find("#pexels-output > .pexels-grid").append(sessionStorage.getItem(o)),d.find("#pexels-loadmore").remove(),d.find("#pexels-output > .pexels-grid").after(f)),L.update(),d.find("#pexels").css("pointer-events","auto"),d.find("#pexels-menu,#pexels-output").css("opacity",1)):fetch(o,{method:"GET",headers:{Authorization:ec},redirect:"follow"}).then(ef).then(e=>e.json()).then(a=>{var n=a.photos;""==n?(r='<div class="notice notice-warning">'+palleonParams.nothing+"</div>","search"==t?d.find("#pexels-output").html(r):d.find("#pexels-loadmore").prop("disabled",!0)):(e.each(n,function(e,t){var a=t.id,n=t.url,i=t.src,l=i.tiny,o=i[p.PexelsImgSize],s=t.alt;r+='<div class="palleon-masonry-item">',r+='<a href="'+n+'" class="pexels-url" target="_blank"><span class="material-icons">info</span></a>',r+='<div class="palleon-masonry-item-inner">',r+='<div class="palleon-img-wrap">',r+='<div class="palleon-img-loader"></div>',r+='<img class="lazy" data-src="'+l+'" data-full="'+o+'" data-id="'+a+'" data-filename="pexels-'+a+'" title="'+s+'" />',r+="</div>",""!=s&&(r+='<div class="palleon-masonry-item-desc">'+s+"</div>"),r+="</div></div>"}),"search"==t?d.find("#pexels-output").html(s+r+c+f):(d.find("#pexels-output > .pexels-grid").append(r),d.find("#pexels-loadmore").remove(),d.find("#pexels-output > .pexels-grid").after(f)),p.apiCaching&&sessionStorage.setItem(o,r),L.update()),d.find("#pexels").css("pointer-events","auto"),d.find("#pexels-menu,#pexels-output").css("opacity",1)}).catch(e=>{toastr.error(palleonParams.pexelsApiError,e),d.find("#pexels").css("pointer-events","auto"),d.find("#pexels-menu,#pexels-output").css("opacity",1)})}eg("search","1"),d.find("#palleon-pexels-search").on("click",function(){d.find("#pexels").css("pointer-events","none"),d.find("#pexels-menu,#pexels-output").css("opacity",.5),eg("search","1")}),d.find("#pexels-output").on("click","#pexels-loadmore",function(){d.find("#pexels").css("pointer-events","none"),d.find("#pexels-menu,#pexels-output").css("opacity",.5),eg("loadmore",parseInt(e(this).data("page"))+1)}),d.find("#palleon-pexels-keyword").on("keyup input",function(){""==e(this).val()?(d.find("#pexels-orientation").val(""),d.find("#pexels-color").val(""),d.find("#pexels-orientation").prop("disabled",!0),d.find("#pexels-color").prop("disabled",!0)):(d.find("#pexels-orientation").prop("disabled",!1),d.find("#pexels-color").prop("disabled",!1))})}if(""!=ep){function eh(t,a){var n=d.find("#pixabay-orientation").val(),i=d.find("#pixabay-color").val(),l=d.find("#palleon-pixabay-keyword").val(),o=d.find("#pixabay-category").val(),r="",s="";""==n&&""==i&&""==l&&""==o?r="https://pixabay.com/api/?key="+ep+"&editors_choice=true&order=latest&image_type=photo&lang="+p.PixabayLanguage+"&safesearch="+p.PixabaySafeSearch+"&page="+a+"&per_page="+p.PixabayPagination:(r="https://pixabay.com/api/?key="+ep+"&image_type=photo&order=latest&lang="+p.PixabayLanguage+"&safesearch="+p.PixabaySafeSearch+"&editors_choice="+p.PixabayEditorsChice+"&",""!=l&&(r+="q="+(l=encodeURIComponent(l))+"&"),""!=n&&(r+="orientation="+n+"&"),""!=i&&(r+="color="+i+"&"),""!=o&&(r+="category="+o+"&"),r+="page="+a+"&per_page="+p.PixabayPagination);var c='<div class="palleon-grid media-library-grid pixabay-grid">',f="</div>",g='<button id="pixabay-loadmore" type="button" class="palleon-btn palleon-lg-btn primary" autocomplete="off" data-page="'+parseInt(a)+'">'+palleonParams.loadMore+"</button>";p.apiCaching&&sessionStorage.getItem(r)?("search"==t?d.find("#pixabay-output").html(c+sessionStorage.getItem(r)+f+g):(d.find("#pixabay-output > .pixabay-grid").append(sessionStorage.getItem(r)),d.find("#pixabay-loadmore").remove(),d.find("#pixabay-output > .pixabay-grid").after(g)),L.update(),d.find("#pixabay").css("pointer-events","auto"),d.find("#pixabay-menu,#pixabay-output").css("opacity",1)):e.ajax({url:r,type:"POST",timeout:0,crossDomain:!0,processData:!1,contentType:!1,success:function(a){if(a){if(parseInt(a.totalHits)>0){var n=a.hits;e.each(n,function(e,t){var a=t.id,n=t.pageURL,i=t.webformatURL,l=t.largeImageURL;void 0!==t.fullHDURL&&(l=t.fullHDURL);var o=t.tags;s+='<div class="palleon-masonry-item">',s+='<a href="'+n+'" class="pixabay-url" target="_blank"><span class="material-icons">info</span></a>',s+='<div class="palleon-masonry-item-inner">',s+='<div class="palleon-img-wrap">',s+='<div class="palleon-img-loader"></div>',s+='<img class="lazy" data-src="'+i+'" data-full="'+l+'" data-id="'+a+'" data-filename="pixabay-'+a+'" title="'+o+'" />',s+="</div>",""!=o&&(s+='<div class="palleon-masonry-item-desc">'+o+"</div>"),s+="</div></div>"}),"search"==t?d.find("#pixabay-output").html(c+s+f+g):(d.find("#pixabay-output > .pixabay-grid").append(s),d.find("#pixabay-loadmore").remove(),d.find("#pixabay-output > .pixabay-grid").after(g)),p.apiCaching&&sessionStorage.setItem(r,s),L.update()}else s='<div class="notice notice-warning">'+palleonParams.nothing+"</div>","search"==t?d.find("#pixabay-output").html(s):d.find("#pixabay-loadmore").prop("disabled",!0);d.find("#pixabay").css("pointer-events","auto"),d.find("#pixabay-menu,#pixabay-output").css("opacity",1)}},error:function(e,t,a){e.status&&400==e.status?toastr.error(e.responseText,palleonParams.error):toastr.error(palleonParams.wrong,palleonParams.error),d.find("#pixabay").css("pointer-events","auto"),d.find("#pixabay-menu,#pixabay-output").css("opacity",1)}})}eh("search","1"),d.find("#palleon-pixabay-search").on("click",function(){d.find("#pixabay").css("pointer-events","none"),d.find("#pixabay-menu,#pixabay-output").css("opacity",.5),eh("search","1")}),d.find("#pixabay-output").on("click","#pixabay-loadmore",function(){d.find("#pixabay").css("pointer-events","none"),d.find("#pixabay-menu,#pixabay-output").css("opacity",.5),eh("loadmore",parseInt(e(this).data("page"))+1)})}function em(e){var t=palleonParams.object,a="category";return null==e?(t=palleonParams.object,a="category"):"textbox"==e?(t=palleonParams.text,a="title"):"drawing"==e?(t=palleonParams.freeDrawing,a="brush"):"frame"==e?(t=palleonParams.frame,a="wallpaper"):"image"==e?(t=palleonParams.image,a="image"):"circle"==e?t=palleonParams.circle:"square"==e?t=palleonParams.square:"rectangle"==e?t=palleonParams.rectangle:"triangle"==e?t=palleonParams.triangle:"ellipse"==e?t=palleonParams.ellipse:"trapezoid"==e?t=palleonParams.trapezoid:"pentagon"==e?t=palleonParams.pentagon:"octagon"==e?t=palleonParams.octagon:"emerald"==e?t=palleonParams.emerald:"diamond"==e?t=palleonParams.diamond:"parallelogram"==e?t=palleonParams.parallelogram:"star"==e?t=palleonParams.star:"element"==e?(t=palleonParams.element,a="star"):"BG"==e?(t=palleonParams.bg,a="image"):"customShape"==e?t=palleonParams.customShape:"customSVG"==e?t=palleonParams.customSvg:"apps"==e&&(t=palleonParams.app,a="apps"),'<span class="material-icons">'+a+"</span>"+t}function eu(e){var t,a=d.find("#palleon-history-list"),n=new Date,i=String(n.getHours()).padStart(2,"0")+":"+String(n.getMinutes()).padStart(2,"0")+":"+String(n.getSeconds()).padStart(2,"0"),l=j.toJSON(P);d.find("#palleon-history").prop("disabled",!1),a.find("li").removeClass("active"),a.prepend('<li class="active"><div class="info">'+e+'<span class="time">'+i+'</span></div><div><button type="button" class="palleon-btn primary"><span class="material-icons">restore</span>Restore</button><button type="button" class="palleon-btn danger"><span class="material-icons">clear</span>Delete</button><script type="text/json">'+JSON.stringify(l)+"</script></div></li>"),a.find("li").length>a.data("max")&&a.find("li").last().remove(),d.find("#palleon-history-count").html(a.find("li").length);var o=a.find("li.active").next("li"),r=a.find("li.active").prev("li");o.length?d.find("#palleon-undo").prop("disabled",!1):d.find("#palleon-undo").prop("disabled",!0),r.length?d.find("#palleon-redo").prop("disabled",!1):d.find("#palleon-redo").prop("disabled",!0)}d.find("#palleon-undo").on("click",function(){var e=d.find("#palleon-history-list li.active").next("li");e.length?(e.find(".palleon-btn.primary").trigger("click"),d.find("#palleon-redo").prop("disabled",!1)):d.find("#palleon-undo").prop("disabled",!0)}),d.find("#palleon-redo").on("click",function(){var e=d.find("#palleon-history-list li.active").prev("li");e.length?(e.find(".palleon-btn.primary").trigger("click"),d.find("#palleon-undo").prop("disabled",!1)):d.find("#palleon-redo").prop("disabled",!0)}),d.find("#palleon-history-list").on("click",".palleon-btn.danger",function(){e(this).parent().parent().remove(),e("#palleon-history-list li").length||(d.find("#palleon-history").prop("disabled",!0),d.find("#palleon-undo").prop("disabled",!0),d.find("#palleon-redo").prop("disabled",!0),d.find(".palleon-modal").hide())}),d.find("#palleon-history-list").on("click",".palleon-btn.primary",function(){d.find("#palleon-history-list li").removeClass("active"),e(this).parent().parent().addClass("active");var t=d.find("#palleon-history-list li.active").next("li"),a=d.find("#palleon-history-list li.active").prev("li");t.length?d.find("#palleon-undo").prop("disabled",!1):d.find("#palleon-undo").prop("disabled",!0),a.length?d.find("#palleon-redo").prop("disabled",!1):d.find("#palleon-redo").prop("disabled",!0);var n=JSON.parse(e(this).parent().find("script").html());d.find(".palleon-modal").hide(),G(n.backgroundImage.src,function(e){n.backgroundImage.src=e,eo(n),d.find("#palleon-canvas-loader").hide()})}),d.find("#palleon-clear-history").on("click",function(){window.confirm(palleonParams.question1)&&(d.find("#palleon-history-list li").remove(),d.find("#palleon-history").prop("disabled",!0),d.find("#palleon-undo").prop("disabled",!0),d.find("#palleon-redo").prop("disabled",!0),d.find(".palleon-modal").hide())}),j.on("palleon:history",function(e){eu(em(e.type)+" "+e.text)});var ev=!1;function eb(){d.find("#palleon-layers li").length?(d.find("#palleon-no-layer").hide(),d.find("#palleon-layer-delete-wrap").css("visibility","visible")):(d.find("#palleon-no-layer").show(),d.find("#palleon-layer-delete-wrap").css("visibility","hidden"))}function ey(t){if(!m){if(d.find("#palleon-layers li").removeClass("active"),t.length>=2)for(var a,n,i,l,o=0;o<t.length;o++)d.find("#palleon-layers #"+t[o].id).addClass("active");else{void 0!==(t=t[0])&&t.objectType?("textbox"==t.objectType?(d.find("#palleon-text-settings").show(),a=t,d.find("#palleon-text-input").val(a.text),d.find("#palleon-font-family").val(a.fontFamily),d.find("#palleon-font-family").trigger("change"),"none"==a.gradientFill||""==a.gradientFill||void 0===a.gradientFill?(d.find("#palleon-text-gradient").val("none"),d.find("#palleon-text-color").spectrum("set",a.fill)):"vertical"==a.gradientFill?d.find("#palleon-text-gradient").val("vertical"):"horizontal"==a.gradientFill?d.find("#palleon-text-gradient").val("horizontal"):"diagonal"==a.gradientFill&&d.find("#palleon-text-gradient").val("diagonal"),("vertical"==a.gradientFill||"horizontal"==a.gradientFill||"diagonal"==a.gradientFill)&&(4==a.fill.colorStops.length?(d.find("#text-gradient-color-1").spectrum("set",a.fill.colorStops[0].color),d.find("#text-gradient-color-2").spectrum("set",a.fill.colorStops[1].color),d.find("#text-gradient-color-3").spectrum("set",a.fill.colorStops[2].color),d.find("#text-gradient-color-4").spectrum("set",a.fill.colorStops[3].color)):3==a.fill.colorStops.length?(d.find("#text-gradient-color-1").spectrum("set",a.fill.colorStops[0].color),d.find("#text-gradient-color-2").spectrum("set",a.fill.colorStops[1].color),d.find("#text-gradient-color-3").spectrum("set",a.fill.colorStops[2].color),d.find("#text-gradient-color-4").spectrum("set","")):2==a.fill.colorStops.length&&(d.find("#text-gradient-color-1").spectrum("set",a.fill.colorStops[0].color),d.find("#text-gradient-color-2").spectrum("set",a.fill.colorStops[1].color),d.find("#text-gradient-color-3").spectrum("set",""),d.find("#text-gradient-color-4").spectrum("set",""))),d.find("#palleon-text-gradient").trigger("change"),"bold"==a.fontWeight?d.find("#format-bold").addClass("active"):d.find("#format-bold").removeClass("active"),"italic"==a.fontStyle?d.find("#format-italic").addClass("active"):d.find("#format-italic").removeClass("active"),!0==a.underline?d.find("#format-underline").addClass("active"):d.find("#format-underline").removeClass("active"),"left"==a.textAlign&&(d.find(".format-align").removeClass("active"),d.find("#format-align-left").addClass("active")),"right"==a.textAlign&&(d.find(".format-align").removeClass("active"),d.find("#format-align-right").addClass("active")),"center"==a.textAlign&&(d.find(".format-align").removeClass("active"),d.find("#format-align-center").addClass("active")),"justify"==a.textAlign&&(d.find(".format-align").removeClass("active"),d.find("#format-align-justify").addClass("active")),d.find("#palleon-font-size").val(a.fontSize),d.find("#palleon-outline-size").val(a.strokeWidth),d.find("#palleon-line-height").val(a.lineHeight),d.find("#palleon-letter-spacing").val(a.charSpacing),d.find("#palleon-outline-color").spectrum("set",a.stroke),d.find("#palleon-text-background").spectrum("set",a.textBackgroundColor),null==a.shadow?d.find("#palleon-text-shadow").prop("checked",!1):(d.find("#palleon-text-shadow").prop("checked",!0),d.find("#text-shadow-color").spectrum("set",a.shadow.color),d.find("#text-shadow-blur").val(a.shadow.blur),d.find("#text-shadow-offset-x").val(a.shadow.offsetX),d.find("#text-shadow-offset-y").val(a.shadow.offsetY)),d.find("#palleon-text-shadow").trigger("change"),!0==a.flipX?d.find("#text-flip-x").addClass("active"):d.find("#text-flip-x").removeClass("active"),!0==a.flipY?d.find("#text-flip-y").addClass("active"):d.find("#text-flip-y").removeClass("active"),d.find("#text-skew-x").val(a.skewX),d.find("#text-skew-x").parent().parent().find(".slider-label span").html(a.skewX),d.find("#text-skew-y").val(a.skewY),d.find("#text-skew-y").parent().parent().find(".slider-label span").html(a.skewY),d.find("#text-rotate").val(parseInt(a.angle)),d.find("#text-rotate").parent().parent().find(".slider-label span").html(parseInt(a.angle)),d.find("#palleon-btn-text").hasClass("active")||d.find("#palleon-btn-text").trigger("click"),d.find("#palleon-font-family").trigger("change")):d.find("#palleon-text-settings").hide(),"image"==t.objectType?(d.find("#palleon-image-settings").show(),""==(n=t).filters?d.find("#image-filter").val("none"):d.find("#image-filter").val(n.filters[0].type.toLowerCase()),void 0===n.clipPath?d.find("#palleon-img-mask").val("none"):null==n.clipPath?d.find("#palleon-img-mask").val("none"):void 0===n.clipPath.maskType?d.find("#palleon-img-mask").val("none"):null==n.clipPath.maskType?d.find("#palleon-img-mask").val("none"):d.find("#palleon-img-mask").val(n.clipPath.maskType),d.find("#img-border-radius").val(n.roundedCorders),d.find("#img-border-radius").parent().parent().find(".slider-label span").html(n.roundedCorders),null==n.shadow?d.find("#palleon-image-shadow").prop("checked",!1):(d.find("#palleon-image-shadow").prop("checked",!0),d.find("#image-shadow-color").spectrum("set",n.shadow.color),d.find("#image-shadow-blur").val(n.shadow.blur),d.find("#image-shadow-offset-x").val(n.shadow.offsetX),d.find("#image-shadow-offset-y").val(n.shadow.offsetY)),d.find("#palleon-image-shadow").trigger("change"),d.find("#img-border-width").val(n.strokeWidth),d.find("#img-border-color").spectrum("set",n.stroke),d.find("#img-opacity").val(n.opacity),d.find("#img-opacity").parent().parent().find(".slider-label span").html(n.opacity),d.find("#img-skew-x").val(n.skewX),d.find("#img-skew-x").parent().parent().find(".slider-label span").html(n.skewX),d.find("#img-skew-y").val(n.skewY),d.find("#img-skew-y").parent().parent().find(".slider-label span").html(n.skewY),d.find("#img-rotate").val(parseInt(n.angle)),d.find("#img-rotate").parent().parent().find(".slider-label span").html(parseInt(n.angle)),d.find("#palleon-btn-image").hasClass("active")||(d.find("#palleon-btn-image").trigger("click"),d.find("#palleon-img-mode").trigger("click"))):d.find("#palleon-image-settings").hide(),"frame"==t.objectType&&(d.find("#palleon-btn-frames").hasClass("active")||d.find("#palleon-btn-frames").trigger("click"),d.find("#palleon-frame-setting-tab").trigger("click"),ed(t)?d.find("#palleon-frame-single-color").show():d.find("#palleon-frame-single-color").hide()),"element"==t.objectType?(d.find("#palleon-custom-element-options").show(),"none"==(i=t).gradientFill||""==i.gradientFill||void 0===i.gradientFill?(d.find("#palleon-element-gradient").val("none"),d.find("#palleon-element-color").spectrum("set",i.fill)):"vertical"==i.gradientFill?d.find("#palleon-element-gradient").val("vertical"):"horizontal"==i.gradientFill?d.find("#palleon-element-gradient").val("horizontal"):"diagonal"==i.gradientFill&&d.find("#palleon-element-gradient").val("diagonal"),("vertical"==i.gradientFill||"horizontal"==i.gradientFill||"diagonal"==i.gradientFill)&&(4==i.fill.colorStops.length?(d.find("#element-gradient-color-1").spectrum("set",i.fill.colorStops[0].color),d.find("#element-gradient-color-2").spectrum("set",i.fill.colorStops[1].color),d.find("#element-gradient-color-3").spectrum("set",i.fill.colorStops[2].color),d.find("#element-gradient-color-4").spectrum("set",i.fill.colorStops[3].color)):3==i.fill.colorStops.length?(d.find("#element-gradient-color-1").spectrum("set",i.fill.colorStops[0].color),d.find("#element-gradient-color-2").spectrum("set",i.fill.colorStops[1].color),d.find("#element-gradient-color-3").spectrum("set",i.fill.colorStops[2].color),d.find("#element-gradient-color-4").spectrum("set","")):2==i.fill.colorStops.length&&(d.find("#element-gradient-color-1").spectrum("set",i.fill.colorStops[0].color),d.find("#element-gradient-color-2").spectrum("set",i.fill.colorStops[1].color),d.find("#element-gradient-color-3").spectrum("set",""),d.find("#element-gradient-color-4").spectrum("set",""))),d.find("#palleon-element-gradient").trigger("change"),d.find("#element-opacity").val(i.opacity),d.find("#element-opacity").parent().parent().find(".slider-label span").html(i.opacity),d.find("#element-skew-x").val(i.skewX),d.find("#element-skew-x").parent().parent().find(".slider-label span").html(i.skewX),d.find("#element-skew-y").val(i.skewY),d.find("#element-skew-y").parent().parent().find(".slider-label span").html(i.skewY),d.find("#element-rotate").val(parseInt(i.angle)),d.find("#element-rotate").parent().parent().find(".slider-label span").html(parseInt(i.angle)),null==i.shadow?d.find("#palleon-element-shadow").prop("checked",!1):(d.find("#palleon-element-shadow").prop("checked",!0),d.find("#element-shadow-color").spectrum("set",i.shadow.color),d.find("#element-shadow-blur").val(i.shadow.blur),d.find("#element-shadow-offset-x").val(i.shadow.offsetX),d.find("#element-shadow-offset-y").val(i.shadow.offsetY)),d.find("#palleon-element-shadow").trigger("change"),d.find("#palleon-btn-elements").hasClass("active")||d.find("#palleon-btn-elements").trigger("click"),d.find("#palleon-custom-svg-open").trigger("click")):d.find("#palleon-custom-element-options").hide(),"customSVG"==t.objectType?(d.find("#palleon-custom-svg-options").show(),function t(a){if(a._objects){var n=[],i="";e.each(a._objects,function(e,t){-1===n.indexOf(t.get("fill"))&&n.push(t.get("fill"))}),e.each(n,function(e,t){if("string"==typeof t||t instanceof String){var a=e+1;i+='<div class="palleon-control-wrap control-text-color"><label class="palleon-control-label">'+palleonParams.fillColor+" "+a+'</label><div class="palleon-control"><input id="customsvg-color-'+a+'" type="text" data-color="'+t+'" class="customsvg-color palleon-colorpicker disallow-empty" autocomplete="off" value="'+t+'" /></div></div>'}}),d.find("#customsvg-colors").html(i),d.find(".customsvg-color").spectrum({allowEmpty:!1,showInitial:!0,hideAfterPaletteSelect:!0,showSelectionPalette:!0,localStorageKey:"spectrum.palleon",showAlpha:!0})}d.find("#customsvg-opacity").val(a.opacity),d.find("#customsvg-opacity").parent().parent().find(".slider-label span").html(a.opacity),d.find("#customsvg-skew-x").val(a.skewX),d.find("#customsvg-skew-x").parent().parent().find(".slider-label span").html(a.skewX),d.find("#customsvg-skew-y").val(a.skewY),d.find("#customsvg-skew-y").parent().parent().find(".slider-label span").html(a.skewY),d.find("#customsvg-rotate").val(parseInt(a.angle)),d.find("#customsvg-rotate").parent().parent().find(".slider-label span").html(parseInt(a.angle))}(t),d.find("#palleon-btn-elements").hasClass("active")||d.find("#palleon-btn-elements").trigger("click"),d.find("#palleon-custom-svg-open").trigger("click")):d.find("#palleon-custom-svg-options").hide(),Y.includes(t.objectType)?(X.includes(t.objectType)?d.find("#shape-custom-width-wrap").show():d.find("#shape-custom-width-wrap").hide(),d.find("#palleon-shape-settings").show(),l=t,d.find("#palleon-shape-settings-info").hide(),d.find("#shape-outline-width").val(l.strokeWidth),"none"==l.gradientFill||""==l.gradientFill||void 0===l.gradientFill?(d.find("#palleon-shape-gradient").val("none"),d.find("#palleon-shape-color").spectrum("set",l.fill)):"vertical"==l.gradientFill?d.find("#palleon-shape-gradient").val("vertical"):"horizontal"==l.gradientFill?d.find("#palleon-shape-gradient").val("horizontal"):"diagonal"==l.gradientFill&&d.find("#palleon-shape-gradient").val("diagonal"),("vertical"==l.gradientFill||"horizontal"==l.gradientFill||"diagonal"==l.gradientFill)&&(4==l.fill.colorStops.length?(d.find("#shape-gradient-color-1").spectrum("set",l.fill.colorStops[0].color),d.find("#shape-gradient-color-2").spectrum("set",l.fill.colorStops[1].color),d.find("#shape-gradient-color-3").spectrum("set",l.fill.colorStops[2].color),d.find("#shape-gradient-color-4").spectrum("set",l.fill.colorStops[3].color)):3==l.fill.colorStops.length?(d.find("#shape-gradient-color-1").spectrum("set",l.fill.colorStops[0].color),d.find("#shape-gradient-color-2").spectrum("set",l.fill.colorStops[1].color),d.find("#shape-gradient-color-3").spectrum("set",l.fill.colorStops[2].color),d.find("#shape-gradient-color-4").spectrum("set","")):2==l.fill.colorStops.length&&(d.find("#shape-gradient-color-1").spectrum("set",l.fill.colorStops[0].color),d.find("#shape-gradient-color-2").spectrum("set",l.fill.colorStops[1].color),d.find("#shape-gradient-color-3").spectrum("set",""),d.find("#shape-gradient-color-4").spectrum("set",""))),d.find("#palleon-shape-gradient").trigger("change"),d.find("#shape-outline-color").spectrum("set",l.stroke),null==l.shadow?d.find("#palleon-shape-shadow").prop("checked",!1):(d.find("#palleon-shape-shadow").prop("checked",!0),d.find("#shape-shadow-color").spectrum("set",l.shadow.color),d.find("#shape-shadow-blur").val(l.shadow.blur),d.find("#shape-shadow-offset-x").val(l.shadow.offsetX),d.find("#shape-shadow-offset-y").val(l.shadow.offsetY)),d.find("#palleon-shape-shadow").trigger("change"),null==l.strokeDashArray?d.find("#palleon-shape-dashed-outline").prop("checked",!1):Array.isArray(l.strokeDashArray)&&(d.find("#palleon-shape-dashed-outline").prop("checked",!0),d.find("#shape-dashed-outline-width").val(l.strokeDashArray[0]),d.find("#shape-dashed-outline-spacing").val(l.strokeDashArray[1])),d.find("#palleon-shape-dashed-outline").trigger("change"),d.find("#shape-opacity").val(l.opacity),d.find("#shape-opacity").parent().parent().find(".slider-label span").html(l.opacity),d.find("#shape-skew-x").val(l.skewX),d.find("#shape-skew-x").parent().parent().find(".slider-label span").html(l.skewX),d.find("#shape-skew-y").val(l.skewX),d.find("#shape-skew-y").parent().parent().find(".slider-label span").html(l.skewY),d.find("#shape-rotate").val(parseInt(l.angle)),d.find("#shape-rotate").parent().parent().find(".slider-label span").html(parseInt(l.angle)),"square"==l.objectType||"rectangle"==l.objectType?d.find("#palleon-shape-rounded-corners").show():d.find("#palleon-shape-rounded-corners").hide(),void 0!==l.rx?(d.find("#shape-rounded-corners").val(parseInt(l.rx)),d.find("#shape-rounded-corners").parent().parent().find(".slider-label span").html(parseInt(l.rx))):(d.find("#shape-rounded-corners").val(0),d.find("#shape-rounded-corners").parent().parent().find(".slider-label span").html(0)),"printarea"==l.objectType?(d.find("#shape-custom-width").val(l.width),d.find("#shape-custom-height").val(l.height)):(d.find("#shape-custom-width").val(""),d.find("#shape-custom-height").val("")),d.find("#palleon-btn-shapes").hasClass("active")||d.find("#palleon-btn-shapes").trigger("click"),d.find("#palleon-shape-setting-open").trigger("click")):d.find("#palleon-shape-settings").hide(),t.id&&d.find("#palleon-layers #"+t.id).addClass("active")):e.each(t,function(e,t){d.find("#palleon-layers #"+t.id).addClass("active")})}}}function e$(){fabric.Image.fromURL(b,function(e){j.setBackgroundImage(e,j.renderAll.bind(j),{objectType:"BG",mode:u,top:0,left:0,scaleX:k,scaleY:_,selectable:!1,angle:w,originX:x,originY:C,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0},{crossOrigin:"anonymous"})})}function ew(e){var t=$,a=y;if((0==w||180==w||-180==w)&&(t=y,a=$),e)e/=100,j.setZoom(e);else{var n=d.find("#palleon-img-zoom").val(),i=100,l=1,o=0;t<d.find("#palleon-content").width()&&a<d.find("#palleon-content").height()?(j.setZoom(1),d.find("#palleon-img-zoom").val(100)):(t>d.find("#palleon-content").width()&&n>(i=100*(l=(d.find("#palleon-content").width()-60)/t).toFixed(2))&&(j.setZoom(l.toFixed(2)),d.find("#palleon-img-zoom").val(100*l.toFixed(2)),o=l.toFixed(2)),a>d.find("#palleon-content").height()&&n>(i=100*(l=d.find("#palleon-content").height()/a).toFixed(2))&&(0===o||o>l.toFixed(2))&&(j.setZoom(l.toFixed(2)),d.find("#palleon-img-zoom").val(100*l.toFixed(2))))}j.setWidth(t*j.getZoom()),j.setHeight(a*j.getZoom()),!0===j.isDrawingMode&&(d.find("#palleon-erase-btn").hasClass("active")&&d.find("#eraser-width").trigger("input"),d.find("#palleon-draw-btn").hasClass("active")&&d.find("#brush-width").trigger("input"))}j.on("mouse:up",function(e){var t=e.target;if(null!==t){var a=t.objectType;ev&&eu(em(a)+" "+palleonParams.moved)}void 0!==j.overlayImage&&null!==j.overlayImage&&j.overlayImage.set("opacity",1)}),j.on("object:moving",function(e){ev=!0,void 0!==j.overlayImage&&null!==j.overlayImage&&j.overlayImage.set("opacity",.7);var t=$,a=y;(0==w||180==w||-180==w)&&(t=y,a=$);var n=e.target,i=n.getScaledWidth(),l=n.getScaledHeight();n.isPartiallyOnScreen()&&"clipPath"==n.objectType&&(n.top<0&&n.left<0?(n.top=0,n.left=0,n.lockMovementX=!0,n.lockMovementY=!0):n.top<0&&i+n.left>t?(n.top=0,n.left=t-i,n.lockMovementX=!0,n.lockMovementY=!0):l+n.top>a&&n.left<0?(n.top=a-l,n.left=0,n.lockMovementX=!0,n.lockMovementY=!0):l+n.top>a&&i+n.left>t?(n.top=a-l,n.left=t-i,n.lockMovementX=!0,n.lockMovementY=!0):n.top<0?(n.top=0,n.lockMovementY=!0):n.left<0?(n.left=0,n.lockMovementX=!0):i+n.left>t?(n.left=t-i,n.lockMovementX=!0):l+n.top>a&&(n.top=a-l,n.lockMovementY=!0),n.setCoords())}),j.on("object:scaling",function(e){var t=$,a=y;(0==w||180==w||-180==w)&&(t=y,a=$);var n=e.target,i=n.getScaledWidth(),l=n.getScaledHeight();n.isPartiallyOnScreen()&&"clipPath"==n.objectType&&(i>=t&&(n.set({scaleX:t/n.width}),n.lockScalingX=!0),l>=a&&(n.set({scaleY:a/n.height}),n.lockScalingY=!0),n.top<0&&(n.top=0,n.lockScalingX=!0,n.lockScalingY=!0,n.setCoords()),n.left<0&&(n.left=0,n.lockScalingX=!0,n.lockScalingY=!0,n.setCoords()),i+n.left>t&&(n.left=t-i,n.lockScalingX=!0,n.lockScalingY=!0,n.setCoords()),l+n.top>a&&(n.top=a-l,n.lockScalingX=!0,n.lockScalingY=!0,n.setCoords()))}),j.on("object:added",function(t){var a=t.target;if("clipPath"!=a.objectType&&"watermark"!=a.objectType){!0===j.isDrawingMode&&(a.set("objectType","drawing"),a.set("selectable",!0),a.set("lockScalingX",!0),a.set("lockScalingY",!0),a.set("lockRotation",!0),a.setControlsVisibility({mt:!1,mb:!1,ml:!1,mr:!1,bl:!1,br:!1,tl:!1,tr:!1,mtr:!1}));var n,i,l,o,r,s,c=j.getObjects().indexOf(a),p="",f="Object",g="category",h="layer-visible",m="visibility",u="layer-unlocked",v="lock_open";if(!1==a.visible&&(h="layer-hidden",m="visibility_off"),!1==a.selectable&&(u="layer-locked",v="lock"),a.set("id",new Date().getTime()),d.find("#palleon-layers > li").removeClass("active"),"textbox"==a.objectType?(f=a.text,g="title"):"drawing"==a.objectType?(f=palleonParams.freeDrawing,g="brush"):"frame"==a.objectType?(f=palleonParams.frame,g="wallpaper"):"image"==a.objectType?(f=palleonParams.image,g="image"):"circle"==a.objectType?f=palleonParams.circle:"square"==a.objectType?f=palleonParams.square:"rectangle"==a.objectType?f=palleonParams.rectangle:"triangle"==a.objectType?f=palleonParams.triangle:"ellipse"==a.objectType?f=palleonParams.ellipse:"trapezoid"==a.objectType?f=palleonParams.trapezoid:"pentagon"==a.objectType?f=palleonParams.pentagon:"octagon"==a.objectType?f=palleonParams.octagon:"emerald"==a.objectType?f=palleonParams.emerald:"diamond"==a.objectType?f=palleonParams.diamond:"parallelogram"==a.objectType?f=palleonParams.parallelogram:"star"==a.objectType?f=palleonParams.star:"element"==a.objectType?(f=palleonParams.element,g="star"):"customShape"==a.objectType?f=palleonParams.customShape:"customSVG"==a.objectType?f=palleonParams.customSvg:"app"==a.objectType&&(f=palleonParams.app,g="apps"),"layerName"in a&&(f=a.layerName),p='<li id="'+a.id+'" data-type="'+a.objectType+'" class="layer-'+a.objectType+' active" data-sort="'+c+'"><span class="material-icons">'+g+'</span><input type="text" class="layer-name" autocomplete="off" value="'+f+'" /><span class="material-icons layer-settings">settings</span><div class="layer-icons"><a class="material-icons lock-layer '+u+'" title="'+palleonParams.lockunlock+'">'+v+'</a><a class="material-icons text-success duplicate-layer" title="'+palleonParams.duplicate+'">content_copy</a><a class="material-icons layer-visibility '+h+'" title="'+palleonParams.showhide+'">'+m+'</a><a class="material-icons text-danger delete-layer" title="'+palleonParams.delete+'">clear</a></div></li>',d.find("#palleon-layers").prepend(p),l=a.id,(o=d.find("#palleon-layers #"+l)).find("a.delete-layer").on("click",function(e){e.preventDefault(),j.fire("palleon:history",{type:o.data("type"),text:palleonParams.removed}),j.getObjects().filter(e=>e.id==l).forEach(e=>j.remove(e)),o.remove(),j.requestRenderAll(),d.find("#palleon-layers").sortable("refresh"),eb()}),r=a.id,(s=d.find("#palleon-layers #"+r)).find("a.duplicate-layer").on("click",function(e){e.preventDefault(),j.getObjects().filter(e=>e.id==r).forEach(e=>e.clone(function(t){t.set("id",new Date().getTime()),t.set("objectType",e.objectType),j.add(t),j.setActiveObject(t)})),j.requestRenderAll(),d.find("#palleon-layers").sortable("refresh"),j.fire("palleon:history",{type:s.data("type"),text:palleonParams.added})}),function t(a){d.find("#palleon-layers #"+a).find("a.layer-visibility").on("click",function(t){t.preventDefault();var n=j.getObjects();e(this).hasClass("layer-visible")?(e(this).removeClass("layer-visible"),e(this).addClass("layer-hidden"),e(this).html("visibility_off"),n.filter(e=>e.id==a).forEach(e=>e.set("visible",!1))):e(this).hasClass("layer-hidden")&&(e(this).removeClass("layer-hidden"),e(this).addClass("layer-visible"),e(this).html("visibility"),n.filter(e=>e.id==a).forEach(e=>e.set("visible",!0))),j.requestRenderAll()})}(a.id),function t(a){d.find("#palleon-layers #"+a).find("a.lock-layer").on("click",function(t){t.preventDefault();var a=j.getActiveObject();e(this).hasClass("layer-unlocked")?(e(this).removeClass("layer-unlocked"),e(this).addClass("layer-locked"),e(this).html("lock"),a.set({lockMovementX:!0,lockMovementY:!0,lockRotation:!0,selectable:!1})):e(this).hasClass("layer-locked")&&(e(this).removeClass("layer-locked"),e(this).addClass("layer-unlocked"),e(this).html("lock_open"),a.set({lockMovementX:!1,lockMovementY:!1,lockRotation:!1,selectable:!0})),j.requestRenderAll()})}(a.id),function t(a){d.find("#palleon-layers #"+a).on("click",function(t){var a=j.getObjects(),n=e(this).attr("id");a.filter(e=>e.id==n).forEach(e=>j.setActiveObject(e)),d.find("#palleon-layers > li").removeClass("active"),e(this).addClass("active"),j.requestRenderAll()})}(a.id),function t(a){d.find("#palleon-layers #"+a).find(".layer-name").on("change",function(t){var a=j.getObjects(),n=e(this).parent("li").attr("id");a.filter(e=>e.id==n).forEach(t=>t.set({layerName:e(this).val()}))})}(a.id),d.find("#palleon-layers").sortable("refresh"),eb(),"printarea"!=a.objectType&&"clipPath"!=a.objectType)(n=a).controls.deleteControl=new fabric.Control({x:0,y:.5,offsetY:22,offsetX:14,cursorStyle:"pointer",mouseUpHandler:V,render:Z,cornerSize:24}),(i=a).controls.cloneControl=new fabric.Control({x:0,y:.5,offsetY:22,offsetX:-14,cursorStyle:"pointer",mouseUpHandler:K,render:Q,cornerSize:24});else removeControl(a)}}),j.on("object:modified",function(e){var t,a=e.target;"textbox"==a.objectType&&a.id&&(d.find("#palleon-layers #"+a.id+" .layer-name").html(a.text),d.find("#text-rotate").val(parseInt(j.getActiveObject().angle)),d.find("#text-rotate").parent().parent().find(".slider-label span").html(parseInt(j.getActiveObject().angle))),"image"==a.objectType&&a.id&&(d.find("#img-rotate").val(parseInt(j.getActiveObject().angle)),d.find("#img-rotate").parent().parent().find(".slider-label span").html(parseInt(j.getActiveObject().angle))),"element"==a.objectType&&a.id&&(d.find("#element-rotate").val(parseInt(j.getActiveObject().angle)),d.find("#element-rotate").parent().parent().find(".slider-label span").html(parseInt(j.getActiveObject().angle))),"customSVG"==a.objectType&&a.id&&(d.find("#customsvg-rotate").val(parseInt(j.getActiveObject().angle)),d.find("#customsvg-rotate").parent().parent().find(".slider-label span").html(parseInt(j.getActiveObject().angle))),Y.includes(a.objectType)&&a.id&&(d.find("#shape-rotate").val(parseInt(j.getActiveObject().angle)),d.find("#shape-rotate").parent().parent().find(".slider-label span").html(parseInt(j.getActiveObject().angle))),"clipPath"==a.objectType&&(a.lockScalingX=!1,a.lockScalingY=!1,a.lockMovementX=!1,a.lockMovementY=!1),m&&(t=a,t.isContainedWithinObject(i)?(r=t.get("top"),s=t.get("left"),l=t.get("scaleX"),o=t.get("scaleY")):(t.top=r,t.left=s,t.scaleX=l,t.scaleY=o,t.setCoords(),t.saveState()),t.set({borderColor:"#4affff"}),j.requestRenderAll(),eC(j.getItemById("cropped")))}),j.on("erasing:end",function(){eu('<span class="material-icons">brush</span>'+palleonParams.erased)}),j.on("path:created",function(e){!0===j.isDrawingMode&&eu('<span class="material-icons">brush</span>'+palleonParams.freeDrawing+" "+palleonParams.added)}),d.find(".palleon-horizontal-center").on("click",function(){var e=j.getActiveObject();e.set("originX","center"),e.set("left",eT()[0]/2),j.requestRenderAll()}),d.find(".palleon-vertical-center").on("click",function(){var e=j.getActiveObject();e.set("originY","center"),e.set("top",eT()[1]/2),j.requestRenderAll()}),j.on("selection:created",function(e){ey(e.selected)}),j.on("selection:updated",function(e){ey(e.selected)}),j.on("selection:cleared",function(){m?(eC(i),d.find("#crop-image-object").removeClass("d-none"),d.find("#crop-image-object-selection").addClass("d-none"),d.find("#palleon-icon-menu, #palleon-top-bar, #palleon-right-col, #palleon-img-upload-wrap, #palleon-img-media-library, #palleon-image-settings > *, .palleon-content-bar").css("pointer-events","auto")):(d.find("#palleon-text-settings").hide(),d.find("#palleon-image-settings").hide(),d.find("#palleon-shape-settings").hide(),d.find("#palleon-custom-element-options").hide(),d.find("#palleon-custom-element-options-info").show(),d.find("#palleon-shape-settings-info").show(),d.find("#palleon-custom-svg-options").hide(),d.find("#palleon-layers > li").removeClass("active"))}),d.find("#palleon-layers").sortable({placeholder:"layer-placeholder",axis:"y",update:function(t,a){var n=j.getObjects();e("#palleon-layers li").each(function(t,a){e(this).attr("data-sort",t+1),n.filter(e=>e.id==a.id).forEach(e=>e.moveTo(-(t+1)))}),j.requestRenderAll()},create:function(e,t){eb()}}).disableSelection(),d.find("#palleon-layers").on("click",".layer-settings",function(){var t=e(this).next();e(this).hasClass("active")?(e(this).removeClass("active"),t.hide()):(d.find("#palleon-layers .layer-icons").hide(),d.find("#palleon-layers .layer-settings").removeClass("active"),e(this).addClass("active"),t.show())}),d.find("#palleon-layer-delete").on("click",function(){if(window.confirm(palleonParams.question2)){var e=d.find("#palleon-layer-select").val(),t=j.getObjects();"all"==e?(t.forEach(e=>j.remove(e)),d.find("#palleon-layers > li").remove()):(t.filter(t=>t.objectType==e).forEach(e=>j.remove(e)),d.find("#palleon-layers > li.layer-"+e).remove()),j.requestRenderAll(),d.find("#palleon-layers").sortable("refresh"),eb()}}),d.find("#palleon-img-drag").on("click",function(){e(this).hasClass("active")?(e(this).removeClass("active"),d.find("#palleon-canvas-overlay").hide(),d.find("#palleon-canvas-wrap").draggable("disable")):(e(this).addClass("active"),d.find("#palleon-canvas-overlay").show(),d.find("#palleon-canvas-wrap").draggable("enable"))}),d.find(".palleon-counter input.palleon-form-field").on("input",function(){var t=parseInt(e(this).val());ew(t)});var ek=function(e){d.find("#palleon-resize-width").val(Math.round(e.width)),d.find("#palleon-resize-height").val(Math.round(e.height)),d.find("#palleon-img-width").html(Math.round(e.width)),d.find("#palleon-img-height").html(Math.round(e.height)),d.find("#palleon-crop-width").val(Math.round(e.width/2)),d.find("#palleon-crop-height").val(Math.round(e.height/2)),d.find("#palleon-resize-width").data("size",Math.round(e.width)),d.find("#palleon-resize-height").data("size",Math.round(e.height)),"image"==u&&(d.find("#palleon-crop-width").data("max",Math.round(e.width)),d.find("#palleon-crop-height").data("max",Math.round(e.height))),d.find("#palleon-resize-width").trigger("sizeChanged"),d.find("#palleon-resize-height").trigger("sizeChanged")};function e_(){var e=j.getObjects();e.filter(e=>"BG"!=e.objectType).forEach(e=>e.set("visible",!1)),j.backgroundColor="transparent";var t=H(j.toDataURL({format:"png",enableRetinaScaling:!1}));b=URL.createObjectURL(t),d.find("#palleon-canvas-img").attr("src",b),j.backgroundColor=d.find("#custom-image-background").val(),e.filter(e=>"BG"!=e.objectType).forEach(e=>e.set("visible",!0))}function ex(){var e=j.getObjects();S.moveTo(9999),j.setActiveObject(S),d.find("#palleon-crop-btns").removeClass("disabled"),d.find(".palleon-icon-panel-content ul.palleon-accordion > li, #palleon-icon-menu, #palleon-top-bar, #palleon-right-col, .palleon-content-bar").css("pointer-events","none"),d.find(".palleon-icon-panel-content ul.palleon-accordion > li.accordion-crop").css("pointer-events","auto"),e.filter(e=>"clipPath"!=e.objectType&&"BG"!=e.objectType).forEach(e=>e.set("selectable",!1))}function eC(e){var t=j.getItemById("crop");i.setCoords(),t.setCoords();var a=t.get("left")-t.get("width")*t.get("scaleX")/2,n=t.get("top")-t.get("height")*t.get("scaleY")/2,l=t.get("height")/i.get("scaleY")*t.get("scaleY"),o=t.get("width")/i.get("scaleX")*t.get("scaleX");i.get("height"),i.get("scaleY"),i.get("width"),i.get("scaleX");var r=a-(i.get("left")-i.get("width")*i.get("scaleX")/2),s=n-(i.get("top")-i.get("height")*i.get("scaleY")/2);r<0&&s>0?(e.set({cropY:s/i.get("scaleY"),height:l}).setCoords(),j.requestRenderAll(),e.set({top:n+e.get("height")*e.get("scaleY")/2}),j.requestRenderAll()):s<0&&r>0?(e.set({cropX:r/i.get("scaleX"),width:o}).setCoords(),j.requestRenderAll(),e.set({left:a+e.get("width")*e.get("scaleX")/2}),j.requestRenderAll()):s>0&&r>0&&(e.set({cropX:r/i.get("scaleX"),cropY:s/i.get("scaleY"),height:l,width:o}).setCoords(),j.requestRenderAll(),e.set({left:a+e.get("width")*e.get("scaleX")/2,top:n+e.get("height")*e.get("scaleY")/2}),j.requestRenderAll()),"cropped"!=e.get("id")&&(j.remove(t),j.remove(j.getItemById("overlay")),j.remove(j.getItemById("cropped")),m=!1,fabric.Object.prototype.controls.ml=new fabric.Control({x:-.5,y:0,offsetX:-1,cursorStyleHandler:fabric.controlsUtils.scaleSkewCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingXOrSkewingY,getActionName:fabric.controlsUtils.scaleOrSkewActionName}),fabric.Object.prototype.controls.mr=new fabric.Control({x:.5,y:0,offsetX:1,cursorStyleHandler:fabric.controlsUtils.scaleSkewCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingXOrSkewingY,getActionName:fabric.controlsUtils.scaleOrSkewActionName}),fabric.Object.prototype.controls.mb=new fabric.Control({x:0,y:.5,offsetY:1,cursorStyleHandler:fabric.controlsUtils.scaleSkewCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingYOrSkewingX,getActionName:fabric.controlsUtils.scaleOrSkewActionName}),fabric.Object.prototype.controls.mt=new fabric.Control({x:0,y:-.5,offsetY:-1,cursorStyleHandler:fabric.controlsUtils.scaleSkewCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingYOrSkewingX,getActionName:fabric.controlsUtils.scaleOrSkewActionName}),fabric.Object.prototype.controls.tl=new fabric.Control({x:-.5,y:-.5,cursorStyleHandler:fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingEqually}),fabric.Object.prototype.controls.tr=new fabric.Control({x:.5,y:-.5,cursorStyleHandler:fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingEqually}),fabric.Object.prototype.controls.bl=new fabric.Control({x:-.5,y:.5,cursorStyleHandler:fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingEqually}),fabric.Object.prototype.controls.br=new fabric.Control({x:.5,y:.5,cursorStyleHandler:fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingEqually}),j.uniformScaling=!0,j.requestRenderAll(),j.fire("palleon:history",{type:"image",text:palleonParams.edited})),j.requestRenderAll()}d.find("#palleon-crop-style").on("change",function(){if(""!=e(this).val()&&e(this).select2("enable",!1),"freeform"==e(this).val())(S=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:y/2,height:$/2,excludeFromExport:!0,objectType:"clipPath",top:eT()[1]/4,left:eT()[0]/4})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1})},j.add(S),ex();else if("custom"==e(this).val()){d.find(".crop-custom").css("display","flex");var t=parseInt(d.find("#palleon-crop-width").val()),a=parseInt(d.find("#palleon-crop-height").val());(S=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:t,height:a,excludeFromExport:!0,objectType:"clipPath",top:eT()[1]/4,left:eT()[0]/4})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1}),tl:new fabric.Control({visible:!1}),bl:new fabric.Control({visible:!1}),tr:new fabric.Control({visible:!1}),br:new fabric.Control({visible:!1})},j.add(S),ex()}else if("square"==e(this).val()){var n=$/2,i=eT()[1]/4;y>$&&(n=y/2,i=eT()[1]/8),(S=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:n,height:n,excludeFromExport:!0,objectType:"clipPath",top:i,left:eT()[0]/4})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},j.add(S),ex()}else"original"==e(this).val()?((S=new fabric.Rect({fill:"rgba(156, 39, 176, 0.3)",width:y/2,height:$/2,excludeFromExport:!0,objectType:"clipPath",top:eT()[1]/4,left:eT()[0]/4})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},j.add(S),ex()):(j.getObjects().filter(e=>"clipPath"!=e.objectType&&"BG"!=e.objectType).forEach(e=>e.set("selectable",!0)),d.find(".crop-custom").css("display","none"),d.find("#palleon-crop-btns").addClass("disabled"),d.find(".palleon-icon-panel-content ul.palleon-accordion > li, #palleon-icon-menu, #palleon-top-bar, #palleon-right-col, .palleon-content-bar").css("pointer-events","auto"))}),d.find("#palleon-crop-cancel").on("click",function(){d.find("#palleon-crop-btns").addClass("disabled"),d.find("#palleon-crop-style").select2("enable"),d.find("#palleon-crop-style").val(""),d.find("#palleon-crop-style").trigger("change"),j.remove(""),j.remove(S)}),d.find("#palleon-crop-apply").on("click",function(){if(window.confirm(palleonParams.question3)){d.find("#palleon-crop-btns").addClass("disabled"),d.find("#palleon-crop-style").select2("enable"),d.find("#palleon-crop-style").val(""),d.find("#palleon-crop-style").trigger("change"),j.setZoom(1),d.find("#palleon-img-zoom").val(100);var e=S.getBoundingRect();j.setWidth(e.width-1),j.setHeight(e.height-1),j.backgroundImage.set({top:-e.top,left:-e.left}),j.remove(""),j.remove(S),e_(),d.find("#palleon-canvas-img-wrap").imagesLoaded(function(){y=j.width,$=j.height,w=0,x="left",C="top",k=1,_=1,e$(),ek(j),ew(),j.requestRenderAll(),setTimeout(function(){j.fire("palleon:history",{type:"BG",text:palleonParams.cropped})},500)})}}),d.find("#palleon-crop-width").bind("input paste",function(){if(d.find("#palleon-crop-lock").hasClass("active")){var t=e(this).data("max"),a=d.find("#palleon-crop-height").data("max");d.find("#palleon-crop-height").val(Math.round(this.value/(t/a)))}S.set("width",parseInt(e(this).val())),S.set("height",parseInt(d.find("#palleon-crop-height").val())),j.requestRenderAll()}),d.find("#palleon-crop-height").bind("input paste",function(){if(d.find("#palleon-crop-lock").hasClass("active")){var t=e(this).data("max"),a=d.find("#palleon-crop-width").data("max");d.find("#palleon-crop-width").val(Math.round(this.value/(t/a)))}S.set("height",parseInt(e(this).val())),S.set("width",parseInt(d.find("#palleon-crop-width").val())),j.requestRenderAll()}),d.on("click","#crop-image-object",function(){j.getActiveObject()&&(d.find("#palleon-icon-menu, #palleon-top-bar, #palleon-right-col, #palleon-img-upload-wrap, #palleon-img-media-library, #palleon-image-settings > *, .palleon-content-bar").css("pointer-events","none"),d.find("#crop-image-object-selection").css("pointer-events","auto"),e(this).addClass("d-none"),d.find("#crop-image-object-selection").removeClass("d-none"),function e(t){if(!m){m=!0,i=t,j.uniformScaling=!1,i.setCoords();var a=i.get("left")-i.get("width")*i.get("scaleX")/2,n=i.get("top")-i.get("height")*i.get("scaleY")/2,d=i.get("cropX"),c=i.get("cropY");j.add(new fabric.Rect({objectType:"clipPath",left:0,top:0,originX:"left",originY:"top",width:y,height:$,fill:"rgba(0,0,0,0.5)",selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,id:"overlay"}));var p=new fabric.Rect({objectType:"clipPath",left:t.get("left"),top:t.get("top"),width:t.get("width")*t.get("scaleX")-5,height:t.get("height")*t.get("scaleY")-5,originX:"center",originY:"center",id:"crop",fill:"rgba(0,0,0,0)",shadow:{color:"black",offsetX:0,offsetY:0,blur:0,opacity:0}});i.clone(function(e){e.set({objectType:"clipPath",id:"cropped",selectable:!1,originX:"center",originY:"center"}),j.add(e),j.bringToFront(e),j.bringToFront(p),j.requestRenderAll(),i=t}),i.set({cropX:0,cropY:0,width:i.get("ogWidth"),height:i.get("ogHeight")}).setCoords(),j.requestRenderAll(),i.set({left:a+i.get("width")*i.get("scaleX")/2-d*i.get("scaleX"),top:n+i.get("height")*i.get("scaleY")/2-c*i.get("scaleY")}),p.setControlsVisibility({mt:!1,mb:!1,mr:!1,ml:!1,mtr:!1,deleteControl:!1,cloneControl:!1}),p.controls.tl=new fabric.Control({x:-.5,y:-.5,offsetX:3,offsetY:3,cursorStyleHandler:fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingEqually,render:function(e,t,a,n,i){e.save(),e.translate(t,a),e.rotate(fabric.util.degreesToRadians(i.angle)),e.drawImage(ej,-13.5,-13.5,27,27),e.restore()}}),p.controls.tr=new fabric.Control({x:.5,y:-.5,offsetX:-3,offsetY:3,cursorStyleHandler:fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingEqually,render:function(e,t,a,n,i){e.save(),e.translate(t,a),e.rotate(fabric.util.degreesToRadians(i.angle)),e.drawImage(e0,-13.5,-13.5,27,27),e.restore()}}),p.controls.bl=new fabric.Control({x:-.5,y:.5,offsetX:3,offsetY:-3,cursorStyleHandler:fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingEqually,render:function(e,t,a,n,i){e.save(),e.translate(t,a),e.rotate(fabric.util.degreesToRadians(i.angle)),e.drawImage(eA,-13.5,-13.5,27,27),e.restore()}}),p.controls.br=new fabric.Control({x:.5,y:.5,offsetX:-3,offsetY:-3,cursorStyleHandler:fabric.controlsUtils.scaleCursorStyleHandler,actionHandler:fabric.controlsUtils.scalingEqually,render:function(e,t,a,n,i){e.save(),e.translate(t,a),e.rotate(fabric.util.degreesToRadians(i.angle)),e.drawImage(eS,-13.5,-13.5,27,27),e.restore()}}),j.add(p),j.setActiveObject(p),j.requestRenderAll(),s=p.get("left"),r=p.get("top"),l=p.get("scaleX")-.03,o=p.get("scaleY")-.03}}(j.getActiveObject()))}),d.on("click","#crop-image-object-selection",function(){m&&(d.find("#palleon-icon-menu, #palleon-top-bar, #palleon-right-col, #palleon-img-upload-wrap, #palleon-img-media-library, #palleon-image-settings > *, .palleon-content-bar").css("pointer-events","auto"),e(this).addClass("d-none"),d.find("#crop-image-object").removeClass("d-none"),j.discardActiveObject(),j.fire("selection:cleared"),j.requestRenderAll())});var ej=new Image;ej.src=p.baseURL+"assets/tlcrop.svg";var e0=new Image;e0.src=p.baseURL+"assets/trcrop.svg";var eA=new Image;eA.src=p.baseURL+"assets/blcrop.svg";var eS=new Image;function eI(e){0==w||180==w||-180==w?(j.setDimensions({width:$,height:y}),k=j.height/v.width,_=j.width/v.height):(j.setDimensions({width:y,height:$}),k=j.width/v.width,_=j.height/v.height),"right"==e?0==w?(w=90,x="left",C="bottom"):90==w?(w=180,x="right",C="bottom"):180==w?(w=270,x="right",C="top"):270==w?(w=0,x="left",C="top"):-90==w?(w=0,x="left",C="top"):-180==w?(w=-90,x="right",C="top"):-270==w&&(w=-180,x="right",C="bottom"):"left"==e&&(0==w?(w=-90,x="right",C="top"):-90==w?(w=-180,x="right",C="bottom"):-180==w?(w=-270,x="left",C="bottom"):-270==w?(w=0,x="left",C="top"):90==w?(w=0,x="left",C="top"):180==w?(w=90,x="left",C="bottom"):270==w&&(w=180,x="right",C="bottom")),j.backgroundImage.set({scaleX:k,scaleY:_,angle:w,originX:x,originY:C});var t=new fabric.Rect({radius:50,fill:"transparent",stroke:"transparent",strokeWidth:0,objectType:"clipPath",width:j.height,height:j.width,gradientFill:"none",top:0,left:0,originX:"left",originY:"top"});j.add(t),j.discardActiveObject();var a=new fabric.ActiveSelection(j.getObjects(),{canvas:j});j.setActiveObject(a);var n=j.getActiveObject();"right"==e?n.set({angle:90,originX:"left",originY:"bottom"}):"left"==e&&n.set({angle:-90,originX:"right",originY:"top"}),j.remove(t),j.discardActiveObject(),ek(j),ew(),j.requestRenderAll(),j.fire("palleon:history",{type:"BG",text:palleonParams.rotated})}function eO(e){var t=j.getActiveObject();t.set("gradientFill",d.find("#palleon-"+e+"-gradient").val());var a="";if(""==d.find("#"+e+"-gradient-color-3").val()&&""==d.find("#"+e+"-gradient-color-4").val()?a=[{offset:0,color:d.find("#"+e+"-gradient-color-1").val()},{offset:1,color:d.find("#"+e+"-gradient-color-2").val()}]:""!=d.find("#"+e+"-gradient-color-3").val()&&""==d.find("#"+e+"-gradient-color-4").val()?a=[{offset:0,color:d.find("#"+e+"-gradient-color-1").val()},{offset:.5,color:d.find("#"+e+"-gradient-color-2").val()},{offset:1,color:d.find("#"+e+"-gradient-color-3").val()}]:""!=d.find("#"+e+"-gradient-color-1").val()&&""!=d.find("#"+e+"-gradient-color-2").val()&&""!=d.find("#"+e+"-gradient-color-3").val()&&""!=d.find("#"+e+"-gradient-color-4").val()&&(a=[{offset:0,color:d.find("#"+e+"-gradient-color-1").val()},{offset:.25,color:d.find("#"+e+"-gradient-color-2").val()},{offset:.75,color:d.find("#"+e+"-gradient-color-3").val()},{offset:1,color:d.find("#"+e+"-gradient-color-4").val()}]),"vertical"==d.find("#palleon-"+e+"-gradient").val()){if(d.find("#"+e+"-gradient-settings").show(),d.find("#"+e+"-fill-color").hide(),t.set("fill",new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:0,y2:1},colorStops:a})),t._objects)for(var n=0;n<t._objects.length;n++)""!=t._objects[n].fill&&t._objects[n].set({fill:new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:0,y2:1},colorStops:a})})}else if("horizontal"==d.find("#palleon-"+e+"-gradient").val()){if(d.find("#"+e+"-gradient-settings").show(),d.find("#"+e+"-fill-color").hide(),t.set("fill",new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:1,y2:0},colorStops:a})),t._objects)for(var n=0;n<t._objects.length;n++)""!=t._objects[n].fill&&t._objects[n].set({fill:new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:1,y2:0},colorStops:a})})}else if("diagonal"==d.find("#palleon-"+e+"-gradient").val()){if(d.find("#"+e+"-gradient-settings").show(),d.find("#"+e+"-fill-color").hide(),t.set("fill",new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:1,y2:1},colorStops:a})),t._objects)for(var n=0;n<t._objects.length;n++)""!=t._objects[n].fill&&t._objects[n].set({fill:new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:{x1:0,y1:0,x2:1,y2:1},colorStops:a})})}else if(d.find("#"+e+"-gradient-settings").hide(),d.find("#"+e+"-fill-color").show(),t.set("fill",d.find("#palleon-"+e+"-color").val()),t._objects)for(var n=0;n<t._objects.length;n++)""!=t._objects[n].fill&&t._objects[n].set("fill",d.find("#palleon-"+e+"-color").val());j.requestRenderAll()}function eT(){var e=j.backgroundImage.getScaledHeight(),t=j.backgroundImage.getScaledWidth();return(0==w||180==w||-180==w)&&(e=j.backgroundImage.getScaledWidth(),t=j.backgroundImage.getScaledHeight()),[e,t]}eS.src=p.baseURL+"assets/brcrop.svg",d.find("#palleon-resize-apply").on("click",function(){var e,t,a,n;window.confirm(palleonParams.question4)&&(e=parseInt(d.find("#palleon-resize-width").val()),t=parseInt(d.find("#palleon-resize-height").val()),y=e,$=t,j.setZoom(1),d.find("#palleon-img-zoom").val(100),j.setWidth(e),j.setHeight(t),0==w||180==w||-180==w?(k=j.width/d.find("#palleon-canvas-img")[0].width,_=j.height/d.find("#palleon-canvas-img")[0].height):(k=j.height/d.find("#palleon-canvas-img")[0].width,_=j.width/d.find("#palleon-canvas-img")[0].height),j.backgroundImage.set({scaleX:k,scaleY:_}),j.discardActiveObject(),a=new fabric.ActiveSelection(j.getObjects(),{canvas:j}),j.setActiveObject(a),j.requestRenderAll(),(n=j.getActiveObject()).set({top:n.top*_,left:n.left*k,scaleX:k,scaleY:_}),e_(),d.find("#palleon-canvas-img-wrap").imagesLoaded(function(){j.discardActiveObject(),y=j.width,$=j.height,w=0,x="left",C="top",k=1,_=1,e$(),ek(j),ew(),j.requestRenderAll(),setTimeout(function(){j.fire("palleon:history",{type:"BG",text:palleonParams.resized})},500)}))}),d.find("#palleon-resize-width").bind("input paste",function(){if(d.find("#palleon-resize-lock").hasClass("active")){var t=e(this).data("size"),a=d.find("#palleon-resize-height").data("size");d.find("#palleon-resize-height").val(Math.round(this.value/(t/a)))}}),d.find("#palleon-resize-height").bind("input paste",function(){if(d.find("#palleon-resize-lock").hasClass("active")){var t=e(this).data("size"),a=d.find("#palleon-resize-width").data("size");d.find("#palleon-resize-width").val(Math.round(this.value/(t/a)))}}),d.find("#palleon-rotate-right").on("click",function(){eI("right")}),d.find("#palleon-rotate-left").on("click",function(){eI("left")}),d.find("#palleon-flip-horizontal").on("click",function(){j.backgroundImage.toggle("flipX");var e=new fabric.Rect({radius:50,fill:"transparent",stroke:"transparent",strokeWidth:0,objectType:"clipPath",width:eT()[0],height:eT()[1],gradientFill:"none",top:0,left:0,originX:"left",originY:"top"});j.add(e),j.discardActiveObject();var t=new fabric.ActiveSelection(j.getObjects(),{canvas:j});j.setActiveObject(t);var a=j.getActiveObject();0==w||180==w||-180==w?a.toggle("flipX"):a.toggle("flipY"),j.remove(e),j.discardActiveObject(),j.requestRenderAll(),j.fire("palleon:history",{type:"BG",text:palleonParams.flipped})}),d.find("#palleon-flip-vertical").on("click",function(){j.backgroundImage.toggle("flipY");var e=new fabric.Rect({radius:50,fill:"transparent",stroke:"transparent",strokeWidth:0,objectType:"clipPath",width:eT()[0],height:eT()[1],gradientFill:"none",top:0,left:0,originX:"left",originY:"top"});j.add(e),j.discardActiveObject();var t=new fabric.ActiveSelection(j.getObjects(),{canvas:j});j.setActiveObject(t);var a=j.getActiveObject();0==w||180==w||-180==w?a.toggle("flipY"):a.toggle("flipX"),j.remove(e),j.discardActiveObject(),j.requestRenderAll(),j.fire("palleon:history",{type:"BG",text:palleonParams.flipped})}),d.find("#palleon-brightness").on("change",function(){e(this).is(":checked")?j.backgroundImage.filters.push(new fabric.Image.filters.Brightness):(d.find("#brightness").val(0),d.find("#brightness").parent().parent().find(".slider-label span").html(0),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Brightness"!=e.type),j.backgroundImage.applyFilters()),j.requestRenderAll()}),d.find("#brightness").on("input",function(){j.backgroundImage.filters.filter(e=>"Brightness"==e.type).forEach(e=>e.brightness=parseFloat(this.value)),j.backgroundImage.applyFilters(),j.requestRenderAll()}),d.find("#brightness").on("change",function(e){e.originalEvent&&eu('<span class="material-icons">image</span>'+palleonParams.bg+" "+palleonParams.edited)}),d.find("#palleon-contrast").on("change",function(){e(this).is(":checked")?j.backgroundImage.filters.push(new fabric.Image.filters.Contrast):(d.find("#contrast").val(0),d.find("#contrast").parent().parent().find(".slider-label span").html(0),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Contrast"!=e.type),j.backgroundImage.applyFilters()),j.requestRenderAll()}),d.find("#contrast").on("input",function(){j.backgroundImage.filters.filter(e=>"Contrast"==e.type).forEach(e=>e.contrast=parseFloat(this.value)),j.backgroundImage.applyFilters(),j.requestRenderAll()}),d.find("#contrast").on("change",function(e){e.originalEvent&&eu('<span class="material-icons">image</span>'+palleonParams.bg+" "+palleonParams.edited)}),d.find("#palleon-saturation").on("change",function(){e(this).is(":checked")?j.backgroundImage.filters.push(new fabric.Image.filters.Saturation):(d.find("#saturation").val(0),d.find("#saturation").parent().parent().find(".slider-label span").html(0),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Saturation"!=e.type),j.backgroundImage.applyFilters()),j.requestRenderAll()}),d.find("#saturation").on("input",function(){j.backgroundImage.filters.filter(e=>"Saturation"==e.type).forEach(e=>e.saturation=parseFloat(this.value)),j.backgroundImage.applyFilters(),j.requestRenderAll()}),d.find("#saturation").on("change",function(e){e.originalEvent&&eu('<span class="material-icons">image</span>'+palleonParams.bg+" "+palleonParams.edited)}),d.find("#palleon-hue").on("change",function(){e(this).is(":checked")?j.backgroundImage.filters.push(new fabric.Image.filters.HueRotation):(d.find("#hue").val(0),d.find("#hue").parent().parent().find(".slider-label span").html(0),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"HueRotation"!=e.type),j.backgroundImage.applyFilters()),j.requestRenderAll()}),d.find("#hue").on("input",function(){j.backgroundImage.filters.filter(e=>"HueRotation"==e.type).forEach(e=>e.rotation=parseFloat(this.value)),j.backgroundImage.applyFilters(),j.requestRenderAll()}),d.find("#hue").on("change",function(e){e.originalEvent&&eu('<span class="material-icons">image</span>'+palleonParams.bg+" "+palleonParams.edited)}),d.find("#palleon-img-mask").on("change",function(t){var a=e(this).find(":selected").val();"custom"==a?d.find("#palleon-img-radius-settings").removeClass("d-none"):(d.find("#palleon-img-radius-settings").addClass("d-none"),d.find("#img-border-radius").val("0"),d.find("#img-border-radius").parent().parent().find("label span").html("0"));var n=j.getActiveObject(),i=null,l=-(n.width/2),o=-(n.width/2),r=n.width/2;if(n.width>n.height&&(l=-(n.height/2),o=-(n.height/2),r=n.height/2),n.clipPath=null,j.requestRenderAll(),"circle"==a)i=new fabric.Circle({maskType:a,radius:r,left:l,top:o});else if("triangle"==a)i=new fabric.Triangle({maskType:a,width:2*r,height:2*r,left:l,top:o});else if("triangleDown"==a)i=new fabric.Triangle({maskType:a,width:2*r,height:2*r,flipY:!0,left:l,top:o});else if("triangleRight"==a)i=new fabric.Triangle({maskType:a,width:2*r,height:2*r,left:l,top:o,originX:"left",originY:"bottom",angle:90});else if("triangleLeft"==a)i=new fabric.Triangle({maskType:a,width:2*r,height:2*r,left:l,top:o,originX:"right",originY:"top",angle:-90});else if("pentagon"==a){var s=[{x:26,y:86},{x:11.2,y:40.4},{x:50,y:12.2},{x:88.8,y:40.4},{x:74,y:86}];(i=new fabric.Polygon(s,{maskType:a,width:2*r,height:2*r,left:l,top:o})).scaleToWidth(n.width),n.width>n.height&&i.scaleToHeight(n.height)}else if("pentagonDown"==a){var s=[{x:26,y:86},{x:11.2,y:40.4},{x:50,y:12.2},{x:88.8,y:40.4},{x:74,y:86}];(i=new fabric.Polygon(s,{maskType:a,width:2*r,height:2*r,flipY:!0,left:l,top:o})).scaleToWidth(n.width),n.width>n.height&&i.scaleToHeight(n.height)}else if("pentagonLeft"==a){var s=[{x:26,y:86},{x:11.2,y:40.4},{x:50,y:12.2},{x:88.8,y:40.4},{x:74,y:86}];(i=new fabric.Polygon(s,{maskType:a,width:2*r,height:2*r,originX:"right",originY:"top",angle:-90,left:l,top:o})).scaleToWidth(n.width),n.width>n.height&&i.scaleToHeight(n.height)}else if("pentagonRight"==a){var s=[{x:26,y:86},{x:11.2,y:40.4},{x:50,y:12.2},{x:88.8,y:40.4},{x:74,y:86}];(i=new fabric.Polygon(s,{maskType:a,width:2*r,height:2*r,originX:"left",originY:"bottom",angle:90,left:l,top:o})).scaleToWidth(n.width),n.width>n.height&&i.scaleToHeight(n.height)}else if("octagon"==a){var s=[{x:34.2,y:87.4},{x:12.3,y:65.5},{x:12.3,y:34.5},{x:34.2,y:12.6},{x:65.2,y:12.6},{x:87.1,y:34.5},{x:87.1,y:65.5},{x:65.2,y:87.4}];(i=new fabric.Polygon(s,{maskType:a,width:2*r,height:2*r,left:l,top:o})).scaleToWidth(n.width),n.width>n.height&&i.scaleToHeight(n.height)}else if("star"==a){var s=[{x:350,y:75},{x:380,y:160},{x:470,y:160},{x:400,y:215},{x:423,y:301},{x:350,y:250},{x:277,y:301},{x:303,y:215},{x:231,y:161},{x:321,y:161}];(i=new fabric.Polygon(s,{maskType:a,width:2*r,height:2*r,left:l,top:o})).scaleToWidth(n.width),n.width>n.height&&i.scaleToHeight(n.height)}else if("starReverse"==a){var s=[{x:350,y:75},{x:380,y:160},{x:470,y:160},{x:400,y:215},{x:423,y:301},{x:350,y:250},{x:277,y:301},{x:303,y:215},{x:231,y:161},{x:321,y:161}];(i=new fabric.Polygon(s,{maskType:a,width:2*r,height:2*r,flipY:!0,left:l,top:o})).scaleToWidth(n.width),n.width>n.height&&i.scaleToHeight(n.height)}setTimeout(function(){n.clipPath=i,j.requestRenderAll(),eu(em("image")+" "+palleonParams.mask+" "+palleonParams.added)},100)}),d.find("#image-filter").on("change",function(t){var a=e(this).find(":selected").val(),n=j.getActiveObject();"grayscale"==a?n.filters[0]=new fabric.Image.filters.Grayscale:"sepia"==a?n.filters[0]=new fabric.Image.filters.Sepia:"blackwhite"==a?n.filters[0]=new fabric.Image.filters.BlackWhite:"brownie"==a?n.filters[0]=new fabric.Image.filters.Brownie:"vintage"==a?n.filters[0]=new fabric.Image.filters.Vintage:"kodachrome"==a?n.filters[0]=new fabric.Image.filters.Kodachrome:"technicolor"==a?n.filters[0]=new fabric.Image.filters.Technicolor:"polaroid"==a?n.filters[0]=new fabric.Image.filters.Polaroid:"shift"==a?n.filters[0]=new fabric.Image.filters.Shift:"invert"==a?n.filters[0]=new fabric.Image.filters.Invert:n.filters=[],n.applyFilters(),j.requestRenderAll()}),d.find("#palleon-filters input[type=checkbox]").on("change",function(t){e(this).is(":checked")?"grayscale"==e(this).attr("id")?j.backgroundImage.filters.push(new fabric.Image.filters.Grayscale):"sepia"==e(this).attr("id")?j.backgroundImage.filters.push(new fabric.Image.filters.Sepia):"blackwhite"==e(this).attr("id")?j.backgroundImage.filters.push(new fabric.Image.filters.BlackWhite):"brownie"==e(this).attr("id")?j.backgroundImage.filters.push(new fabric.Image.filters.Brownie):"vintage"==e(this).attr("id")?j.backgroundImage.filters.push(new fabric.Image.filters.Vintage):"kodachrome"==e(this).attr("id")?j.backgroundImage.filters.push(new fabric.Image.filters.Kodachrome):"technicolor"==e(this).attr("id")?j.backgroundImage.filters.push(new fabric.Image.filters.Technicolor):"polaroid"==e(this).attr("id")?j.backgroundImage.filters.push(new fabric.Image.filters.Polaroid):"shift"==e(this).attr("id")?j.backgroundImage.filters.push(new fabric.Image.filters.Shift):"invert"==e(this).attr("id")?j.backgroundImage.filters.push(new fabric.Image.filters.Invert):"sharpen"==e(this).attr("id")?(d.find("#emboss").prop("checked",!1),d.find("#sobelX").prop("checked",!1),d.find("#sobelY").prop("checked",!1),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Convolute"!=e.type),j.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[0,-1,0,-1,5,-1,0,-1,0]}))):"emboss"==e(this).attr("id")?(d.find("#sharpen").prop("checked",!1),d.find("#sobelX").prop("checked",!1),d.find("#sobelY").prop("checked",!1),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Convolute"!=e.type),j.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[1,1,1,1,.7,-1,-1,-1,-1]}))):"sobelX"==e(this).attr("id")?(d.find("#emboss").prop("checked",!1),d.find("#sharpen").prop("checked",!1),d.find("#sobelY").prop("checked",!1),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Convolute"!=e.type),j.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[-1,0,1,-2,0,2,-1,0,1]}))):"sobelY"==e(this).attr("id")&&(d.find("#emboss").prop("checked",!1),d.find("#sharpen").prop("checked",!1),d.find("#sobelX").prop("checked",!1),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Convolute"!=e.type),j.backgroundImage.filters.push(new fabric.Image.filters.Convolute({matrix:[-1,-2,-1,0,0,0,1,2,1]}))):"grayscale"==e(this).attr("id")?j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Grayscale"!=e.type):"sepia"==e(this).attr("id")?j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Sepia"!=e.type):"blackwhite"==e(this).attr("id")?j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"BlackWhite"!=e.type):"brownie"==e(this).attr("id")?j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Brownie"!=e.type):"vintage"==e(this).attr("id")?j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Vintage"!=e.type):"kodachrome"==e(this).attr("id")?j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Kodachrome"!=e.type):"technicolor"==e(this).attr("id")?j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Technicolor"!=e.type):"polaroid"==e(this).attr("id")?j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Polaroid"!=e.type):"shift"==e(this).attr("id")?j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Shift"!=e.type):"invert"==e(this).attr("id")?j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Invert"!=e.type):"sharpen"==e(this).attr("id")?(d.find("#emboss").prop("checked",!1),d.find("#sobelX").prop("checked",!1),d.find("#sobelY").prop("checked",!1),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Convolute"!=e.type)):"emboss"==e(this).attr("id")?(d.find("#sharpen").prop("checked",!1),d.find("#sobelX").prop("checked",!1),d.find("#sobelY").prop("checked",!1),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Convolute"!=e.type)):"sobelX"==e(this).attr("id")?(d.find("#emboss").prop("checked",!1),d.find("#sharpen").prop("checked",!1),d.find("#sobelY").prop("checked",!1),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Convolute"!=e.type)):"sobelY"==e(this).attr("id")&&(d.find("#emboss").prop("checked",!1),d.find("#sharpen").prop("checked",!1),d.find("#sobelX").prop("checked",!1),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Convolute"!=e.type)),j.backgroundImage.applyFilters(),j.requestRenderAll(),t.originalEvent&&eu('<span class="material-icons">image</span>'+palleonParams.bg+" "+palleonParams.edited)}),d.find("#palleon-filter-library").imagesLoaded(function(){d.find("#palleon-filter-library > .grid-item").not(".none").each(function(){var t=e(this),a=t.find("img")[0];pixelsJS.filterImg(a,t.data("filter"))})}),d.find("#palleon-filter-library > .grid-item").on("click",function(){var t=e(this),a=d.find("#palleon-pages").find("div.active").attr("data-origin");d.find("#palleon-filter-preview").html('<img src="'+a+'">');var n="",i=d.find("#palleon-filter-preview img")[0];""!=t.data("filter")?(pixelsJS.filterImg(i,t.data("filter")),n=d.find("#palleon-filter-preview > canvas")[0].toDataURL()):n=a,e(document).trigger("loadBase64Img",[n,d.find("#palleon-download-name").val(),!1])}),d.find("#palleon-gamma").on("change",function(){e(this).is(":checked")?j.backgroundImage.filters.push(new fabric.Image.filters.Gamma):(d.find("#gamma-red").val(1),d.find("#gamma-red").parent().parent().find(".slider-label span").html(1),d.find("#gamma-green").val(1),d.find("#gamma-green").parent().parent().find(".slider-label span").html(1),d.find("#gamma-blue").val(1),d.find("#gamma-blue").parent().parent().find(".slider-label span").html(1),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Gamma"!=e.type),j.backgroundImage.applyFilters()),j.requestRenderAll()}),d.find("#palleon-gamma-settings input").on("input",function(){var t=parseFloat(e("#gamma-red").val()),a=parseFloat(e("#gamma-green").val()),n=parseFloat(e("#gamma-blue").val()),i=[t,a,n];j.backgroundImage.filters.filter(e=>"Gamma"==e.type).forEach(e=>e.gamma=i),j.backgroundImage.applyFilters(),j.requestRenderAll()}),d.find("#palleon-gamma-settings input").on("change",function(e){e.originalEvent&&eu('<span class="material-icons">image</span>'+palleonParams.bg+" "+palleonParams.edited)}),d.find("#palleon-blur").on("change",function(){e(this).is(":checked")?j.backgroundImage.filters.push(new fabric.Image.filters.Blur):(d.find("#blur").val(0),d.find("#blur").parent().parent().find(".slider-label span").html(0),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Blur"!=e.type),j.backgroundImage.applyFilters()),j.requestRenderAll()}),d.find("#blur").on("change",function(e){j.backgroundImage.filters.filter(e=>"Blur"==e.type).forEach(e=>e.blur=parseFloat(this.value)),j.backgroundImage.applyFilters(),j.requestRenderAll(),e.originalEvent&&eu('<span class="material-icons">image</span>'+palleonParams.bg+" "+palleonParams.edited)}),d.find("#palleon-noise").on("change",function(){e(this).is(":checked")?j.backgroundImage.filters.push(new fabric.Image.filters.Noise):(d.find("#noise").val(0),d.find("#noise").parent().parent().find(".slider-label span").html(0),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Noise"!=e.type),j.backgroundImage.applyFilters()),j.requestRenderAll()}),d.find("#noise").on("input",function(){j.backgroundImage.filters.filter(e=>"Noise"==e.type).forEach(e=>e.noise=parseInt(this.value,10)),j.backgroundImage.applyFilters(),j.requestRenderAll()}),d.find("#noise").on("change",function(e){e.originalEvent&&eu('<span class="material-icons">image</span>'+palleonParams.bg+" "+palleonParams.edited)}),d.find("#palleon-pixelate").on("change",function(){e(this).is(":checked")?j.backgroundImage.filters.push(new fabric.Image.filters.Pixelate):(d.find("#pixelate").val(1),d.find("#pixelate").parent().parent().find(".slider-label span").html(1),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Pixelate"!=e.type),j.backgroundImage.applyFilters()),j.requestRenderAll()}),d.find("#pixelate").on("change",function(e){j.backgroundImage.filters.filter(e=>"Pixelate"==e.type).forEach(e=>e.blocksize=parseInt(this.value,10)),j.backgroundImage.applyFilters(),j.requestRenderAll(),e.originalEvent&&eu('<span class="material-icons">image</span>'+palleonParams.bg+" "+palleonParams.edited)}),d.find("#palleon-blend-color").on("change",function(){if(e(this).is(":checked")){var t=d.find("#blend-color-mode").val(),a=d.find("#blend-color-color").val(),n=parseFloat(d.find("#blend-color-alpha").val());j.backgroundImage.filters.push(new fabric.Image.filters.BlendColor),j.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.mode=t,e=>e.color=a,e=>e.alpha=parseFloat(n))}else d.find("#blend-color-mode").val("add"),d.find("#blend-color-color").spectrum("set","#ffffff"),d.find("#blend-color-alpha").val(.5),d.find("#blend-color-alpha").parent().parent().find(".slider-label span").html(.5),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"BlendColor"!=e.type);j.backgroundImage.applyFilters(),j.requestRenderAll()}),d.find("#blend-color-mode").on("change",function(){j.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.mode=this.value),j.backgroundImage.applyFilters(),j.requestRenderAll()}),d.find("#blend-color-color").on("change",function(){j.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.color=this.value),j.backgroundImage.applyFilters(),j.requestRenderAll()}),d.find("#blend-color-alpha").on("input",function(){j.backgroundImage.filters.filter(e=>"BlendColor"==e.type).forEach(e=>e.alpha=parseFloat(this.value)),j.backgroundImage.applyFilters(),j.requestRenderAll()}),d.find("#palleon-duotone-color").on("change",function(){e(this).is(":checked")?(T=new fabric.Image.filters.Composed({subFilters:[new fabric.Image.filters.Grayscale({mode:"luminosity"}),new fabric.Image.filters.BlendColor({color:d.find("#duotone-light-color").val()}),new fabric.Image.filters.BlendColor({color:d.find("#duotone-dark-color").val(),mode:"lighten"})]}),j.backgroundImage.filters.push(T)):(d.find("#duotone-light-color").spectrum("set","green"),d.find("#duotone-dark-color").spectrum("set","blue"),j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Composed"!=e.type)),j.backgroundImage.applyFilters(),j.requestRenderAll()}),d.find("#duotone-light-color").on("change",function(){j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Composed"!=e.type),j.backgroundImage.filters.push(T),T.subFilters[1].color=e(this).val(),j.backgroundImage.applyFilters(),j.requestRenderAll()}),d.find("#duotone-dark-color").on("change",function(){j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"Composed"!=e.type),j.backgroundImage.filters.push(T),T.subFilters[2].color=e(this).val(),j.backgroundImage.applyFilters(),j.requestRenderAll()}),d.find("#palleon-swap-apply").on("click",function(){var t=new fabric.Image.filters.SwapColor({colorSource:d.find("#color-source").val(),colorDestination:d.find("#color-destination").val()});j.backgroundImage.filters.push(t),j.backgroundImage.applyFilters(),j.requestRenderAll(),e(this).prop("disabled",!0),d.find("#palleon-swap-remove").prop("disabled",!1)}),d.find("#palleon-swap-remove").on("click",function(){j.backgroundImage.filters=j.backgroundImage.filters.filter(e=>"SwapColor"!=e.type),j.backgroundImage.applyFilters(),j.requestRenderAll(),e(this).prop("disabled",!0),d.find("#palleon-swap-apply").prop("disabled",!1)}),d.find("#palleon-swap-colors").on("change",function(){e(this).is(":checked")||d.find("#palleon-swap-remove").trigger("click")}),e.each(["text","image","shape","element"],function(t,a){d.find("#palleon-"+a+"-shadow").on("change",function(){var t=new fabric.Shadow({color:d.find("#"+a+"-shadow-color").val(),blur:d.find("#"+a+"-shadow-blur").val(),offsetX:d.find("#"+a+"-shadow-offset-x").val(),offsetY:d.find("#"+a+"-shadow-offset-y").val()});e(this).is(":checked")?j.getActiveObject().shadow=t:j.getActiveObject().shadow=null,j.requestRenderAll()}),d.find("#"+a+"-shadow-color").bind("change",function(){j.getActiveObject().shadow.color=e(this).val(),j.requestRenderAll()}),d.find("#"+a+"-shadow-settings input[type=number]").bind("input paste keyup keydown",function(){var t=e(this).val();e(this).attr("id")==a+"-shadow-blur"?j.getActiveObject().shadow.blur=parseInt(t):e(this).attr("id")==a+"-shadow-offset-x"?j.getActiveObject().shadow.offsetX=parseInt(t):e(this).attr("id")==a+"-shadow-offset-y"&&(j.getActiveObject().shadow.offsetY=parseInt(t)),j.requestRenderAll()})}),e.each(["text","shape","element"],function(e,t){d.find("#palleon-"+t+"-gradient").on("change",function(){eO(t)}),d.find("#"+t+"-gradient-color-1").on("change",function(){eO(t)}),d.find("#"+t+"-gradient-color-2").on("change",function(){eO(t)}),d.find("#"+t+"-gradient-color-3").on("change",function(){eO(t)}),d.find("#"+t+"-gradient-color-4").on("change",function(){eO(t)})}),d.find("#palleon-add-text").on("click",function(){var e=new fabric.Textbox(palleonParams.textbox,{objectType:"textbox",gradientFill:"none",fontSize:p.fontSize,fontFamily:p.fontFamily,fontWeight:p.fontWeight,fontStyle:p.fontStyle,lineHeight:p.lineHeight,fill:p.fill,stroke:p.stroke,strokeWidth:p.strokeWidth,textBackgroundColor:p.textBackgroundColor,textAlign:p.textAlign,width:eT()[0]/2,top:eT()[1]/2,left:eT()[0]/2,originX:"center",originY:"center"});j.add(e),j.setActiveObject(e),j.fire("palleon:history",{type:"textbox",text:palleonParams.added})}),d.find("#palleon-text-input").bind("input paste",function(){j.getActiveObject().set("text",e(this).val()),d.find("#palleon-layers #"+j.getActiveObject().id+" .layer-name").html(j.getActiveObject().text),j.requestRenderAll()}),d.find("#palleon-text-input").bind("focusout",function(){j.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),d.find("#palleon-font-family").on("change",function(){var t=e(this).val(),a=e(this).find("option:selected").text();console.log(a);var n="yes";if(q.includes(a))n="no";else for(var i=0;i<z.length;i++)if(z[i][1]==t){n="no";break}if("yes"==n){WebFont.load({google:{families:[t+":regular,bold",t+":italic,regular,bold"]}});var l=new FontFaceObserver(t,{weight:"normal",style:"normal"}),o=new FontFaceObserver(t,{weight:"bold",style:"normal"}),r=new FontFaceObserver(t,{weight:"normal",style:"italic"}),s=new FontFaceObserver(t,{weight:"bold",style:"italic"});Promise.all([l.load(null,5e3),o.load(null,5e3),r.load(null,5e3),s.load(null,5e3)]).then(function(){j.getActiveObject().set("fontFamily",t),j.requestRenderAll()}).catch(function(e){console.log(e)})}else j.getActiveObject().set("fontFamily",t),j.requestRenderAll()});var e3=0;function eR(t){var a=t.element;return e(a).data("icon")?e('<div class="select2-item"><span class="material-icons">'+e(a).data("icon")+"</span>"+t.text+"</div>"):e(a).data("font")?e('<div class="select2-item" style="font-family:'+e(a).data("font")+'">'+t.text+"</div>"):e('<div class="select2-item">'+t.text+"</div>")}d.find("#palleon-font-family").on("select2:open",function(){d.find("#select2-palleon-font-family-results").scroll(function(){e(this).find("li:last-child").find("ul li").each(function(){var t=e(this);t.is(":in-viewport( 0, #select2-palleon-font-family-results)")&&!q.includes(t.find("div").text())&&(WebFont.load({google:{families:[t.find(".select2-item").html()]},inactive:function(){WebFont.load({custom:{families:[t.find(".select2-item").html()],urls:["https://fonts.googleapis.com/css?family="+t.find(".select2-item").html()+"&text=abc"]},active:function(){console.log("active")}})}}),q.push(t.find("div").text()))})}),d.on("keypress",".select2-search .select2-search__field",function(e){window.clearTimeout(e3),e3=setTimeout(function(){d.find("#select2-palleon-font-family-results").trigger("scroll")},500)})}),d.find("#palleon-text-format-btns > .palleon-btn").on("click",function(){if("format-uppercase"==e(this).attr("id")){var t=d.find("#palleon-text-input").val();t=t===t.toUpperCase()?t.toLowerCase():t.toUpperCase(),d.find("#palleon-text-input").val(t),d.find("#palleon-text-input").trigger("input")}e(this).hasClass("active")?("format-bold"==e(this).attr("id")&&(j.getActiveObject().set("fontWeight","normal"),e(this).removeClass("active")),"format-italic"==e(this).attr("id")&&(j.getActiveObject().set("fontStyle","normal"),e(this).removeClass("active")),"format-underlined"==e(this).attr("id")&&(j.getActiveObject().set("underline",!1),e(this).removeClass("active"))):("format-bold"==e(this).attr("id")&&j.getActiveObject().set("fontWeight","bold"),"format-italic"==e(this).attr("id")&&j.getActiveObject().set("fontStyle","italic"),"format-underlined"==e(this).attr("id")&&j.getActiveObject().set("underline",!0),"format-align-left"==e(this).attr("id")&&j.getActiveObject().set("textAlign","left"),"format-align-right"==e(this).attr("id")&&j.getActiveObject().set("textAlign","right"),"format-align-center"==e(this).attr("id")&&j.getActiveObject().set("textAlign","center"),"format-align-justify"==e(this).attr("id")&&j.getActiveObject().set("textAlign","justify"),d.find(".format-align").removeClass("active"),"format-uppercase"!=e(this).attr("id")&&e(this).addClass("active")),j.requestRenderAll(),j.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),d.find("#palleon-text-settings input[type=number]").bind("input paste keyup keydown",function(){var t=e(this).val();"palleon-font-size"==e(this).attr("id")?j.getActiveObject().set("fontSize",parseInt(t)):"palleon-outline-size"==e(this).attr("id")?j.getActiveObject().set("strokeWidth",parseInt(t)):"palleon-line-height"==e(this).attr("id")?j.getActiveObject().set("lineHeight",parseFloat(t)):"palleon-letter-spacing"==e(this).attr("id")&&j.getActiveObject().set("charSpacing",parseInt(t)),j.requestRenderAll()}),d.find("#palleon-text-settings input[type=number]").bind("input",function(){window.clearTimeout(R),R=setTimeout(function(){j.fire("palleon:history",{type:"textbox",text:palleonParams.edited})},500)}),d.find("#palleon-text-settings .palleon-colorpicker").bind("change",function(){var t=e(this).val();"palleon-text-color"==e(this).attr("id")?j.getActiveObject().set("fill",t):"palleon-outline-color"==e(this).attr("id")?j.getActiveObject().set("stroke",t):"palleon-text-background"==e(this).attr("id")&&j.getActiveObject().set("textBackgroundColor",t),j.requestRenderAll(),j.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),d.find("#palleon-text-flip-btns > .palleon-btn").on("click",function(){e(this).hasClass("active")?("text-flip-x"==e(this).attr("id")?j.getActiveObject().set("flipX",!1):"text-flip-y"==e(this).attr("id")&&j.getActiveObject().set("flipY",!1),e(this).removeClass("active")):("text-flip-x"==e(this).attr("id")?j.getActiveObject().set("flipX",!0):"text-flip-y"==e(this).attr("id")&&j.getActiveObject().set("flipY",!0),e(this).addClass("active")),j.requestRenderAll(),j.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),d.find("#palleon-text-settings input[type=range]").bind("input click",function(){var t=e(this).val();"text-skew-x"==e(this).attr("id")?j.getActiveObject().set("skewX",parseInt(t)):"text-skew-y"==e(this).attr("id")?j.getActiveObject().set("skewY",parseInt(t)):"text-rotate"==e(this).attr("id")?j.getActiveObject().set("angle",parseInt(t)):"text-opacity"==e(this).attr("id")&&j.getActiveObject().set("opacity",parseFloat(t)),j.requestRenderAll()}),d.find("#palleon-text-settings input[type=range]").bind("change",function(){j.fire("palleon:history",{type:"textbox",text:palleonParams.edited})}),d.find("#palleon-img-upload").on("change",function(e){var t=new FileReader;t.onload=function(e){var t=new Image;G(e.target.result,function(e){t.src=e,t.onload=function(){var e=new fabric.Image(t);e.set({objectType:"image",objectCaching:!0,roundedCorders:0,stroke:"#fff",strokeWidth:0,top:eT()[1]/2,left:eT()[0]/2,originX:"center",originY:"center"}),e.set({ogWidth:e.get("width"),ogHeight:e.get("height")}),j.add(e),e.scaleToWidth(eT()[0]/2),e.isPartiallyOnScreen()&&e.scaleToHeight(eT()[1]/2),j.setActiveObject(e),j.requestRenderAll()}})},t.readAsDataURL(e.target.files[0]),j.fire("palleon:history",{type:"image",text:palleonParams.added})}),d.find("#palleon-overlay-img-upload").on("change",function(t){if(""!=e(this).val()){d.find("#palleon-canvas-loader").css("display","flex");var a=new FileReader;a.onload=function(e){fabric.Image.fromURL(e.target.result,function(t){t.set({scaleX:eT()[0]/t.width,scaleY:eT()[1]/t.height,objectCaching:!1,originX:"left",originY:"top",selectable:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,erasable:!0}),j.setOverlayImage(t,j.renderAll.bind(j)),d.find("#palleon-overlay-wrap").show(),d.find("#palleon-overlay-preview").attr("src",e.target.result),setTimeout(function(){d.find("#palleon-canvas-loader").hide()},500)})},a.readAsDataURL(t.target.files[0]),j.fire("palleon:history",{type:"image",text:palleonParams.added})}}),d.find("#palleon-overlay-delete").on("click",function(){void 0!==j.overlayImage&&null!==j.overlayImage&&(j.overlayImage=null,d.find("#palleon-overlay-wrap").hide(),d.find("#palleon-overlay-preview").attr("src",""),j.requestRenderAll())}),d.find("#img-flip-horizontal").on("click",function(){j.getActiveObject().toggle("flipX"),j.requestRenderAll(),j.fire("palleon:history",{type:"image",text:palleonParams.edited})}),d.find("#img-flip-vertical").on("click",function(){j.getActiveObject().toggle("flipY"),j.requestRenderAll(),j.fire("palleon:history",{type:"image",text:palleonParams.edited})});var e1=(e,t)=>new fabric.Rect({width:e.width,height:e.height,rx:t/e.scaleX,ry:t/e.scaleY,left:-e.width/2,top:-e.height/2});d.find("#img-border-radius").on("input",function(){j.getActiveObject().set("clipPath",e1(j.getActiveObject(),parseInt(e(this).val()))),j.getActiveObject().set("roundedCorders",parseInt(e(this).val())),j.requestRenderAll()}),d.find("#img-border-radius").bind("change",function(){j.fire("palleon:history",{type:"image",text:palleonParams.edited})}),d.find("#img-border-color").bind("change",function(){j.getActiveObject().set("stroke",e(this).val()),j.requestRenderAll(),j.fire("palleon:history",{type:"image",text:palleonParams.edited})}),d.find("#palleon-image-settings input[type=number]").on("input paste",function(){var t=parseInt(e(this).val());"img-border-width"==e(this).attr("id")&&j.getActiveObject().set("strokeWidth",t),j.requestRenderAll()}),d.find("#palleon-image-settings input[type=number]").bind("input",function(){window.clearTimeout(R),R=setTimeout(function(){j.fire("palleon:history",{type:"image",text:palleonParams.edited})},500)}),d.find("#palleon-image-settings input[type=range]").bind("input click",function(){var t=e(this).val();"img-skew-x"==e(this).attr("id")?j.getActiveObject().set("skewX",parseInt(t)):"img-skew-y"==e(this).attr("id")?j.getActiveObject().set("skewY",parseInt(t)):"img-rotate"==e(this).attr("id")?j.getActiveObject().set("angle",parseInt(t)):"img-opacity"==e(this).attr("id")&&j.getActiveObject().set("opacity",parseFloat(t)),j.requestRenderAll()}),d.find("#palleon-image-settings input[type=range]").bind("change",function(){j.fire("palleon:history",{type:"image",text:palleonParams.edited})}),d.find("#shape-rounded-corners").on("input",function(){var t=parseInt(e(this).val()),a=j.getActiveObject();("square"==a.objectType||"rectangle"==a.objectType)&&(a.set("rx",t),a.set("ry",t)),j.requestRenderAll()}),d.on("click","#palleon-shapes-grid > div",function(){var t=e(this).attr("data-id");"printarea"==t&&(j.getObjects().filter(e=>"BG"!=e.objectType).forEach(e=>j.remove(e)),d.find("#palleon-layers li").remove());var a=eT()[1]/2,n=eT()[0]/2,i=j.getObjects().filter(e=>"printarea"==e.objectType)[0];if(i&&(a=i.top,n=i.left),"customShape"==t){var l=new XMLSerializer().serializeToString(e(this)[0]);fabric.loadSVGFromString(l,function(e,t){var l=fabric.util.groupSVGElements(e,t);l.set("originX","center"),l.set("originY","center"),l.set("left",n),l.set("top",a),l.set("objectType","customShape"),l.set("gradientFill","none"),l.set("stroke","#000"),l.set("strokeWidth",0),l.set("fill","#fff"),j.add(l),i?(l.scaleToWidth(.5*i.width*j.getZoom()),l.isContainedWithinObject(i)||l.scaleToHeight(.5*i.height*j.getZoom())):(l.scaleToWidth(eT()[0]/8),l.isPartiallyOnScreen()&&l.scaleToHeight(eT()[1]/8)),j.setActiveObject(l),j.requestRenderAll(),j.fire("palleon:history",{type:"customShape",text:palleonParams.added})},function(){},{crossOrigin:"anonymous"})}else{var o="",r="";"circle"==t?(o=new fabric.Circle({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"circle",width:100,height:100,gradientFill:"none",top:a,left:n,originX:"center",originY:"center"})).controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})}:"ellipse"==t?o=new fabric.Ellipse({rx:75,ry:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"ellipse",width:100,height:100,gradientFill:"none",top:a,left:n,originX:"center",originY:"center"}):"square"==t?(o=new fabric.Rect({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"square",width:100,height:100,gradientFill:"none",top:a,left:n,originX:"center",originY:"center"})).controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})}:"rectangle"==t?o=new fabric.Rect({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"rectangle",width:200,height:150,gradientFill:"none",top:a,left:n,originX:"center",originY:"center"}):"triangle"==t?o=new fabric.Triangle({radius:50,fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"triangle",width:100,height:100,gradientFill:"none",top:a,left:n,originX:"center",originY:"center"}):"trapezoid"==t?(r=[{x:-100,y:-50},{x:100,y:-50},{x:150,y:50},{x:-150,y:50}],o=new fabric.Polygon(r,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"trapezoid",width:100,height:100,gradientFill:"none",top:a,left:n,originX:"center",originY:"center"})):"pentagon"==t?(r=[{x:26,y:86},{x:11.2,y:40.4},{x:50,y:12.2},{x:88.8,y:40.4},{x:74,y:86}],o=new fabric.Polygon(r,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"pentagon",width:100,height:100,gradientFill:"none",top:a,left:n,originX:"center",originY:"center"})):"octagon"==t?(r=[{x:34.2,y:87.4},{x:12.3,y:65.5},{x:12.3,y:34.5},{x:34.2,y:12.6},{x:65.2,y:12.6},{x:87.1,y:34.5},{x:87.1,y:65.5},{x:65.2,y:87.4}],o=new fabric.Polygon(r,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"octagon",width:100,height:100,gradientFill:"none",top:a,left:n,originX:"center",originY:"center"})):"emerald"==t?(r=[{x:850,y:75},{x:958,y:137.5},{x:958,y:262.5},{x:850,y:325},{x:742,y:262.5},{x:742,y:137.5}],o=new fabric.Polygon(r,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"emerald",width:100,height:100,gradientFill:"none",top:a,left:n,originX:"center",originY:"center"})):"star"==t?(r=[{x:350,y:75},{x:380,y:160},{x:470,y:160},{x:400,y:215},{x:423,y:301},{x:350,y:250},{x:277,y:301},{x:303,y:215},{x:231,y:161},{x:321,y:161}],o=new fabric.Polygon(r,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"star",width:100,height:100,gradientFill:"none",top:a,left:n,originX:"center",originY:"center"})):"diamond"==t?(r=[{x:69.445,y:125},{x:125,y:28.774},{x:180.556,y:125},{x:125,y:221.227}],o=new fabric.Polygon(r,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"diamond",width:100,height:100,gradientFill:"none",top:a,left:n,originX:"center",originY:"center"})):"parallelogram"==t?(r=[{x:15,y:10},{x:55,y:10},{x:45,y:20},{x:5,y:20}],o=new fabric.Polygon(r,{fill:"#fff",stroke:"#000",strokeWidth:0,objectType:"parallelogram",width:100,height:100,gradientFill:"none",top:a,left:n,originX:"center",originY:"center"})):"printarea"==t&&((o=new fabric.Rect({radius:50,fill:"",stroke:"#4affff",strokeWidth:3,strokeDashArray:[10,5],objectType:"printarea",width:y/2,height:$/2,gradientFill:"none",top:a,left:n,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,originX:"center",originY:"center"})).controls={...fabric.Rect.prototype.controls,mtr:new fabric.Control({visible:!1}),ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1}),tl:new fabric.Control({visible:!1}),bl:new fabric.Control({visible:!1}),tr:new fabric.Control({visible:!1}),br:new fabric.Control({visible:!1})}),j.add(o),i?(o.scaleToWidth(.5*i.width*j.getZoom()),o.isContainedWithinObject(i)||o.scaleToHeight(.5*i.height*j.getZoom())):"printarea"!=o.objectType&&(o.scaleToWidth(eT()[0]/6),o.isPartiallyOnScreen()&&o.scaleToHeight(eT()[1]/6)),j.setActiveObject(o),j.requestRenderAll(),j.fire("palleon:history",{type:t,text:palleonParams.added})}}),d.find("#palleon-shape-loadmore").on("click",function(){var t=e(this);t.html(palleonParams.loading),t.prop("disabled",!0),e.getJSON(p.baseURL+"json/shapes.json",function(a){e.each(a,function(e,t){var a='<div class="palleon-shape" data-id="customShape" title="'+palleonParams.customShape+'">'+t+"</div>";d.find("#palleon-shapes-grid").append(a)}),t.remove()})}),d.find("#palleon-shape-settings .palleon-colorpicker").bind("change",function(){var t=e(this).val();"palleon-shape-color"==e(this).attr("id")?j.getActiveObject().set("fill",t):"shape-outline-color"==e(this).attr("id")&&j.getActiveObject().set("stroke",t),j.requestRenderAll(),j.fire("palleon:history",{type:j.getActiveObject().objectType,text:palleonParams.edited})}),d.find("#palleon-shape-settings input[type=range]").bind("input click",function(){var t=e(this).val();"shape-skew-x"==e(this).attr("id")?j.getActiveObject().set("skewX",parseInt(t)):"shape-skew-y"==e(this).attr("id")?j.getActiveObject().set("skewY",parseInt(t)):"shape-rotate"==e(this).attr("id")?j.getActiveObject().set("angle",parseInt(t)):"shape-opacity"==e(this).attr("id")&&j.getActiveObject().set("opacity",parseFloat(t)),j.requestRenderAll()}),d.find("#palleon-shape-settings input[type=range]").bind("change",function(){j.fire("palleon:history",{type:j.getActiveObject().objectType,text:palleonParams.edited})}),d.find("#palleon-shape-settings input[type=number]").bind("input paste",function(){var t=parseInt(e(this).val());"shape-outline-width"==e(this).attr("id")?j.getActiveObject().set("strokeWidth",t):"shape-custom-width"==e(this).attr("id")?(j.getActiveObject().set("width",t),j.getActiveObject().set("scaleX",1)):"shape-custom-height"==e(this).attr("id")&&(j.getActiveObject().set("height",t),j.getActiveObject().set("scaleY",1)),j.requestRenderAll()}),d.find("#palleon-shape-settings input[type=number]").bind("input",function(){window.clearTimeout(R),R=setTimeout(function(){j.fire("palleon:history",{type:j.getActiveObject().objectType,text:palleonParams.edited})},500)}),d.find("#shape-custom-width").bind("input paste",function(){if(d.find("#palleon-shape-ratio-lock").hasClass("active")){var t=parseInt(e(this).val()),a=parseInt(d.find("#palleon-shape-ratio-w").val()),n=parseInt(d.find("#palleon-shape-ratio-h").val()),i=t*n/a;d.find("#shape-custom-height").val(Math.round(i)),j.getActiveObject().set("height",i),j.getActiveObject().set("scaleY",1)}}),d.find("#shape-custom-height").bind("input paste",function(){if(d.find("#palleon-shape-ratio-lock").hasClass("active")){var t=e(this).val(),a=parseInt(d.find("#palleon-shape-ratio-w").val()),n=parseInt(d.find("#palleon-shape-ratio-h").val()),i=t*a/n;d.find("#shape-custom-width").val(Math.round(i)),j.getActiveObject().set("width",i),j.getActiveObject().set("scaleX",1)}});var e2=function(e){d.find("#palleon-frames-wrap li").hide().filter('[data-keyword*="'+e+'"]').show()};function eq(t){var a=j.getObjects().filter(e=>"frame"==e.objectType);e.each(a,function(e,a){var n=a.angle,i=a.width,l=a.height,o=eT()[0],r=eT()[1];(0==n||180==n||-180==n)&&(o=eT()[1],r=eT()[0]),"right"==t?0==n?n=90:90==n?n=180:180==n?n=270:270==n?n=0:-90==n?n=0:-180==n?n=-90:-270==n&&(n=-180):"left"==t&&(0==n?n=-90:-90==n?n=-180:-180==n?n=-270:-270==n?n=0:90==n?n=0:180==n?n=90:270==n&&(n=180)),a.set("left",eT()[0]/2),a.set("top",eT()[1]/2),a.set("scaleX",o/i),a.set("scaleY",r/l),a.set("angle",n)}),j.requestRenderAll(),j.fire("palleon:history",{type:"frame",text:palleonParams.edited})}d.find("#palleon-frame-search").on("keyup input",function(){d.find("#palleon-noframes").hide();var t=e(this).val().toLowerCase().replace(/\s/g," ");""==t||t.length<1?(d.find("#palleon-frames-wrap li").show(),d.find("#palleon-frame-search-icon").html("search"),d.find("#palleon-frame-search-icon").removeClass("cancel")):(d.find("#palleon-frame-search-icon").html("clear"),d.find("#palleon-frame-search-icon").addClass("cancel"),e2(t),0===d.find("#palleon-frames-wrap li:visible").length&&d.find("#palleon-noframes").show())}),d.find("#palleon-frame-search-icon").on("click",function(){e(this).hasClass("cancel")&&(e(this).removeClass("cancel"),e(this).html("search"),d.find("#palleon-frame-search").val(""),d.find("#palleon-frames-wrap li").show(),d.find("#palleon-noframes").hide())}),d.find(".palleon-frames-grid").on("click",".palleon-frame img",function(){d.find("#palleon-canvas-loader").css("display","flex");var t=e(this).parent().parent(),a=t.data("elsource");d.find(".palleon-frames-grid .palleon-frame").removeClass("active"),t.addClass("active"),fabric.loadSVGFromURL(a,function(e,t){var a=fabric.util.groupSVGElements(e,t),n=a.width,i=a.height;a.set("originX","center"),a.set("originY","center"),a.set("left",eT()[0]/2),a.set("top",eT()[1]/2),a.set("scaleX",(eT()[0]+2)/n),a.set("scaleY",(eT()[1]+2)/i),a.set("objectType","frame"),j.add(a),j.setActiveObject(a),j.requestRenderAll(),d.find("#palleon-canvas-loader").hide()},function(){},{crossOrigin:"anonymous"}),j.fire("palleon:history",{type:"frame",text:palleonParams.added})}),d.find("#palleon-frame-color").bind("change",function(){var t=e(this).val(),a=j.getObjects().filter(e=>"frame"==e.objectType);e.each(a,function(e,a){ed(a)&&a.set("fill",t)}),j.requestRenderAll(),j.fire("palleon:history",{type:"frame",text:palleonParams.edited})}),d.find("#palleon-rotate-right-frame").on("click",function(){eq("right")}),d.find("#palleon-rotate-left-frame").on("click",function(){eq("left")}),d.find("#palleon-flip-horizontal-frame").on("click",function(){var t=j.getObjects().filter(e=>"frame"==e.objectType);e.each(t,function(e,t){t.toggle("flipX")}),j.requestRenderAll(),j.fire("palleon:history",{type:"frame",text:palleonParams.edited})}),d.find("#palleon-flip-vertical-frame").on("click",function(){var t=j.getObjects().filter(e=>"frame"==e.objectType);e.each(t,function(e,t){t.toggle("flipY")}),j.requestRenderAll(),j.fire("palleon:history",{type:"frame",text:palleonParams.edited})}),a="",function e(t){let a=t.length;for(;0!=a;){let n=Math.floor(Math.random()*a);a--,[t[a],t[n]]=[t[n],t[a]]}}(n=["3d-modeling","404-page-not-found","a-better-world","a-day-at-the-park","a-day-off","a-moment-to-relax","about-me","about-us-page","absorbed-in","abstract","accept-request","accept-tasks","access-account","access-denied","account","active-support","add-color","add-document","add-files","add-friends","add-information","add-notes","add-post","add-tasks","address","adjustments","advanced-customization","adventure-map","adventure","agree","agreement","ai-voice-interface","air-support","aircraft","alert","all-the-data","among-nature","amusement-park","analysis","analytics","analyze","animating","annotation","anonymous-feedback","apartment-rent","app-data","app-installation","app-wireframe","application","applications","appreciate-it","apps notifications","apps-2","apps","around-the-world","art-lover","art-thinking","art","articles","artificial-intelligence","artist","ask-me-anything","asset-selection","astronaut","at-home","at-the-park","at-work","athletes-training","attached-file","audio-conversation","audio-player","augmented-reality","authentication","autumn","baby","back-home","balloons","barbecue","barista","basketball","beach-day","bear-market","beer","before-dawn","begin-chat","best-place","bibliophile","biking","birthday-cake","birthday-girl","bitcoin-digital-currency","bitcoin-p2p","bitcoin","blank-canvas","blog-post","blog","blogging","blooming","body-text","book-lover","book-reading","booked","booking","bookmarks","books","bookshelves","both-sides","brainstorming","breakfast","breaking-obstacles","browser-stats","browsing-online","browsing","buddies","build-wireframe","build-your-home","building-blocks","building-websites","building","bull-market","bus-stop","business-analytics","business-chat","business-deal","business-decisions","business-man","business-plan","business-shop","business-woman-2","businessman","button-style","buy-house","by-the-road","cabin","calculator","calling","camera","campfire","camping","cancel","candidate","car-repair","card-postal","career-development","cat","celebration","certificate","certification","character-drawing","charts","chat","chatting-2","chatting","check-boxes","checking-boxes","checklist","chilling","choice","choose-card","choose-color","choose","choosing-house","chore-list","christmas-mode","circuit-board","circuit","city-driver","city-girl","city-life","clean-up","close-tab","cloud-docs","cloud-files","cloud-hosting","cloud-sync","cms","co-workers","co-working","code-inspection","code-review","code-thinking","code-typing","coding","coffee-break","coffee-time","coffee-with-friends","cohort-analysis","collab","collaborating","collaboration","collaborators","collecting","collection","color-palette","color-schemes","coming-home","community","complete-design","complete-task","completed-steps","completed-tasks","completed","completing","completion-progress","compose-music","composition","computer-apps","conceptual-idea","conference-call","conference-speaker","conference","confidential-letter","confirm","confirmation","confirmed","connected-world","connected","connecting-teams","connection","contact-us","content-creator","content-structure","content-team","content","contract","contrast","control-panel","conversation","convert","cookie-love","cooking","coolness","counting-stars","country-side","couple-love","couple","create","creation-process","creation","creative-draft","creative-experiment","creative-process","creative-team","creative-thinking","creative-woman","creativity","credit-card-payment","credit-card-payments","credit-card","crypto-bitcoin-flowers","crypto-portfolio","current-location","customer-survey","dark-analytics","dashboard","data-points","data-processing","data-report","data-trends","data","date-night","date-picker","deconstructed","decorate-christmas-tree","deliveries","delivery-address","delivery-truck","delivery","departing","design-components","design-data","design-feedback","design-inspiration","design-notes","design-objectives","design-process","design-sprint","design-stats","design-team","design","designer-girl","designer-life","designer-mindset","designer","destination","destinations","detailed-analysis","detailed-examination","detailed-information","details","dev-focus","dev-productivity","develop-app","developer-activity","development","devices","diary","diet","different-love","digital-artwork","digital-nomad","discoverable","doctors","dog","domain-names","done-checking","done","download","drag","dream-world","dreamer","dring-coffee","drone-delivery","drone-surveillance","dropdown-menu","duplicate","eating-together","edit-photo","editable","education","educator","eiffel-tower","election-day","electricity","elements","emails","empty-cart","empty-street","empty","energizer","engineering-team","enter","envelope","environmental-study","escaping","ether","ethereum","events","everyday-design","everyday-life","everywhere-together","exams","exciting-news","expecting","experience-design","experts","explore","exploring","export-files","factory","fall","family","fans","farm-girl","farming","fashion-blogging","fashion-photoshoot","fast-loading","favorite-post","favorite","favourite-item","features-overview","feedback","feeling-of-joy","feeling-proud","female-avatar","file-analysis","file-bundle","file-manager","file-searching","file-sync","file-synchronization","filing-system","fill-in","filter","finance","financial-data","find-the-message","fingerprint-login","finish-line","fireworks","firmware","fitness-stats","fitting-piece-2","fitting-pieces","fixing-bugs","floating","flowers","flying-drone","folder-files","folder","followers","following","font","for-sale","forgot-password","forming-ideas","forms","founding-team","freelancer","friends","fun-moments","functions","futuristic-interface","game-world","gaming","gardening","genius","getting-coffee","gift-box","gift-card","gift","gifts","goals","going-offline","going-up","golden-gate-bridge","golf","gone-shopping","good-doggy","good-team","grades","grand-slam","gravitas","greek-freak","grid-design","groceries","group-chat","group-hangout","group-selfie","group-video","growth-analytics","growth-curve","hacker-mind","hacker-mindset","halloween","hamburger","hang-out","happy-announcement","happy-birthday","happy-feeling","happy-music","happy-new-year","happy-news","happy-women-day","happy","having-fun","healthy-habit","healthy-lifestyle","healthy-options","heatmap","heavy-box","hello","helpful-sign","high-five","hiking","hire","hologram","home-cinema","home-run","home-screen","home-settings","hooked","hot-beverage","house-searching","ice-cream","icon-design","ideas-flow","ideas","ideation","image-focus","image-folder","image-options","image-post","image-upload","image-viewer","images","imagination","in-love","in-no-time","in-progress","in-real-life","in-sync","in-the-office","in-the-zone","in-thought","inbox-cleanup","indoor-bike","influencer","information-tab","injured","innovative","insert-block","insert","inspection","inspiration","instant-analysis","instant-information","instant-support","intense-feeling","interior-design","internet-on-the-go","interview","into-the-night","invest","investing","investment-data","investment","investor-update","jagging","jewelleries","job-hunt","job-offers","join","journey","joyride","junior-soccer","just-browsing","key-points","knowledge","landing-page","landing","landscape-mode","landscape-photographer","late-at-night","launch-day","launching","learning-sketching","learning","light-the-fire","lightbulb-moment","like-dislike","like-post","link","live-collaboration","live-photo","living","load-more","location-search","location-tracking","logic","login","logo-design","lost","love-is-in-the-air","love-it","loving-it","loving-story","mail","mailbox","maintenance","make-it-rain","maker-launch","making-art","male-avatar","manage-chats","map-dark","map","marketing","mathematics","media-player","medical-care","medical-research","meditating","meditation","meet-the-team","meeting","mello","memory-storage","mention","message-sent","messaging-2","messaging-app","messaging-fun","messaging","messenger","metrics","mic-drop","min-map","mindfulness","mobila-marketing","mobile-analystics","mobile-analytics","mobile-app-layout","mobile-application","mobile-apps","mobile-browsers","mobile-content","mobile-development","mobile-devices","mobile-encryption","mobile-feed","mobile-images","mobile-inbox","mobile-interface","mobile-life","mobile-messages","mobile-pay","mobile-payments","mobile-photos","mobile-posts-2","mobile-posts","mobile-profile","mobile-prototyping","mobile-search","mobile-site","mobile-testing","mobile-user","mobile-ux","mobile-web","mobile-wireframe","modern-art","modern-design","modern-life","modern-professional","modern-woman","moment-to-remember","moments","monthly-users","moonlight","mornings","movie-night","moving-forward","moving","multitasking","my-answer","my-app","my-code-snippets","my-current-location","my-documents","my-feed","my-files","my-location","my-notifications","my-password","my-personal-files","my-universe","my-website","nakamoto","nature-benefits","nature-fun","nature-on-screen","nature","navigation","navigator","neighbors","new-entries","new-ideas","new-message","new-notifications","new-year-2025","newsletter","newspaper","next-option","next-tasks","no-data","not-found","note-list","notebook-2","notebook","noted","notes","notifications","notify","nuxt-js","off-road","office-snack","omega","on-the-office","on-the-way","onboarding","online-ad","online-art","online-article","online-articles","online-banking","online-calendar","online-chat","online-collaboration","online-connection","online-cv","online-dating","online-discussion","online-everywhere","online-groceries","online-information","online-learning","online-media","online-message","online-messaging","online-organizer","online-party","online-payments","online-posts","online-reading","online-resume","online-shopping","online-stats","online-test","online-transactions","online-video","online-wishes","online-world","online","open-notes","open-source","opened-tabs","opened","opinion","optimize-image","options","order-a-car","order-confirmed","order-delivered","order-flowers","order-ride","ordinary-day","organize-photos","organize-resume","organizing-projects","os-upgrade","our-neighborhood","our-solution","outdoor-adventure","outdoor-party","outdoors","outer-space","pair-programming","pancakes","partying","passing-by","pay-online","payments","pen-tool","people-search","people","performance-overview","persentages","personal-data","personal-documents","personal-email","personal-file","personal-finance","personal-goals","personal-info","personal-information","personal-notebook","personal-opinions","personal-settings","personal-site","personal-text","personal-trainer","personal-training","personal-website","personalization","pet-adoption","phone-call","photo-album","photo-session","photo-sharing","photo","photocopy","photograph","photos","pic-profile","picture","pie-chart","pie-graph","pilates","pitching","placeholders","plain-credit-card","play-time","playful-cat","playing-cards","playing-fetch","playing-golf","playlist","pleasant-surprise","podcast-audience","podcast-listener","podcast","polaroid","portfolio-feedback","portfolio-update","portfolio-website","portfolio","positive-attitude","post-2","post-online","post","posting-photo","posts","powerful-superhero","predictive-analytics","preferences-popup","preferences","presentation","press-play","pride","prioritise","private-data","process","processing-thoughts","processing","product-explainer","product-iteration","product-photography","product-teardown","product-tour","professional-card","professor","profile-data","profile-details","profile-image","profile-pic","profile","programmer","programming","progress-data","progress-indicator","progress-overview","progressive-app","project-complete","project-completed","project-feedback","project-team","projections","prototyping-process","proud-coder","proud-self","public-discussion","publish-article","publish-new-post","publishing-post","pull-request","pumpkin","pure-love","push-notifications","quality-time","questions","quick-chat","quiet-street","quiet-town","quitting-time","quiz","random-thoughts","react","read-notes","reading-2","reading-time","reading","ready-for-waves","ready-to-print","real-time-analytics","real-time-collaboration","real-time-sync","receipt","recording","redesign-feedback","referral","refreshing-beverage","regain-focus","relaunch-day","relaxation","relaxed-reading","relaxing-at-home","relaxing-walk","reminder","reminders","remote-meeting","remotely","report","researching","respond","responsive","result","revenue","review","reviewed-docs","reviews","ride-a-bicycle","right-direction","right-places","road-sign","romantic-getaway","runner-start","running-wild","santa-visit","save-to-bookmarks","schedule","science","scientist","scooter","screen-time","scrum-board","search-app","search-engines","search","searching","season-change","secure-files","secure-login","secure-server","security-on","security","segment-analysis","segment","segmentation","select-house","select-option-2","select-option","selected-box","selected-options","selecting-team","selecting","selection-2","selection","selfie","send-gift","sentiment-analysis","server-cluster","server-push","server-status","services","set-preferences","settings-tab","settings","setup-analytics","setup-wizard","share-link","share-online","share-your-opinion","shared-goals","shared-workspace","sharing-articles","sharing-knowledge","shopping-app","shopping-bags","shopping","short-bio","showing-support","sign-in","sign-up-2","sign-up","signal-searching","site-content","site-stats","skateboard","slider","small-town","smart-home","smart-resize","smartphone","smartwatch","smiley-face","snap-the-moment","snow-fun","snow-games","snow-globe","snowman","social-bio","social-dashboard","social-distancing","social-expert","social-friends","social-girl","social-growth","social-ideas","social-influencer","social-interaction","social-life","social-media","social-networking","social-notifications","social-post","social-serenity","social-share","social-sharing","social-strategy","social-thinking","social-update","social-user","software-engineer","solution-mindset","sorting-thoughts","source-code","special-event","specs","speech-to-text","speed-test","split-testing","spooky-self","spread-love","spreadsheet","spreadsheets","stand-out","starlink","starry-window","stars","start-building","startup-life","static-website","statistic-chart","statistics","step-to-the-sun","stepping-up","steps","stock-prices","stranded-traveler","street-food","stripe-payments","studying","subscriber","subscriptions","suburbs","success-factors","successful-purchase","summer","sunlight","sunny-day","super-thank-you","super-woman","surfer","surveillance","survey","swatches","sweet-home","swing","swipe-options","swipe-profiles","swipe","switches","sync-files","sync","take-away-coffee","take-out-boxes","taking-notes","taking-selfie","target","task-list","task","tasks","tasting","teacher","teaching","team-chat","team-collaboration","team-effort","team-goals","team-page","team-sheet","team-spirit","team-up","team-work","team","teamwork","terms","testimonials","text-field","text-files","texting","the-world-is-mine","things-to-say","thought-process","thoughts","through-the-desert","through-the-park","through-the-window","throw-away","throw-down","time-management","timeline","to-do-list","to-do","to-the-moon","together","tourist-map","town","transfer-files","transfer-money","travel-booking","travel-mode","travel-plans","travelers","traveling","tree-swing","trends","trendy-interface","trip","tutor","tutorial-video","tweetstorm","two-factor-authentication","typewriter","unexpected-friends","unicorn","unlock","up-to-date","update","updated-resume","updates","upgrade","upload-image","upload","uploading","upvote","urban-design","usability-testing","user-flow","users-per-minute","vault","verified","version-control","video-call","video-files","video-game-night","video-games","video-influencer","video-streaming","video-tutorial","videographer","vintage","virtual-assistant","virtual-reality","visionary-technology","visual-data","visualization","voice-assistant","voice-interface","void","voting","vr-chat","wait-in-line","Waiting-for-you","walk-dreaming","walk-in-the-city","walking-around","walking-in-rain","walking-outside","walking-together","walking","wall-post","wallet","wandering-mind","warning","wash-hands","watch-app","watch-application","watch-notification","weather-app","weather-notification","weather","web-browsing","web-developer","web-development","web-devices","web-search","web-shopping","website-2","website-builder","website-setup","website","wedding","welcome-cats","welcome","welcoming","well-done","wilderness","window-shopping","windows","windy-day","wine-tasting","winners","winter-activities","winter-magic","winter-road","winter-skating","winter-walk","wireframing","wishlist","with-love","woman","work-chat","work-from-anywhere","work-in-progress","work-time","work-together","working-from-anywhere","working-late","working-out","working-remotely","working","world","writer","writing-down-ideas","xmas-snowman","yacht","yoga","youtube-tutorial","zoom-in"]),e.each(n,function(e,t){var n=p.baseURL+"files/illustrations/"+t+".svg";a+='<div class="palleon-element light tooltip tooltip-top" data-elsource="'+n+'" data-loader="yes" data-keyword="'+t+'" data-title="'+t.replace("-"," ")+'"><div class="palleon-img-wrap"><div class="palleon-img-loader"></div><img class="lazy" data-src="'+n+'" /></div></div>'}),d.find("#palleon-illustrations-grid").html(a);var e6=function(e){e=e.toLowerCase().replace(" ","-"),d.find("#palleon-illustrations-grid > div").hide().filter('[data-keyword*="'+e+'"]').show()};d.find("#palleon-illustration-search").on("keyup input",function(){d.find("#palleon-noillustrations").hide();var t=e(this).val().toLowerCase();""==t||t.length<1?(d.find("#palleon-illustrations-grid > div").show(),d.find("#palleon-illustration-search-icon").html("search"),d.find("#palleon-illustration-search-icon").removeClass("cancel")):(d.find("#palleon-illustration-search-icon").html("clear"),d.find("#palleon-illustration-search-icon").addClass("cancel"),e6(t),0===d.find("#palleon-illustrations-grid > div:visible").length&&d.find("#palleon-noillustrations").show())}),d.find("#palleon-illustration-search-icon").on("click",function(){e(this).hasClass("cancel")&&(e(this).removeClass("cancel"),e(this).html("search"),d.find("#palleon-illustration-search").val(""),d.find("#palleon-illustrations-grid > div").show(),d.find("#palleon-noillustrations").hide())});var eF=function(e){d.find("#palleon-elements-wrap li").hide().filter('[data-keyword*="'+e+'"]').show()};d.find("#palleon-element-search").on("keyup input",function(){d.find("#palleon-noelements").hide();var t=e(this).val().toLowerCase().replace(/\s/g," ");""==t||t.length<1?(d.find("#palleon-elements-wrap li").show(),d.find("#palleon-element-search-icon").html("search"),d.find("#palleon-element-search-icon").removeClass("cancel")):(d.find("#palleon-element-search-icon").html("clear"),d.find("#palleon-element-search-icon").addClass("cancel"),eF(t),0===d.find("#palleon-elements-wrap li:visible").length&&d.find("#palleon-noelements").show())}),d.find("#palleon-element-search-icon").on("click",function(){e(this).hasClass("cancel")&&(e(this).removeClass("cancel"),e(this).html("search"),d.find("#palleon-element-search").val(""),d.find("#palleon-elements-wrap li").show(),d.find("#palleon-noelements").hide())}),d.find(".palleon-elements-grid").on("click",".palleon-element > *:first-child",function(){var t=e(this).parent(),a=t.data("elsource");if("palleon-icons-grid"==t.parent().attr("id")){var n=d.find("#palleon-icon-style").val();a=t.data("elsource")+"/"+n+"/24px.svg",console.log(a)}var i=t.data("loader");"yes"==i&&d.find("#palleon-canvas-loader").css("display","flex"),d.find(".palleon-elements-grid .palleon-element").removeClass("active"),t.addClass("active"),fabric.loadSVGFromURL(a,function(e,t){var a=fabric.util.groupSVGElements(e,t);a.set("originX","center"),a.set("originY","center"),a.set("left",eT()[0]/2),a.set("top",eT()[1]/2),ed(a)?(a.set("objectType","element"),j.fire("palleon:history",{type:"element",text:palleonParams.added})):(a.set("objectType","customSVG"),j.fire("palleon:history",{type:"customSVG",text:palleonParams.added})),a.set("gradientFill","none"),j.add(a),a.scaleToWidth(eT()[0]/8),a.isPartiallyOnScreen()&&a.scaleToHeight(eT()[1]/8),j.setActiveObject(a),j.requestRenderAll(),"yes"==i&&d.find("#palleon-canvas-loader").hide()},function(){},{crossOrigin:"anonymous"}),j.fire("palleon:history",{type:"element",text:palleonParams.added})}),d.find("#palleon-element-upload").on("change",function(e){var t=new FileReader,a="";t.onload=function(e){a=t.result,fabric.loadSVGFromURL(a,function(e,t){var a=fabric.util.groupSVGElements(e,t);a.set("originX","center"),a.set("originY","center"),a.set("left",eT()[0]/2),a.set("top",eT()[1]/2),ed(a)?(a.set("objectType","element"),j.fire("palleon:history",{type:"element",text:palleonParams.added})):(a.set("objectType","customSVG"),j.fire("palleon:history",{type:"customSVG",text:palleonParams.added})),a.scaleToWidth(eT()[0]/2),a.scaleToHeight(eT()[1]/2),j.add(a),j.setActiveObject(a),j.requestRenderAll()},function(){},{crossOrigin:"anonymous"})},t.readAsDataURL(this.files[0])}),d.find("#palleon-element-color").bind("change",function(){var t=e(this).val(),a=j.getActiveObject();if(""!=a.fill&&a.set("fill",t),a._objects)for(var n=0;n<a._objects.length;n++)""!=a._objects[n].fill&&a._objects[n].set({fill:t});j.requestRenderAll(),j.fire("palleon:history",{type:"element",text:palleonParams.edited})}),d.find("#element-flip-horizontal").on("click",function(){j.getActiveObject().toggle("flipX"),j.requestRenderAll(),j.fire("palleon:history",{type:"element",text:palleonParams.edited})}),d.find("#element-flip-vertical").on("click",function(){j.getActiveObject().toggle("flipY"),j.requestRenderAll(),j.fire("palleon:history",{type:"element",text:palleonParams.edited})}),d.find("#palleon-custom-element-options input[type=range]").bind("input click",function(){var t=e(this).val();"element-skew-x"==e(this).attr("id")?j.getActiveObject().set("skewX",parseInt(t)):"element-skew-y"==e(this).attr("id")?j.getActiveObject().set("skewY",parseInt(t)):"element-rotate"==e(this).attr("id")?j.getActiveObject().set("angle",parseInt(t)):"element-opacity"==e(this).attr("id")&&j.getActiveObject().set("opacity",parseFloat(t)),j.requestRenderAll()}),d.find("#palleon-custom-element-options input[type=range]").bind("change",function(){j.fire("palleon:history",{type:"element",text:palleonParams.edited})}),d.find("#palleon-customsvg-upload").on("change",".customsvg-color",function(){var t=e(this).val(),a=e(this).attr("data-color"),n=j.getActiveObject();if(n._objects){for(var i=0;i<n._objects.length;i++)n._objects[i].fill==a&&n._objects[i].set({fill:t});e(this).attr("data-color",t)}j.requestRenderAll(),j.fire("palleon:history",{type:"element",text:palleonParams.edited})}),d.find("#customsvg-flip-horizontal").on("click",function(){j.getActiveObject().toggle("flipX"),j.requestRenderAll(),j.fire("palleon:history",{type:"customSVG",text:palleonParams.edited})}),d.find("#customsvg-flip-vertical").on("click",function(){j.getActiveObject().toggle("flipY"),j.requestRenderAll(),j.fire("palleon:history",{type:"customSVG",text:palleonParams.edited})}),d.find("#palleon-custom-svg-options input[type=range]").bind("input click",function(){var t=e(this).val();"customsvg-skew-x"==e(this).attr("id")?j.getActiveObject().set("skewX",parseInt(t)):"customsvg-skew-y"==e(this).attr("id")?j.getActiveObject().set("skewY",parseInt(t)):"customsvg-rotate"==e(this).attr("id")?j.getActiveObject().set("angle",parseInt(t)):"customsvg-opacity"==e(this).attr("id")&&j.getActiveObject().set("opacity",parseFloat(t)),j.requestRenderAll()}),d.find("#palleon-custom-svg-options input[type=range]").bind("change",function(){j.fire("palleon:history",{type:"customSVG",text:palleonParams.edited})});var e4=function(e){d.find("#palleon-icons-grid .palleon-element").css("display","none").filter('[title*="'+e+'"]').css("display","flex")};d.find("#palleon-icon-search").on("keyup input",function(){d.find("#palleon-noicons").hide();var t=e(this).val().toLowerCase().replace(/\s/g," ");""==t||t.length<1?(d.find("#palleon-icons-grid .palleon-element").css("display","flex"),d.find("#palleon-icon-search-icon").html("search"),d.find("#palleon-icon-search-icon").removeClass("cancel")):(d.find("#palleon-icon-search-icon").html("clear"),d.find("#palleon-icon-search-icon").addClass("cancel"),e4(t),0===d.find("#palleon-icons-grid .palleon-element:visible").length&&d.find("#palleon-noicons").show())}),d.find("#palleon-icon-search-icon").on("click",function(){e(this).hasClass("cancel")&&(e(this).removeClass("cancel"),e(this).html("search"),d.find("#palleon-icon-search").val(""),d.find("#palleon-icons-grid .palleon-element").css("display","flex"),d.find("#palleon-noicons").hide())}),d.find("#palleon-apps-menu > .palleon-apps-menu-item").on("click",function(){var t=e(this).attr("data-id");d.find("#palleon-apps-content > div").addClass("d-none"),d.find(t).removeClass("d-none"),d.find("#palleon-apps-menu").hide()}),d.find(".palleon-close-app").on("click",function(){d.find("#palleon-apps-content > div").addClass("d-none"),d.find("#palleon-apps-menu").show()}),d.find(".palleon-app-download").on("click",function(){var t=e(this).attr("data-id"),a=d.find("#palleon-"+t+"-preview")[0],n=new XMLSerializer().serializeToString(a),i=document.createElement("a"),l=new Blob([n],{type:"text/plain"});i.href=URL.createObjectURL(l),i.download=t+".svg",i.click()}),d.find(".palleon-app-download-png").on("click",function(){var t=e(this).attr("data-id"),a=H(d.find("#palleon-"+t+"-preview").find("img").attr("src")),n=URL.createObjectURL(a),i=document.createElement("a");i.download=t+".png",i.href=n,i.click()}),d.find(".palleon-app-select").on("click",function(){var t=e(this),a=e(this).attr("data-id"),n=d.find("#palleon-"+a+"-preview")[0],i=eT()[1]/2,l=eT()[0]/2,o=j.getObjects().filter(e=>"printarea"==e.objectType)[0];o&&(i=o.top,l=o.left);var r=new XMLSerializer().serializeToString(n);fabric.loadSVGFromString(r,function(e,a){var n=fabric.util.groupSVGElements(e,a);n.set("originX","center"),n.set("originY","center"),n.set("left",l),n.set("top",i),t.hasClass("element")?n.set("objectType","element"):n.set("objectType","customSVG"),n.set("gradientFill","none"),n.controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},j.add(n),o?(n.scaleToWidth(.5*o.width*j.getZoom()),n.isContainedWithinObject(o)||n.scaleToHeight(.5*o.height*j.getZoom())):(n.scaleToWidth(eT()[0]/8),n.isPartiallyOnScreen()&&n.scaleToHeight(eT()[1]/8)),j.setActiveObject(n),j.requestRenderAll()})}),d.find(".palleon-app-select-png").on("click",function(){var t=e(this).attr("data-id"),a=d.find("#palleon-"+t+"-preview").find("img").attr("src"),n=new Image,i=eT()[1]/2,l=eT()[0]/2,o=j.getObjects().filter(e=>"printarea"==e.objectType)[0];o&&(i=o.top,l=o.left),n.src=a,n.onload=function(){var e=new fabric.Image(n,{objectType:"image",objectCaching:!0,roundedCorders:0,stroke:"#fff",strokeWidth:0,top:i,left:l,originX:"center",originY:"center"});e.set({ogWidth:e.get("width"),ogHeight:e.get("height")}),j.add(e),o?(e.scaleToWidth(.8*o.width*j.getZoom()),e.isContainedWithinObject(o)||e.scaleToHeight(.8*o.height*j.getZoom())):(e.scaleToWidth(eT()[0]/4),e.isPartiallyOnScreen()&&e.scaleToHeight(eT()[1]/4)),j.setActiveObject(e),j.requestRenderAll(),d.find("#palleon-canvas-loader").hide(),j.fire("palleon:history",{type:"image",text:palleonParams.added})}});var e5={},eY="";function eX(e,t,a,n,i){let l=window.trianglify;var o=l({width:e,height:t,cellSize:a,variance:n,xColors:i,yColors:"match",fill:!0}).toCanvas();o=o.toDataURL({format:"png",enableRetinaScaling:!1}),d.find("#palleon-trianglify-preview").html('<img src="'+o+'" />')}function ez(){return kjua({text:d.find("#palleon-qrcode-text").val(),render:"svg",size:300,fill:d.find("#palleon-qrcode-fill").val(),back:d.find("#palleon-qrcode-back").val(),rounded:d.find("#palleon-qrcode-rounded").val(),mode:"label",label:d.find("#palleon-qrcode-label").val(),fontname:"sans",fontcolor:d.find("#palleon-qrcode-label-color").val(),mSize:d.find("#palleon-qrcode-label-size").val(),mPosX:d.find("#palleon-qrcode-label-position-x").val(),mPosY:d.find("#palleon-qrcode-label-position-y").val()})}function eP(){var t=!1,a="";d.find("#palleon-barcode-show-text").is(":checked")&&(t=!0),d.find("#palleon-barcode-text-bold").hasClass("active")&&(a+="bold"),d.find("#palleon-barcode-text-italic").hasClass("active")&&(a+=" italic"),JsBarcode("#palleon-barcode-preview",d.find("#palleon-barcode-text").val(),{format:d.find("#palleon-barcode-format").val(),width:parseInt(d.find("#palleon-barcode-bar-width").val()),height:parseInt(d.find("#palleon-barcode-height").val()),displayValue:t,fontOptions:a,font:d.find("#palleon-barcode-font-family").val(),textAlign:e("#palleon-barcode-text-options").find(".format-align.active").data("align"),textMargin:parseInt(d.find("#palleon-barcode-text-margin").val()),fontSize:parseInt(d.find("#palleon-barcode-font-size").val()),background:d.find("#palleon-barcode-back").val(),lineColor:d.find("#palleon-barcode-line").val(),margin:parseInt(d.find("#palleon-barcode-margin").val()),valid:function(t){t?(e("#palleon-barcode-wrap").show(),e("#palleon-barcode-notice").addClass("d-none"),d.find("#palleon-generate-barcode").prop("disabled",!1)):(e("#palleon-barcode-wrap").hide(),e("#palleon-barcode-notice").removeClass("d-none"),d.find("#palleon-generate-barcode").prop("disabled",!0))}})}function e7(t,a){e("#tm-cursor-1").remove(),d.find("#palleon-canvas-wrap").tmpointer({id:1,native_cursor:"enable",cursorSize:t,cursorColor:a})}function eE(e,t){return e.filter(function(e){return e!=t})}function eL(){if(localStorage.getItem("palleon-user-frames")){var t=JSON.parse(localStorage.getItem("palleon-user-frames")),a=t.length,n="";e.each(t,function(e,t){d.find("[data-frameid='"+t+"']").addClass("favorited"),d.find("[data-frameid='"+t+"']").find(".material-icons").html("star"),n+='<div class="palleon-frame" data-elsource="'+t+'.svg"><div class="palleon-img-wrap" style="min-height: auto;"><img class="lazy" data-src="'+t+'.jpg" src="'+t+'.jpg"></div><div class="frame-favorite"><button type="button" class="palleon-btn-simple star favorited" data-frameid="'+t+'"><span class="material-icons">star</span></button></div></div>'}),d.find("#palleon-frames-favorites").html(n),d.find("#frames-favorites-count").html(a),L.update()}else d.find("#palleon-frames-favorites").html('<div class="notice notice-info"><h6>'+palleonParams.nofavorites+"</h6>"+palleonParams.nofavoritesdesc+"</div>"),d.find("#frames-favorites-count").html("0")}function eU(){if(localStorage.getItem("palleon-user-elements")){var t=JSON.parse(localStorage.getItem("palleon-user-elements")),a=t.length,n="";e.each(t,function(e,t){d.find("[data-elementid='"+t+"']").addClass("favorited"),d.find("[data-elementid='"+t+"']").find(".material-icons").html("star"),n+='<div class="palleon-element" data-elsource="'+t+'.svg" data-loader="no"><img class="lazy" data-src="'+t+'.svg" /><div class="element-favorite"><button type="button" class="palleon-btn-simple star favorited" data-elementid="'+t+'"><span class="material-icons">star</span></button></div></div>'}),d.find("#palleon-elements-favorites").html(n),d.find("#elements-favorites-count").html(a),L.update()}else d.find("#palleon-elements-favorites").html('<div class="notice notice-info"><h6>'+palleonParams.nofavorites+"</h6>"+palleonParams.nofavoritesdesc+"</div>"),d.find("#elements-favorites-count").html("0")}function eW(){if(localStorage.getItem("palleon-user-templates")){var t=JSON.parse(localStorage.getItem("palleon-user-templates")),a="";e.each(t,function(e,t){d.find("[data-templateid='"+t+"']").addClass("favorited"),d.find("[data-templateid='"+t+"']").find(".material-icons").html("star"),a+='<div class="grid-item" data-keyword="" data-category=""><div class="template-favorite"><button type="button" class="palleon-btn-simple star favorited" data-templateid="'+t+'"><span class="material-icons">star</span></button></div><div class="palleon-masonry-item-inner palleon-select-template" data-json="files/templates/json/'+t+'.json"><div class="palleon-img-wrap"><div class="palleon-img-loader"></div><img class="lazy" data-src="files/templates/img/'+t+'.jpg" /></div></div></div>'}),d.find("#templates-favorites").html(a),L.update()}else d.find("#templates-favorites").html('<div class="notice notice-info"><h6>'+palleonParams.nofavorites+"</h6>"+palleonParams.nofavoritesdesc+"</div>")}if(d.find("#palleon-btn-apps").one("click",function(){e5={YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]};var t='<div class="palleon-colorbrewer-item random active" data-id="random"><span class="material-icons">shuffle</span></div>';e.each(e5,function(e,a){t+='<div class="palleon-colorbrewer-item" data-id="'+e+'">';for(var n=0;n<a.length;n++)t+='<div style="background: '+a[n]+';"></div>';t+="</div>"}),d.find("#palleon-colorbrewer").html(t),e.getJSON(p.baseURL+"json/brands.json",function(t){eY=t;for(var a=0;a<t.length;a++)"envato"==t[a].id?d.find("#palleon-brands-list").append(e("<option></option>").attr("value",t[a].id).attr("selected","selected").text(t[a].title)):d.find("#palleon-brands-list").append(e("<option></option>").attr("value",t[a].id).text(t[a].title));d.find("#palleon-brands-list").trigger("change")}),e.getJSON(p.baseURL+"json/crypto.json",function(t){for(var a=0;a<t.length;a++)"BTC"==t[a].symbol?d.find("#palleon-crypto-list").append(e("<option></option>").attr("value",t[a].symbol).attr("selected","selected").text(t[a].name)):d.find("#palleon-crypto-list").append(e("<option></option>").attr("value",t[a].symbol).text(t[a].name));d.find("#palleon-crypto-list").trigger("change")}),e.getJSON(p.baseURL+"json/countries.json",function(t){for(var a=0;a<t.length;a++)d.find("#palleon-flags-list").append(e("<option></option>").attr("value",t[a].code).text(t[a].name));d.find("#palleon-flags-list").trigger("change")})}),d.find("#palleon-apps-menu-color-thief").on("click",function(){!function t(){var a=d.find("#palleon-canvas-img").attr("src");d.find("#palleon-color-thief-preview img").attr("src",a);let n=new ColorThief,i=d.find("#palleon-color-thief-img")[0];function l(t){var a="",i=[],l="",o='<div class="notice notice-warning">'+palleonParams.nocolor+"</div>";(function e(t){let a=document.createElement("canvas"),n=a.getContext("2d");a.width=t.width,a.height=t.height,n.drawImage(t,0,0);let i=n.getImageData(0,0,t.width,t.height),l=i.data;for(let o=0;o<l.length;o+=4)if(0!==l[o]||0!==l[o+1]||0!==l[o+2]||0!==l[o+3])return!1;return!0})(t)?d.find("#palleon-color-thief-preview").hide():(d.find("#palleon-color-thief-preview").show(),o='<div class="palleon-control-wrap label-block control-text-color"><div class="palleon-control"><input id="color-thief-0" type="text" data-color="'+(a="rgb("+n.getColor(t).toString(16)+")")+'" class="color-thief palleon-colorpicker disallow-empty" autocomplete="off" value="'+a+'" readonly /></div></div>',i=n.getPalette(t),e.each(i,function(e,t){var a="rgb("+t.toString(16)+")";l+='<div class="palleon-control-wrap label-block control-text-color"><div class="palleon-control"><input id="color-thief-'+(e+1)+'" type="text" data-color="'+a+'" class="color-thief palleon-colorpicker disallow-empty" autocomplete="off" value="'+a+'" readonly /></div></div>'})),""==l&&(l='<div class="notice notice-warning">'+palleonParams.nocolor+"</div>"),d.find("#palleon-color-thief-dominant").html(o),d.find("#palleon-color-thief-scheme").html(l),d.find(".color-thief").spectrum({showPalette:!1,showAlpha:!1,showButtons:!1,allowEmpty:!1})}i.complete?l(i):i.addEventListener("load",function(){l(i)})}()}),d.find("#palleon-apps-menu-trianglify").one("click",function(){eX(1440,900,75,.5,"random")}),d.find("#palleon-trianglify-app").on("click",".palleon-colorbrewer-item",function(){if(e(this).hasClass("active")){if(e(this).hasClass("random")){var t=parseInt(d.find("#palleon-trianglify-width").val()),a=parseInt(d.find("#palleon-trianglify-height").val()),n=d.find("#palleon-trianglify-cell-size").val(),i=d.find("#palleon-trianglify-variance").val();eX(t,a,n,i,"random")}}else{d.find(".palleon-colorbrewer-item").removeClass("active"),e(this).addClass("active");var t=parseInt(d.find("#palleon-trianglify-width").val()),a=parseInt(d.find("#palleon-trianglify-height").val()),n=d.find("#palleon-trianglify-cell-size").val(),i=d.find("#palleon-trianglify-variance").val();eX(t,a,n,i,e(this).attr("data-id"))}}),d.find("#palleon-trianglify-width").on("change",function(){var t,a=parseInt(e(this).val()),n=parseInt(d.find("#palleon-trianglify-height").val()),i=d.find("#palleon-trianglify-cell-size").val();eX(a,n,i,d.find("#palleon-trianglify-variance").val(),d.find(".palleon-colorbrewer-item.active").attr("data-id"))}),d.find("#palleon-trianglify-height").on("change",function(){var t,a=parseInt(e(this).val()),n=parseInt(d.find("#palleon-trianglify-width").val()),i=d.find("#palleon-trianglify-cell-size").val();eX(n,a,i,d.find("#palleon-trianglify-variance").val(),d.find(".palleon-colorbrewer-item.active").attr("data-id"))}),d.find("#palleon-trianglify-cell-size").on("change",function(){var t,a=parseInt(d.find("#palleon-trianglify-height").val()),n=parseInt(d.find("#palleon-trianglify-width").val()),i=e(this).val();eX(n,a,i,d.find("#palleon-trianglify-variance").val(),d.find(".palleon-colorbrewer-item.active").attr("data-id"))}),d.find("#palleon-trianglify-variance").on("change",function(){var t=parseInt(d.find("#palleon-trianglify-height").val()),a=parseInt(d.find("#palleon-trianglify-width").val()),n=d.find("#palleon-trianglify-cell-size").val(),i=e(this).val();eX(a,t,n,i,d.find(".palleon-colorbrewer-item.active").attr("data-id"))}),d.find("#palleon-brands-list").on("change",function(){for(var t=e(this).val(),a=0;a<eY.length;a++)if(eY[a].id==t){var n="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/"+eY[a].id+".svg";e.get(n,function(t){var n=e(t).find("svg");n.removeAttr("xmlns:a"),d.find("#palleon-brands-preview > *").replaceWith(n),d.find("#palleon-brands-preview").html(d.find("#palleon-brands-preview").html().replace(/^.{4}/g,'<svg fill="#'+eY[a].hex+'"'))},"xml");return}}),d.find("#palleon-crypto-list").on("change",function(){var t=e(this).val().toLowerCase(),a=p.baseURL+"files/crypto/"+t+".svg";e.get(a,function(t){var a=e(t).find("svg");a.removeAttr("xmlns:a"),d.find("#palleon-crypto-preview > *").replaceWith(a)},"xml")}),d.find("#palleon-flags-style").on("change",function(){var t=e(this).val(),a=d.find("#palleon-flags-list").val().toLowerCase(),n=p.baseURL+"files/flags/"+t+"/"+a+".svg";e.get(n,function(t){var a=e(t).find("svg");a.removeAttr("xmlns:a"),d.find("#palleon-flags-preview > *").replaceWith(a)},"xml")}),d.find("#palleon-flags-list").on("change",function(){var t=e(this).val().toLowerCase(),a=d.find("#palleon-flags-style").val(),n=p.baseURL+"files/flags/"+a+"/"+t+".svg";e.get(n,function(t){var a=e(t).find("svg");a.removeAttr("xmlns:a"),d.find("#palleon-flags-preview > *").replaceWith(a)},"xml")}),d.find("#palleon-generate-multiavatar").on("click",function(){var e=new Date().getTime(),t=multiavatar(e);d.find("#palleon-multiavatar-name").val(e),d.find("#palleon-multiavatar-preview").html(t)}),d.find("#palleon-apps-menu-multiavatar").on("click",function(){d.find("#palleon-generate-multiavatar").trigger("click")}),d.find("#palleon-multiavatar-name").on("input paste",function(){var t="John Doe";0!==e(this).val().length?t=e(this).val():e(this).val(t);var a=multiavatar(t);d.find("#palleon-multiavatar-preview").html(a)}),d.find("#palleon-generate-qr-code").on("click",function(){var e=kjua({text:d.find("#palleon-qrcode-text").val(),render:"svg",size:300,fill:d.find("#palleon-qrcode-fill").val(),back:d.find("#palleon-qrcode-back").val(),rounded:d.find("#palleon-qrcode-rounded").val(),mode:"label",label:d.find("#palleon-qrcode-label").val(),fontname:"sans",fontcolor:d.find("#palleon-qrcode-label-color").val(),mSize:d.find("#palleon-qrcode-label-size").val(),mPosX:d.find("#palleon-qrcode-label-position-x").val(),mPosY:d.find("#palleon-qrcode-label-position-y").val()}),t=eT()[1]/2,a=eT()[0]/2,n=j.getObjects().filter(e=>"printarea"==e.objectType)[0];n&&(t=n.top,a=n.left);var i=new XMLSerializer().serializeToString(e);fabric.loadSVGFromString(i,function(e,i){var l=fabric.util.groupSVGElements(e,i);l.set("originX","center"),l.set("originY","center"),l.set("left",a),l.set("top",t),l.set("objectType","app"),l.set("gradientFill","none"),l.controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},j.add(l),n?(l.scaleToWidth(.5*n.width*j.getZoom()),l.isContainedWithinObject(n)||l.scaleToHeight(.5*n.height*j.getZoom())):(l.scaleToWidth(eT()[0]/8),l.isPartiallyOnScreen()&&l.scaleToHeight(eT()[1]/8)),j.setActiveObject(l),j.requestRenderAll()})}),d.find("#palleon-apps-menu-qrcode").one("click",function(){d.find("#qrcode-preview").html(ez())}),d.find('#palleon-qrcode-settings input[type="text"]').on("input",function(){var e=ez();d.find("#qrcode-preview").html(e)}),d.find("#palleon-qrcode-settings .palleon-colorpicker").bind("change",function(){var e=ez();d.find("#qrcode-preview").html(e)}),d.find("#palleon-qrcode-settings input[type=range]").bind("input click",function(){var e=ez();d.find("#qrcode-preview").html(e)}),d.find("#palleon-generate-barcode").on("click",function(){var e=document.getElementById("palleon-barcode-preview"),t=eT()[1]/2,a=eT()[0]/2,n=j.getObjects().filter(e=>"printarea"==e.objectType)[0];n&&(t=n.top,a=n.left);var i=new XMLSerializer().serializeToString(e);fabric.loadSVGFromString(i,function(e,i){var l=fabric.util.groupSVGElements(e,i);l.set("originX","center"),l.set("originY","center"),l.set("left",a),l.set("top",t),l.set("objectType","app"),l.set("gradientFill","none"),l.controls={...fabric.Rect.prototype.controls,ml:new fabric.Control({visible:!1}),mb:new fabric.Control({visible:!1}),mr:new fabric.Control({visible:!1}),mt:new fabric.Control({visible:!1})},j.add(l),n?(l.scaleToWidth(.5*n.width*j.getZoom()),l.isContainedWithinObject(n)||l.scaleToHeight(.5*n.height*j.getZoom())):(l.scaleToWidth(eT()[0]/4),l.isPartiallyOnScreen()&&l.scaleToHeight(eT()[1]/4)),j.setActiveObject(l),j.requestRenderAll()})}),d.find("#palleon-apps-menu-barcode").one("click",function(){d.find("#barcode-preview").html(eP())}),d.find('#palleon-barcode-settings input[type="text"]').on("input",function(){eP()}),d.find("#palleon-barcode-settings .palleon-colorpicker").bind("change",function(){eP()}),d.find("#palleon-barcode-settings input[type=range]").bind("input click",function(){eP()}),d.find("#palleon-barcode-settings .format-style").on("click",function(){e(this).hasClass("active")?e(this).removeClass("active"):e(this).addClass("active"),eP()}),d.find("#palleon-barcode-settings .format-align").on("click",function(){e(this).hasClass("active")||(d.find("#palleon-barcode-settings .format-align").removeClass("active"),e(this).addClass("active")),eP()}),d.find("#palleon-barcode-settings .palleon-select").bind("change",function(){"palleon-barcode-format"==e(this).attr("id")&&d.find("#palleon-barcode-text").val({CODE128:"Example 1234",CODE128A:"EXAMPLE",CODE128B:"Example text",CODE128C:"12345678",EAN13:"1234567890128",EAN8:"12345670",UPC:"123456789999",CODE39:"EXAMPLE TEXT",ITF14:"10012345000017",ITF:"123456",MSI:"123456",MSI10:"123456",MSI11:"123456",MSI1010:"123456",MSI1110:"123456",pharmacode:"1234"}[e(this).val()]),eP()}),d.find("#palleon-barcode-settings .palleon-toggle-checkbox").bind("change",function(){eP()}),d.find("#palleon-draw-btn").on("click",function(){e(this).hasClass("active")?(e("#tm-cursor-1").remove(),d.find("#palleon-draw-settings").hide(),d.find("#palleon-top-bar, #palleon-right-col, #palleon-icon-menu, #palleon-toggle-left, #palleon-toggle-right, .palleon-content-bar").css("pointer-events","auto"),e(this).removeClass("active"),j.isDrawingMode=!1,e(this).removeClass("danger"),e(this).addClass("primary"),e(this).html('<span class="material-icons">brush</span>'+palleonParams.startDrawing)):(d.find("#palleon-draw-settings").show(),d.find("#palleon-top-bar, #palleon-right-col, #palleon-icon-menu, #palleon-toggle-left, #palleon-toggle-right, .palleon-content-bar").css("pointer-events","none"),e(this).addClass("active"),d.find("#palleon-brush-select").trigger("change"),j.isDrawingMode=!0,e(this).removeClass("primary"),e(this).addClass("danger"),e(this).html('<span class="material-icons">close</span>'+palleonParams.stopDrawing))}),d.find("#palleon-brush-select").on("change",function(){var t=e(this).val();if("erase"==t?(e("#palleon-brush-tip").hide(),e("#palleon-eraser-tip").show()):(e("#palleon-brush-tip").show(),e("#palleon-eraser-tip").hide()),"pencil"==t){var a=new fabric.PencilBrush(j);j.freeDrawingBrush=a}else if("circle"==t){var n=new fabric.CircleBrush(j);j.freeDrawingBrush=n}else if("spray"==t){var i=new fabric.SprayBrush(j);j.freeDrawingBrush=i}else if("hline"==t){var l=new fabric.PatternBrush(j);j.freeDrawingBrush=l,l.getPatternSrc=function(){var e=parseInt(d.find("#brush-pattern-width").val()),t=e/2,a=fabric.document.createElement("canvas");a.width=a.height=e;var n=a.getContext("2d");return n.strokeStyle=d.find("#brush-color").val(),n.lineWidth=t,n.beginPath(),n.moveTo(t,0),n.lineTo(t,e),n.closePath(),n.stroke(),a}}else if("vline"==t){var o=new fabric.PatternBrush(j);j.freeDrawingBrush=o,o.getPatternSrc=function(){var e=parseInt(d.find("#brush-pattern-width").val()),t=e/2,a=fabric.document.createElement("canvas");a.width=a.height=e;var n=a.getContext("2d");return n.strokeStyle=d.find("#brush-color").val(),n.lineWidth=t,n.beginPath(),n.moveTo(0,t),n.lineTo(e,t),n.closePath(),n.stroke(),a}}else if("square"==t){var r=new fabric.PatternBrush(j);j.freeDrawingBrush=r,r.getPatternSrc=function(){var e=parseInt(d.find("#brush-pattern-width").val()),t=parseInt(d.find("#brush-pattern-distance").val()),a=fabric.document.createElement("canvas");a.width=a.height=e+t;var n=a.getContext("2d");return n.fillStyle=d.find("#brush-color").val(),n.fillRect(0,0,e,e),a}}else if("erase"==t){var s=new fabric.EraserBrush(j);j.freeDrawingBrush=s}(I=j.freeDrawingBrush).getPatternSrc&&(I.source=I.getPatternSrc.call(I)),I.width=parseInt(d.find("#brush-width").val()),"erase"==t?(d.find("#not-erase-brush").hide(),I.shadow=null,I.color="#E91E63"):(j.freeDrawingBrush.inverted=!1,d.find("#not-erase-brush").show(),I.color=d.find("#brush-color").val()),d.find("#palleon-brush-shadow").is(":checked")?I.shadow=O:I.shadow=null,e7(I.width*j.getZoom(),I.color),"hline"==t||"vline"==t||"square"==t?d.find("#palleon-brush-pattern-width").css("display","flex"):d.find("#palleon-brush-pattern-width").css("display","none"),"square"==t?d.find("#palleon-brush-pattern-distance").css("display","flex"):d.find("#palleon-brush-pattern-distance").css("display","none")}),d.find("#palleon-brush-shadow").on("change",function(){O=new fabric.Shadow({color:d.find("#brush-shadow-color").val(),blur:d.find("#brush-shadow-width").val(),offsetX:d.find("#brush-shadow-shadow-offset-x").val(),offsetY:d.find("#brush-shadow-shadow-offset-y").val()}),e(this).is(":checked")?I.shadow=O:I.shadow=null}),d.find("#palleon-draw-settings input[type=number]").bind("input paste keyup keydown",function(){"brush-width"==e(this).attr("id")?(I.width=parseInt(e(this).val()),e7(I.width*j.getZoom(),I.color)):"brush-shadow-shadow-offset-x"==e(this).attr("id")?O.offsetX=parseInt(e(this).val()):"brush-shadow-shadow-offset-y"==e(this).attr("id")?O.offsetY=parseInt(e(this).val()):"brush-shadow-width"==e(this).attr("id")?O.blur=parseInt(e(this).val()):"brush-pattern-width"==e(this).attr("id")?d.find("#palleon-brush-select").trigger("change"):"brush-pattern-distance"==e(this).attr("id")&&d.find("#palleon-brush-select").trigger("change")}),d.find("#palleon-draw-settings .palleon-colorpicker").bind("change",function(){"brush-color"==e(this).attr("id")?(I.color=e(this).val(),e7(I.width*j.getZoom(),I.color),d.find("#palleon-brush-select").trigger("change")):"brush-shadow-color"==e(this).attr("id")&&(O.color=e(this).val())}),document.onkeydown=function(t){var a=j.getActiveObject();switch(t.keyCode){case 38:a&&(a.top-=1,j.requestRenderAll());break;case 40:a&&(a.top+=1,j.requestRenderAll());break;case 37:a&&(a.left-=1,j.requestRenderAll());break;case 39:a&&(a.left+=1,j.requestRenderAll());break;case 8:a&&!e("input").is(":focus")&&!e("textarea").is(":focus")&&("activeSelection"===a.type?(e.each(a._objects,function(e,t){d.find("#palleon-layers #"+t.id).find("a.delete-layer").trigger("click")}),j.discardActiveObject()):d.find("#palleon-layers #"+a.id).find("a.delete-layer").trigger("click"),j.requestRenderAll())}},eL(),d.find(".palleon-frames-grid").on("click",".frame-favorite button.star",function(){var t=e(this),a=t.data("frameid");if(t.hasClass("favorited")){if(localStorage.getItem("palleon-user-frames")){var n=JSON.parse(localStorage.getItem("palleon-user-frames")),i=eE(n,a);0===i.length?localStorage.removeItem("palleon-user-frames"):localStorage.setItem("palleon-user-frames",JSON.stringify(i))}t.removeClass("favorited"),t.find(".material-icons").html("star_border"),toastr.success(palleonParams.unfavorited,palleonParams.success)}else{if(localStorage.getItem("palleon-user-frames")){var n=JSON.parse(localStorage.getItem("palleon-user-frames"));n.push(a),localStorage.setItem("palleon-user-frames",JSON.stringify(n))}else{var l=[];l[0]=a,localStorage.setItem("palleon-user-frames",JSON.stringify(l))}t.addClass("favorited"),t.find(".material-icons").html("star"),toastr.success(palleonParams.favorited,palleonParams.success)}eL()}),eU(),d.find(".palleon-elements-grid").on("click",".element-favorite button.star",function(){var t=e(this),a=t.data("elementid");if(t.hasClass("favorited")){if(localStorage.getItem("palleon-user-elements")){var n=JSON.parse(localStorage.getItem("palleon-user-elements")),i=eE(n,a);0===i.length?localStorage.removeItem("palleon-user-elements"):localStorage.setItem("palleon-user-elements",JSON.stringify(i))}t.removeClass("favorited"),t.find(".material-icons").html("star_border"),toastr.success(palleonParams.unfavorited,palleonParams.success)}else{if(localStorage.getItem("palleon-user-elements")){var n=JSON.parse(localStorage.getItem("palleon-user-elements"));n.push(a),localStorage.setItem("palleon-user-elements",JSON.stringify(n))}else{var l=[];l[0]=a,localStorage.setItem("palleon-user-elements",JSON.stringify(l))}t.addClass("favorited"),t.find(".material-icons").html("star"),toastr.success(palleonParams.favorited,palleonParams.success)}eU()}),eW(),d.find(".template-grid").on("click",".template-favorite button.star",function(){var t=e(this),a=t.data("templateid");if(t.hasClass("favorited")){if(localStorage.getItem("palleon-user-templates")){var n=JSON.parse(localStorage.getItem("palleon-user-templates")),i=eE(n,a);0===i.length?localStorage.removeItem("palleon-user-templates"):localStorage.setItem("palleon-user-templates",JSON.stringify(i))}t.removeClass("favorited"),t.find(".material-icons").html("star_border"),toastr.success(palleonParams.unfavorited,palleonParams.success)}else{if(localStorage.getItem("palleon-user-templates")){var n=JSON.parse(localStorage.getItem("palleon-user-templates"));n.push(a),localStorage.setItem("palleon-user-templates",JSON.stringify(n))}else{var l=[];l[0]=a,localStorage.setItem("palleon-user-templates",JSON.stringify(l))}t.addClass("favorited"),t.find(".material-icons").html("star"),toastr.success(palleonParams.favorited,palleonParams.success)}eW()}),d.find("#custom-theme").on("change",function(){var t=e(this).val(),a=p.baseURL+"css/"+t+".css";e("#palleon-theme-link").attr("href",a),d.removeClass("light-theme"),d.removeClass("dark-theme"),d.addClass(t+"-theme")}),d.find("#custom-font-size").on("input",function(){e("html").css("font-size",e(this).val()+"px")}),d.find("#custom-image-background").on("change",function(){var t=e(this).val();d.find("#palleon-canvas-color").spectrum("set",t),""==t?(j.backgroundColor="transparent",j.requestRenderAll()):(j.backgroundColor=t,j.requestRenderAll())}),d.find("#ruler-guide-color").on("change",function(){var t=e(this).val();""!=t&&(d.find(".guide.h, .guide.v").css("border-color",t),initAligningGuidelines(j))}),d.find("#ruler-guide-size").on("input",function(){var t=e(this).val();d.find(".guide.h, .guide.v").css("border-width",t+"px"),initAligningGuidelines(j)}),d.find("#palleon-preferences-save").on("click",function(){var t={},a=[],n=[];d.find("#palleon-preferences .preference").each(function(t,i){a.push(e(this).attr("id")),n.push(e(this).val())});for(let i=0;i<a.length;i++)t[a[i]]=n[i];localStorage.setItem("palleon-user-settings",JSON.stringify(t)),toastr.success(palleonParams.settingsaved,palleonParams.success)}),localStorage.getItem("palleon-user-settings")){var eB=JSON.parse(localStorage.getItem("palleon-user-settings"));d.find("#custom-font-size").val(eB["custom-font-size"]);var eH=d.find("#custom-font-size").parent().parent();eH.find(".slider-label span").html(eB["custom-font-size"]),d.find("#custom-font-size").trigger("input"),d.find("#custom-theme").val(eB["custom-theme"]),e("body").removeClass("dark-theme"),e("body").removeClass("light-theme"),e("body").addClass(eB["custom-theme"]+"-theme"),d.find("#custom-theme").trigger("change"),d.find("#custom-background").spectrum("set",eB["custom-background"]),d.find("#custom-background").trigger("change"),d.find("#ruler-guide-color").spectrum("set",eB["ruler-guide-color"]),d.find("#ruler-guide-color").trigger("change"),d.find("#ruler-guide-size").val(eB["ruler-guide-size"]);var eH=d.find("#ruler-guide-size").parent().parent();eH.find(".slider-label span").html(eB["ruler-guide-size"]),d.find("#ruler-guide-size").trigger("input")}initAligningGuidelines(j),e(window).on("resize",function(){ew()}),p.customFunctions.call(this,d,j,L)}}(jQuery);